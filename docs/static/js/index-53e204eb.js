var Fn=(Mt,ht)=>()=>(ht||Mt((ht={exports:{}}).exports,ht),ht.exports);import{e as Mn,ag as lr,o as Qe,M as kr,O as Xe,U as $e,u as hr,c as Ci,F as Nn,a7 as Un,a as Je,T as Bn,J as Ii,as as Gn}from"./@vue-59822d27.js";import{Q as jn}from"./@element-plus-0a425379.js";import{c as Kn,a as Hn,R as Vn}from"./vue-router-7c841144.js";import{i as Yn,z as Wn}from"./element-plus-e5949d74.js";import"./lodash-es-21c98b27.js";import"./@vueuse-9e7d8ec8.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-a36a02e4.js";import"./clipboard-c35e1794.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-73e01a0a.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-432baded.js";var ia=Fn((ur,Ir)=>{(function(){const ht=document.createElement("link").relList;if(ht&&ht.supports&&ht.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))X(w);new MutationObserver(w=>{for(const I of w)if(I.type==="childList")for(const c of I.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&X(c)}).observe(document,{childList:!0,subtree:!0});function H(w){const I={};return w.integrity&&(I.integrity=w.integrity),w.referrerPolicy&&(I.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?I.credentials="include":w.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function X(w){if(w.ep)return;w.ep=!0;const I=H(w);fetch(w.href,I)}})();const qn="modulepreload",zn=function(Mt){return"/data-utils/"+Mt},Oi={},Fe=function(ht,H,X){if(!H||H.length===0)return ht();const w=document.getElementsByTagName("link");return Promise.all(H.map(I=>{if(I=zn(I),I in Oi)return;Oi[I]=!0;const c=I.endsWith(".css"),R=c?'[rel="stylesheet"]':"";if(!!X)for(let B=w.length-1;B>=0;B--){const _=w[B];if(_.href===I&&(!c||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${I}"]${R}`))return;const Y=document.createElement("link");if(Y.rel=c?"stylesheet":qn,c||(Y.as="script",Y.crossOrigin=""),Y.href=I,document.head.appendChild(Y),c)return new Promise((B,_)=>{Y.addEventListener("load",B),Y.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${I}`)))})})).then(()=>ht()).catch(I=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=I,window.dispatchEvent(c),!c.defaultPrevented)throw I})},wi=[{path:"/",name:"Home",component:()=>Fe(()=>import("./Index-fe56f7d4.js"),["static/js/Index-fe56f7d4.js","static/js/@element-plus-0a425379.js","static/js/@vue-59822d27.js","static/js/vue-json-viewer-effdbe32.js","static/js/clipboard-c35e1794.js","static/js/vue-9871d8d9.js","static/js/element-plus-e5949d74.js","static/js/lodash-es-21c98b27.js","static/js/@vueuse-9e7d8ec8.js","static/js/@popperjs-c75af06c.js","static/js/@ctrl-f8748455.js","static/js/dayjs-a36a02e4.js","static/js/async-validator-dee29e8b.js","static/js/memoize-one-297ddbcb.js","static/js/escape-html-73e01a0a.js","static/js/normalize-wheel-es-ed76fb12.js","static/js/@floating-ui-432baded.js","static/css/element-plus-0551cf21.css","static/js/vue-router-7c841144.js","static/js/crypto-js-e8446136.js","static/js/plugin-vueexport-helper-c27b6911.js","static/css/Index-6e7db141.css"]),meta:{title:"解密"}},{path:"/setting",name:"Setting",component:()=>Fe(()=>import("./Setting-190aab50.js"),["static/js/Setting-190aab50.js","static/js/element-plus-e5949d74.js","static/js/@vue-59822d27.js","static/js/lodash-es-21c98b27.js","static/js/@vueuse-9e7d8ec8.js","static/js/@element-plus-0a425379.js","static/js/@popperjs-c75af06c.js","static/js/@ctrl-f8748455.js","static/js/dayjs-a36a02e4.js","static/js/clipboard-c35e1794.js","static/js/async-validator-dee29e8b.js","static/js/memoize-one-297ddbcb.js","static/js/escape-html-73e01a0a.js","static/js/normalize-wheel-es-ed76fb12.js","static/js/@floating-ui-432baded.js","static/css/element-plus-0551cf21.css"]),meta:{title:"解密项目列表"}},{path:"/hls",name:"Hls",component:()=>Fe(()=>import("./HlsVideo-78dc2abf.js"),["static/js/HlsVideo-78dc2abf.js","static/js/@vue-59822d27.js"]),meta:{title:"m3u8视频"}},{path:"/rtsp",name:"Rtsp",component:()=>Fe(()=>import("./RTSP-1cf68210.js"),["static/js/RTSP-1cf68210.js","static/js/plugin-vueexport-helper-c27b6911.js","static/js/@vue-59822d27.js"]),meta:{title:"rtsp视频"}},{path:"/about",name:"About",component:()=>Fe(()=>import("./AboutView-f7d87cab.js"),["static/js/AboutView-f7d87cab.js","static/js/plugin-vueexport-helper-c27b6911.js","static/js/@vue-59822d27.js"]),meta:{title:"关于"}},{path:"/comic",name:"Comic",component:()=>Fe(()=>import("./index-4a28e5ab.js"),["static/js/index-4a28e5ab.js","static/js/plugin-vueexport-helper-c27b6911.js","static/js/@vue-59822d27.js","static/css/index-67efc1d7.css"]),meta:{title:"手绘动漫css"}},{path:"/random",name:"Random",component:()=>Fe(()=>import("./Random-e2ae2081.js"),["static/js/Random-e2ae2081.js","static/js/element-plus-e5949d74.js","static/js/@vue-59822d27.js","static/js/lodash-es-21c98b27.js","static/js/@vueuse-9e7d8ec8.js","static/js/@element-plus-0a425379.js","static/js/@popperjs-c75af06c.js","static/js/@ctrl-f8748455.js","static/js/dayjs-a36a02e4.js","static/js/clipboard-c35e1794.js","static/js/async-validator-dee29e8b.js","static/js/memoize-one-297ddbcb.js","static/js/escape-html-73e01a0a.js","static/js/normalize-wheel-es-ed76fb12.js","static/js/@floating-ui-432baded.js","static/css/element-plus-0551cf21.css"]),meta:{title:"生成随机数"}}],Xn=Kn({history:Hn("/data-utils/"),routes:wi}),Qn=Je("span",null,"系统工具",-1),$n={__name:"sideMenu",props:{isCollapse:{type:Boolean,default:!1}},setup(Mt){const ht=Mn(localStorage.getItem("currentRoute")||"/"),H=X=>{localStorage.setItem("currentRoute",X.index)};return(X,w)=>{const I=lr("el-icon"),c=lr("el-menu-item"),R=lr("el-sub-menu"),S=lr("el-menu");return Qe(),kr(S,{"default-active":ht.value,class:"el-menu-vertical-demo",router:"",collapse:Mt.isCollapse},{default:Xe(()=>[$e(R,{index:"1"},{title:Xe(()=>[$e(I,null,{default:Xe(()=>[$e(hr(jn))]),_:1}),Qn]),default:Xe(()=>[(Qe(!0),Ci(Nn,null,Un(hr(wi),Y=>(Qe(),kr(c,{key:Y.path,index:Y.path,onClick:H},{title:Xe(()=>[Je("span",null,Bn(Y.meta.title),1)]),_:2},1032,["index"]))),128))]),_:1})]),_:1},8,["default-active","collapse"])}}},Jn={class:"main"},Zn=Je("div",{class:"toggleShowMenu"},null,-1),ta=!1,ea={__name:"index",setup(Mt){return(ht,H)=>(Qe(),Ci("div",Jn,[Je("div",{class:"sideLeftbar",style:Ii({width:"170px"})},[$e($n,{isCollapse:ta}),Zn],4),Je("div",{class:"main-contents",style:Ii({left:"170px"})},[$e(hr(Vn))],4)]))}},ra={__name:"App",setup(Mt){return(ht,H)=>(Qe(),kr(hr(ea)))}},Or=Gn(ra);Or.use(Xn);Or.use(Yn,{locale:Wn});Or.mount("#app");typeof window<"u"&&function(Mt,ht){typeof ur=="object"&&typeof Ir=="object"?Ir.exports=ht():typeof define=="function"&&define.amd?define([],ht):typeof ur=="object"?ur.Hls=ht():Mt.Hls=ht()}(globalThis,function(){return function(Mt){var ht={};function H(X){if(ht[X])return ht[X].exports;var w=ht[X]={i:X,l:!1,exports:{}};return Mt[X].call(w.exports,w,w.exports,H),w.l=!0,w.exports}return H.m=Mt,H.c=ht,H.d=function(X,w,I){H.o(X,w)||Object.defineProperty(X,w,{enumerable:!0,get:I})},H.r=function(X){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(X,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(X,"__esModule",{value:!0})},H.t=function(X,w){if(1&w&&(X=H(X)),8&w||4&w&&typeof X=="object"&&X&&X.__esModule)return X;var I=Object.create(null);if(H.r(I),Object.defineProperty(I,"default",{enumerable:!0,value:X}),2&w&&typeof X!="string")for(var c in X)H.d(I,c,(function(R){return X[R]}).bind(null,c));return I},H.n=function(X){var w=X&&X.__esModule?function(){return X.default}:function(){return X};return H.d(w,"a",w),w},H.o=function(X,w){return Object.prototype.hasOwnProperty.call(X,w)},H.p="/dist/",H(H.s=21)}([function(Mt,ht,H){var X;H.d(ht,"a",function(){return X}),function(w){w.MEDIA_ATTACHING="hlsMediaAttaching",w.MEDIA_ATTACHED="hlsMediaAttached",w.MEDIA_DETACHING="hlsMediaDetaching",w.MEDIA_DETACHED="hlsMediaDetached",w.BUFFER_RESET="hlsBufferReset",w.BUFFER_CODECS="hlsBufferCodecs",w.BUFFER_CREATED="hlsBufferCreated",w.BUFFER_APPENDING="hlsBufferAppending",w.BUFFER_APPENDED="hlsBufferAppended",w.BUFFER_EOS="hlsBufferEos",w.BUFFER_FLUSHING="hlsBufferFlushing",w.BUFFER_FLUSHED="hlsBufferFlushed",w.MANIFEST_LOADING="hlsManifestLoading",w.MANIFEST_LOADED="hlsManifestLoaded",w.MANIFEST_PARSED="hlsManifestParsed",w.LEVEL_SWITCHING="hlsLevelSwitching",w.LEVEL_SWITCHED="hlsLevelSwitched",w.LEVEL_LOADING="hlsLevelLoading",w.LEVEL_LOADED="hlsLevelLoaded",w.LEVEL_UPDATED="hlsLevelUpdated",w.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",w.LEVELS_UPDATED="hlsLevelsUpdated",w.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",w.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",w.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",w.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",w.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",w.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",w.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",w.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",w.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",w.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",w.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",w.CUES_PARSED="hlsCuesParsed",w.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",w.INIT_PTS_FOUND="hlsInitPtsFound",w.FRAG_LOADING="hlsFragLoading",w.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",w.FRAG_LOADED="hlsFragLoaded",w.FRAG_DECRYPTED="hlsFragDecrypted",w.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",w.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",w.FRAG_PARSING_METADATA="hlsFragParsingMetadata",w.FRAG_PARSED="hlsFragParsed",w.FRAG_BUFFERED="hlsFragBuffered",w.FRAG_CHANGED="hlsFragChanged",w.FPS_DROP="hlsFpsDrop",w.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",w.ERROR="hlsError",w.DESTROYING="hlsDestroying",w.KEY_LOADING="hlsKeyLoading",w.KEY_LOADED="hlsKeyLoaded",w.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",w.BACK_BUFFER_REACHED="hlsBackBufferReached",w.PLAYBACK_REPLAY="playBackReplay"}(X||(X={}))},function(Mt,ht,H){H.d(ht,"a",function(){return R}),H.d(ht,"b",function(){return S});var X=function(){},w={trace:X,debug:X,log:X,warn:X,info:X,error:X},I=w;function c(Y){var B=self.console[Y];return B?B.bind(self.console,"["+Y+"] >"):X}function R(Y){if(self.console&&Y===!0||typeof Y=="object"){(function(B){for(var _=arguments.length,P=new Array(_>1?_-1:0),$=1;$<_;$++)P[$-1]=arguments[$];P.forEach(function(nt){I[nt]=B[nt]?B[nt].bind(B):c(nt)})})(Y,"debug","log","info","warn","error");try{I.log()}catch{I=w}}else I=w}var S=w},function(Mt,ht,H){var X,w;H.d(ht,"b",function(){return X}),H.d(ht,"a",function(){return w}),function(I){I.NETWORK_ERROR="networkError",I.MEDIA_ERROR="mediaError",I.KEY_SYSTEM_ERROR="keySystemError",I.MUX_ERROR="muxError",I.OTHER_ERROR="otherError"}(X||(X={})),function(I){I.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",I.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",I.KEY_SYSTEM_NO_SESSION="keySystemNoSession",I.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",I.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",I.MANIFEST_LOAD_ERROR="manifestLoadError",I.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",I.MANIFEST_PARSING_ERROR="manifestParsingError",I.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",I.LEVEL_EMPTY_ERROR="levelEmptyError",I.LEVEL_LOAD_ERROR="levelLoadError",I.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",I.LEVEL_SWITCH_ERROR="levelSwitchError",I.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",I.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",I.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",I.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",I.FRAG_LOAD_ERROR="fragLoadError",I.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",I.FRAG_DECRYPT_ERROR="fragDecryptError",I.FRAG_PARSING_ERROR="fragParsingError",I.REMUX_ALLOC_ERROR="remuxAllocError",I.KEY_LOAD_ERROR="keyLoadError",I.KEY_LOAD_TIMEOUT="keyLoadTimeOut",I.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",I.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",I.BUFFER_APPEND_ERROR="bufferAppendError",I.BUFFER_APPENDING_ERROR="bufferAppendingError",I.BUFFER_STALLED_ERROR="bufferStalledError",I.BUFFER_FULL_ERROR="bufferFullError",I.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",I.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",I.INTERNAL_EXCEPTION="internalException",I.INTERNAL_ABORTED="aborted",I.UNKNOWN="unknown"}(w||(w={}))},function(Mt,ht,H){H.d(ht,"a",function(){return X});var X=Number.isFinite||function(w){return typeof w=="number"&&isFinite(w)}},function(Mt,ht,H){var X,w;H.d(ht,"a",function(){return X}),H.d(ht,"b",function(){return w}),function(I){I.MANIFEST="manifest",I.LEVEL="level",I.AUDIO_TRACK="audioTrack",I.SUBTITLE_TRACK="subtitleTrack"}(X||(X={})),function(I){I.MAIN="main",I.AUDIO="audio",I.SUBTITLE="subtitle"}(w||(w={}))},function(Mt,ht,H){H.d(ht,"a",function(){return S}),H.d(ht,"c",function(){return nt}),H.d(ht,"k",function(){return z}),H.d(ht,"h",function(){return tt}),H.d(ht,"e",function(){return ot}),H.d(ht,"d",function(){return rt}),H.d(ht,"f",function(){return N}),H.d(ht,"l",function(){return K}),H.d(ht,"b",function(){return vt}),H.d(ht,"j",function(){return m}),H.d(ht,"i",function(){return D}),H.d(ht,"g",function(){return V});var X=H(10),w=H(6),I=H(7),c=Math.pow(2,32)-1,R=[].push,S={video:1,audio:2,id3:3,text:4};function Y(C){return String.fromCharCode.apply(null,C)}function B(C,j){var U=C[j]<<8|C[j+1];return U<0?65536+U:U}function _(C,j){var U=P(C,j);return U<0?4294967296+U:U}function P(C,j){return C[j]<<24|C[j+1]<<16|C[j+2]<<8|C[j+3]}function $(C,j,U){C[j]=U>>24,C[j+1]=U>>16&255,C[j+2]=U>>8&255,C[j+3]=255&U}function nt(C,j){var U=[];if(!j.length)return U;for(var q=C.byteLength,et=0;et<q;){var G=_(C,et),ct=G>1?et+G:q;if(Y(C.subarray(et+4,et+8))===j[0])if(j.length===1)U.push(C.subarray(et+8,ct));else{var yt=nt(C.subarray(et+8,ct),j.slice(1));yt.length&&R.apply(U,yt)}et=ct}return U}function z(C){var j=nt(C,["moov"])[0],U=j?j.length:null,q=nt(C,["sidx"]);if(!q||!q[0])return null;var et=[],G=q[0],ct=G[0],yt=8,St=_(G,yt);yt+=4,yt+=ct===0?8:16,yt+=2;var lt=G.length+0,At=B(G,yt);yt+=2;for(var pt=0;pt<At;pt++){var It=yt,Rt=_(G,It);It+=4;var Pt=2147483647&Rt;if((2147483648&Rt)>>>31===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var Bt=_(G,It);It+=4,et.push({referenceSize:Pt,subsegmentDuration:Bt,info:{duration:Bt/St,start:lt,end:lt+Pt-1}}),lt+=Pt,yt=It+=4}return{earliestPresentationTime:0,timescale:St,version:ct,referencesCount:At,references:et,moovEndOffset:U}}function tt(C){for(var j=[],U=nt(C,["moov","trak"]),q=0;q<U.length;q++){var et=U[q],G=nt(et,["tkhd"])[0];if(G){var ct=G[0],yt=ct===0?12:20,St=_(G,yt),lt=nt(et,["mdia","mdhd"])[0];if(lt){var At=_(lt,yt=(ct=lt[0])===0?12:20),pt=nt(et,["mdia","hdlr"])[0];if(pt){var It=Y(pt.subarray(8,12)),Rt={soun:w.a.AUDIO,vide:w.a.VIDEO}[It];if(Rt){var Pt=nt(et,["mdia","minf","stbl","stsd"])[0],Bt=void 0;Pt&&(Bt=Y(Pt.subarray(12,16))),j[St]={timescale:At,type:Rt},j[Rt]={timescale:At,id:St,codec:Bt}}}}}}return nt(C,["moov","mvex","trex"]).forEach(function(Ot){var _t=_(Ot,4),Kt=j[_t];Kt&&(Kt.default={duration:_(Ot,12),flags:_(Ot,20)})}),j}function ot(C,j){return nt(j,["moof","traf"]).reduce(function(U,q){var et=nt(q,["tfdt"])[0],G=et[0],ct=nt(q,["tfhd"]).reduce(function(yt,St){var lt=_(St,4),At=C[lt];if(At){var pt=_(et,4);G===1&&(pt*=Math.pow(2,32),pt+=_(et,8));var It=pt/(At.timescale||9e4);if(isFinite(It)&&(yt===null||It<yt))return It}return yt},null);return ct!==null&&isFinite(ct)&&(U===null||ct<U)?ct:U},null)||0}function rt(C,j){for(var U=0,q=0,et=0,G=nt(C,["moof","traf"]),ct=0;ct<G.length;ct++){var yt=G[ct],St=nt(yt,["tfhd"])[0],lt=j[_(St,4)];if(lt){var At=lt.default,pt=_(St,0)|(At==null?void 0:At.flags),It=At==null?void 0:At.duration;8&pt&&(It=_(St,2&pt?12:8));for(var Rt=lt.timescale||9e4,Pt=nt(yt,["trun"]),Bt=0;Bt<Pt.length;Bt++)!(U=J(Pt[Bt]))&&It&&(U=It*_(Pt[Bt],4)),lt.type===w.a.VIDEO?q+=U/Rt:lt.type===w.a.AUDIO&&(et+=U/Rt)}}if(q===0&&et===0){var Ot=z(C);if(Ot!=null&&Ot.references)return Ot.references.reduce(function(_t,Kt){return _t+Kt.info.duration||0},0)}return q||et}function J(C){var j=_(C,0),U=8;1&j&&(U+=4),4&j&&(U+=4);for(var q=0,et=_(C,4),G=0;G<et;G++)256&j&&(q+=_(C,U),U+=4),512&j&&(U+=4),1024&j&&(U+=4),2048&j&&(U+=4);return q}function N(C,j,U){nt(j,["moof","traf"]).forEach(function(q){nt(q,["tfhd"]).forEach(function(et){var G=_(et,4),ct=C[G];if(ct){var yt=ct.timescale||9e4;nt(q,["tfdt"]).forEach(function(St){var lt=St[0],At=_(St,4);if(lt===0)At-=U*yt,$(St,4,At=Math.max(At,0));else{At*=Math.pow(2,32),At+=_(St,8),At-=U*yt,At=Math.max(At,0);var pt=Math.floor(At/(c+1)),It=Math.floor(At%(c+1));$(St,4,pt),$(St,8,It)}})}})})}function K(C){var j={valid:null,remainder:null},U=nt(C,["moof"]);if(!U)return j;if(U.length<2)return j.remainder=C,j;var q=U[U.length-1];return j.valid=Object(X.a)(C,0,q.byteOffset-8),j.remainder=Object(X.a)(C,q.byteOffset-8),j}function vt(C,j){var U=new Uint8Array(C.length+j.length);return U.set(C),U.set(j,C.length),U}function m(C,j){var U=[],q=j.samples,et=j.timescale,G=j.id,ct=!1;return nt(q,["moof"]).map(function(yt){var St=yt.byteOffset-8;nt(yt,["traf"]).map(function(lt){var At=nt(lt,["tfdt"]).map(function(pt){var It=pt[0],Rt=_(pt,4);return It===1&&(Rt*=Math.pow(2,32),Rt+=_(pt,8)),Rt/et})[0];return At!==void 0&&(C=At),nt(lt,["tfhd"]).map(function(pt){var It=_(pt,4),Rt=16777215&_(pt,0),Pt=0,Bt=(16&Rt)!=0,Ot=0,_t=(32&Rt)!=0,Kt=8;It===G&&(1&Rt&&(Kt+=8),2&Rt&&(Kt+=4),8&Rt&&(Pt=_(pt,Kt),Kt+=4),Bt&&(Ot=_(pt,Kt),Kt+=4),_t&&(Kt+=4),j.type==="video"&&(ct=function(wt){if(!wt)return!1;var Ht=wt.indexOf("."),Nt=Ht<0?wt:wt.substring(0,Ht);return Nt==="hvc1"||Nt==="hev1"||Nt==="dvh1"||Nt==="dvhe"}(j.codec)),nt(lt,["trun"]).map(function(wt){var Ht=wt[0],Nt=16777215&_(wt,0),ee=(1&Nt)!=0,qt=0,ie=(4&Nt)!=0,oe=(256&Nt)!=0,zt=0,Gt=(512&Nt)!=0,ne=0,Xt=(1024&Nt)!=0,ve=(2048&Nt)!=0,pe=0,ae=_(wt,4),te=8;ee&&(qt=_(wt,te),te+=4),ie&&(te+=4);for(var de=qt+St,se=0;se<ae;se++){if(oe?(zt=_(wt,te),te+=4):zt=Pt,Gt?(ne=_(wt,te),te+=4):ne=Ot,Xt&&(te+=4),ve&&(pe=Ht===0?_(wt,te):P(wt,te),te+=4),j.type===w.a.VIDEO)for(var Yt=0;Yt<ne;){var Le=_(q,de),me=31&q[de+=4];O(ct,me)&&D(q.subarray(de,de+Le),C+pe/et,U),de+=Le,Yt+=Le+4}C+=zt/et}}))})})}),U}function O(C,j){return C?j===39||j===40:j===6}function D(C,j,U){var q=function(ie){for(var oe=ie.byteLength,zt=[],Gt=1;Gt<oe-2;)ie[Gt]===0&&ie[Gt+1]===0&&ie[Gt+2]===3?(zt.push(Gt+2),Gt+=2):Gt++;if(zt.length===0)return ie;var ne=oe-zt.length,Xt=new Uint8Array(ne),ve=0;for(Gt=0;Gt<ne;ve++,Gt++)ve===zt[0]&&(ve++,zt.shift()),Xt[Gt]=ie[ve];return Xt}(C),et=0;et++;for(var G=0,ct=0,yt=!1,St=0;et<q.length;){G=0;do{if(et>=q.length)break;G+=St=q[et++]}while(St===255);ct=0;do{if(et>=q.length)break;ct+=St=q[et++]}while(St===255);var lt=q.length-et;if(!yt&&G===4&&et<q.length){if(yt=!0,q[et++]===181){var At=B(q,et);if(et+=2,At===49){var pt=_(q,et);if(et+=4,pt===1195456820){var It=q[et++];if(It===3){var Rt=q[et++],Pt=64&Rt,Bt=Pt?2+3*(31&Rt):0,Ot=new Uint8Array(Bt);if(Pt){Ot[0]=Rt;for(var _t=1;_t<Bt;_t++)Ot[_t]=q[et++]}U.push({type:It,payloadType:G,pts:j,bytes:Ot})}}}}}else if(G===5&&ct<lt){if(yt=!0,ct>16){for(var Kt=[],wt=0;wt<16;wt++){var Ht=q[et++].toString(16);Kt.push(Ht.length==1?"0"+Ht:Ht),wt!==3&&wt!==5&&wt!==7&&wt!==9||Kt.push("-")}for(var Nt=ct-16,ee=new Uint8Array(Nt),qt=0;qt<Nt;qt++)ee[qt]=q[et++];U.push({payloadType:G,pts:j,uuid:Kt.join(""),userData:Object(I.f)(ee),userDataBytes:ee})}}else if(ct<lt)et+=ct;else if(ct>lt)break}}function V(C){var j=C[0],U="",q="",et=0,G=0,ct=0,yt=0,St=0,lt=0;if(j===0){for(;Y(C.subarray(lt,lt+1))!=="\0";)U+=Y(C.subarray(lt,lt+1)),lt+=1;for(U+=Y(C.subarray(lt,lt+1)),lt+=1;Y(C.subarray(lt,lt+1))!=="\0";)q+=Y(C.subarray(lt,lt+1)),lt+=1;q+=Y(C.subarray(lt,lt+1)),lt+=1,et=_(C,12),G=_(C,16),yt=_(C,20),St=_(C,24),lt=28}else if(j===1){et=_(C,lt+=4);var At=_(C,lt+=4),pt=_(C,lt+=4);for(lt+=4,ct=Math.pow(2,32)*At+pt,Number.isSafeInteger(ct)||(ct=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),yt=_(C,lt),St=_(C,lt+=4),lt+=4;Y(C.subarray(lt,lt+1))!=="\0";)U+=Y(C.subarray(lt,lt+1)),lt+=1;for(U+=Y(C.subarray(lt,lt+1)),lt+=1;Y(C.subarray(lt,lt+1))!=="\0";)q+=Y(C.subarray(lt,lt+1)),lt+=1;q+=Y(C.subarray(lt,lt+1)),lt+=1}return{schemeIdUri:U,value:q,timeScale:et,presentationTime:ct,presentationTimeDelta:G,eventDuration:yt,id:St,payload:C.subarray(lt,C.byteLength)}}},function(Mt,ht,H){H.d(ht,"a",function(){return X}),H.d(ht,"b",function(){return nt}),H.d(ht,"c",function(){return z});var X,w=H(3),I=H(12),c=H(1),R=H(18),S=H(14);function Y(tt,ot){tt.prototype=Object.create(ot.prototype),tt.prototype.constructor=tt,B(tt,ot)}function B(tt,ot){return(B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(rt,J){return rt.__proto__=J,rt})(tt,ot)}function _(tt,ot){for(var rt=0;rt<ot.length;rt++){var J=ot[rt];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(tt,J.key,J)}}function P(tt,ot,rt){return ot&&_(tt.prototype,ot),rt&&_(tt,rt),Object.defineProperty(tt,"prototype",{writable:!1}),tt}(function(tt){tt.AUDIO="audio",tt.VIDEO="video",tt.AUDIOVIDEO="audiovideo"})(X||(X={}));var $=function(){function tt(ot){var rt;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((rt={})[X.AUDIO]=null,rt[X.VIDEO]=null,rt[X.AUDIOVIDEO]=null,rt),this.baseurl=ot}return tt.prototype.setByteRange=function(ot,rt){var J=ot.split("@",2),N=[];J.length===1?N[0]=rt?rt.byteRangeEndOffset:0:N[0]=parseInt(J[1]),N[1]=parseInt(J[0])+N[0],this._byteRange=N},P(tt,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(I.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(ot){this._url=ot}}]),tt}(),nt=function(tt){function ot(J,N){var K;return(K=tt.call(this,N)||this)._decryptdata=null,K.rawProgramDateTime=null,K.programDateTime=null,K.tagList=[],K.duration=0,K.sn=0,K.levelkey=void 0,K.type=void 0,K.loader=null,K.level=-1,K.cc=0,K.startPTS=void 0,K.endPTS=void 0,K.appendedPTS=void 0,K.startDTS=void 0,K.endDTS=void 0,K.start=0,K.deltaPTS=void 0,K.maxStartPTS=void 0,K.minEndPTS=void 0,K.stats=new S.a,K.urlId=0,K.data=void 0,K.bitrateTest=!1,K.title=null,K.initSegment=null,K.type=J,K}Y(ot,tt);var rt=ot.prototype;return rt.createInitializationVector=function(J){for(var N=new Uint8Array(16),K=12;K<16;K++)N[K]=J>>8*(15-K)&255;return N},rt.setDecryptDataFromLevelKey=function(J,N){var K=J;return(J==null?void 0:J.method)==="AES-128"&&J.uri&&!J.iv&&((K=R.a.fromURI(J.uri)).method=J.method,K.iv=this.createInitializationVector(N),K.keyFormat="identity"),K},rt.setElementaryStreamInfo=function(J,N,K,vt,m,O){O===void 0&&(O=!1);var D=this.elementaryStreams,V=D[J];V?(V.startPTS=Math.min(V.startPTS,N),V.endPTS=Math.max(V.endPTS,K),V.startDTS=Math.min(V.startDTS,vt),V.endDTS=Math.max(V.endDTS,m)):D[J]={startPTS:N,endPTS:K,startDTS:vt,endDTS:m,partial:O}},rt.clearElementaryStreamInfo=function(){var J=this.elementaryStreams;J[X.AUDIO]=null,J[X.VIDEO]=null,J[X.AUDIOVIDEO]=null},P(ot,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var J=this.sn;typeof J!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&c.b.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),J=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,J)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(w.a)(this.programDateTime))return null;var J=Object(w.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*J}},{key:"encrypted",get:function(){var J;return!((J=this.decryptdata)===null||J===void 0||!J.keyFormat||!this.decryptdata.uri)}}]),ot}($),z=function(tt){function ot(rt,J,N,K,vt){var m;(m=tt.call(this,N)||this).fragOffset=0,m.duration=0,m.gap=!1,m.independent=!1,m.relurl=void 0,m.fragment=void 0,m.index=void 0,m.stats=new S.a,m.duration=rt.decimalFloatingPoint("DURATION"),m.gap=rt.bool("GAP"),m.independent=rt.bool("INDEPENDENT"),m.relurl=rt.enumeratedString("URI"),m.fragment=J,m.index=K;var O=rt.enumeratedString("BYTERANGE");return O&&m.setByteRange(O,vt),vt&&(m.fragOffset=vt.fragOffset+vt.duration),m}return Y(ot,tt),P(ot,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var rt=this.elementaryStreams;return!!(rt.audio||rt.video||rt.audiovideo)}}]),ot}($)},function(Mt,ht,H){H.d(ht,"b",function(){return c}),H.d(ht,"a",function(){return S}),H.d(ht,"d",function(){return Y}),H.d(ht,"e",function(){return B}),H.d(ht,"c",function(){return P}),H.d(ht,"f",function(){return rt});var X,w=function(N,K){return K+10<=N.length&&N[K]===73&&N[K+1]===68&&N[K+2]===51&&N[K+3]<255&&N[K+4]<255&&N[K+6]<128&&N[K+7]<128&&N[K+8]<128&&N[K+9]<128},I=function(N,K){return K+10<=N.length&&N[K]===51&&N[K+1]===68&&N[K+2]===73&&N[K+3]<255&&N[K+4]<255&&N[K+6]<128&&N[K+7]<128&&N[K+8]<128&&N[K+9]<128},c=function(N,K){for(var vt=K,m=0;w(N,K);)m+=10,m+=R(N,K+6),I(N,K+10)&&(m+=10),K+=m;if(m>0)return N.subarray(vt,vt+m)},R=function(N,K){var vt=0;return vt=(127&N[K])<<21,vt|=(127&N[K+1])<<14,vt|=(127&N[K+2])<<7,vt|=127&N[K+3]},S=function(N,K){return w(N,K)&&R(N,K+6)+10<=N.length-K},Y=function(N){for(var K=P(N),vt=0;vt<K.length;vt++){var m=K[vt];if(B(m))return ot(m)}},B=function(N){return N&&N.key==="PRIV"&&N.info==="com.apple.streaming.transportStreamTimestamp"},_=function(N){var K=String.fromCharCode(N[0],N[1],N[2],N[3]),vt=R(N,4);return{type:K,size:vt,data:N.subarray(10,10+vt)}},P=function(N){for(var K=0,vt=[];w(N,K);){for(var m=R(N,K+6),O=(K+=10)+m;K+8<O;){var D=_(N.subarray(K)),V=$(D);V&&vt.push(V),K+=D.size+10}I(N,K)&&(K+=10)}return vt},$=function(N){return N.type==="PRIV"?nt(N):N.type[0]==="W"?tt(N):z(N)},nt=function(N){if(!(N.size<2)){var K=rt(N.data,!0),vt=new Uint8Array(N.data.subarray(K.length+1));return{key:N.type,info:K,data:vt.buffer}}},z=function(N){if(!(N.size<2)){if(N.type==="TXXX"){var K=1,vt=rt(N.data.subarray(K),!0);K+=vt.length+1;var m=rt(N.data.subarray(K));return{key:N.type,info:vt,data:m}}var O=rt(N.data.subarray(1));return{key:N.type,data:O}}},tt=function(N){if(N.type==="WXXX"){if(N.size<2)return;var K=1,vt=rt(N.data.subarray(K),!0);K+=vt.length+1;var m=rt(N.data.subarray(K));return{key:N.type,info:vt,data:m}}var O=rt(N.data);return{key:N.type,data:O}},ot=function(N){if(N.data.byteLength===8){var K=new Uint8Array(N.data),vt=1&K[3],m=(K[4]<<23)+(K[5]<<15)+(K[6]<<7)+K[7];return m/=45,vt&&(m+=4772185884e-2),Math.round(m)}},rt=function(N,K){K===void 0&&(K=!1);var vt=J();if(vt){var m=vt.decode(N);if(K){var O=m.indexOf("\0");return O!==-1?m.substring(0,O):m}return m.replace(/\0/g,"")}for(var D,V,C,j=N.length,U="",q=0;q<j;){if((D=N[q++])===0&&K)return U;if(D!==0&&D!==3)switch(D>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:U+=String.fromCharCode(D);break;case 12:case 13:V=N[q++],U+=String.fromCharCode((31&D)<<6|63&V);break;case 14:V=N[q++],C=N[q++],U+=String.fromCharCode((15&D)<<12|(63&V)<<6|(63&C)<<0)}}return U};function J(){return X||self.TextDecoder===void 0||(X=new self.TextDecoder("utf-8")),X}},function(Mt,ht,H){var X;H.d(ht,"a",function(){return X}),function(w){w.audioId3="org.id3",w.dateRange="com.apple.quicktime.HLS",w.emsg="https://aomedia.org/emsg/ID3"}(X||(X={}))},function(Mt,ht,H){H.d(ht,"c",function(){return w}),H.d(ht,"b",function(){return I}),H.d(ht,"a",function(){return c});function X(R,S,Y,B){Y===void 0&&(Y=1),B===void 0&&(B=!1);var _=R*S*Y;return B?Math.round(_):_}function w(R,S,Y,B){return Y===void 0&&(Y=1),B===void 0&&(B=!1),X(R,S,1/Y,B)}function I(R,S){return S===void 0&&(S=!1),X(R,1e3,1/9e4,S)}function c(R,S){return S===void 0&&(S=1),X(R,9e4,1/S)}},function(Mt,ht,H){function X(w,I,c){return Uint8Array.prototype.slice?w.slice(I,c):new Uint8Array(Array.prototype.slice.call(w,I,c))}H.d(ht,"a",function(){return X})},function(Mt,ht,H){H.d(ht,"c",function(){return Le}),H.d(ht,"d",function(){return Ee}),H.d(ht,"a",function(){return Re}),H.d(ht,"b",function(){return Se});var X=H(0),w=H(2),I=H(17),c=H(3),R=H(7),S=H(8);function Y(F,L){return F===void 0&&(F=""),L===void 0&&(L=9e4),{type:F,id:-1,pid:-1,inputTimeScale:L,sequenceNumber:-1,samples:[],dropped:0}}var B=H(5),_=H(10),P=function(){function F(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var L=F.prototype;return L.resetInitSegment=function(v,T,b,k){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},L.resetTimeStamp=function(){},L.resetContiguity=function(){},L.canParse=function(v,T){return!1},L.appendFrame=function(v,T,b){},L.demux=function(v,T){this.cachedData&&(v=Object(B.b)(this.cachedData,v),this.cachedData=null);var b,k,x=R.b(v,0),M=x?x.length:0,at=this._audioTrack,st=this._id3Track,ut=x?R.d(x):void 0,dt=v.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=$(ut,T)),x&&x.length>0&&st.samples.push({pts:this.initPTS,dts:this.initPTS,data:x,type:S.a.audioId3}),k=this.initPTS;M<dt;){if(this.canParse(v,M)){var Tt=this.appendFrame(at,v,M);Tt?(this.frameIndex++,k=Tt.sample.pts,b=M+=Tt.length):M=dt}else R.a(v,M)?(x=R.b(v,M),st.samples.push({pts:k,dts:k,data:x,type:S.a.audioId3}),b=M+=x.length):M++;if(M===dt&&b!==dt){var mt=Object(_.a)(v,b);this.cachedData?this.cachedData=Object(B.b)(this.cachedData,mt):this.cachedData=mt}}return{audioTrack:at,videoTrack:Y(),id3Track:st,textTrack:Y()}},L.demuxSampleAes=function(v,T,b){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},L.flush=function(v){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),this.frameIndex=0,{audioTrack:this._audioTrack,videoTrack:Y(),id3Track:this._id3Track,textTrack:Y()}},L.destroy=function(){},F}(),$=function(F,L){return Object(c.a)(F)?90*F:9e4*L},nt=P,z=H(1);function tt(F,L){return F[L]===255&&(246&F[L+1])==240}function ot(F,L){return 1&F[L+1]?7:9}function rt(F,L){return(3&F[L+3])<<11|F[L+4]<<3|(224&F[L+5])>>>5}function J(F,L){return L+1<F.length&&tt(F,L)}function N(F,L){if(J(F,L)){var v=ot(F,L);if(L+v>=F.length)return!1;var T=rt(F,L);if(T<=v)return!1;var b=L+T;return b===F.length||J(F,b)}return!1}function K(F,L,v,T,b){if(!F.samplerate){var k=function(x,M,at,st){var ut,dt,Tt,mt,Et=navigator.userAgent.toLowerCase(),kt=st,Ct=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];ut=1+((192&M[at+2])>>>6);var Dt=(60&M[at+2])>>>2;if(!(Dt>Ct.length-1))return Tt=(1&M[at+2])<<2,Tt|=(192&M[at+3])>>>6,z.b.log("manifest codec:"+st+", ADTS type:"+ut+", samplingIndex:"+Dt),/firefox/i.test(Et)?Dt>=6?(ut=5,mt=new Array(4),dt=Dt-3):(ut=2,mt=new Array(2),dt=Dt):Et.indexOf("android")!==-1?(ut=2,mt=new Array(2),dt=Dt):(ut=5,mt=new Array(4),st&&(st.indexOf("mp4a.40.29")!==-1||st.indexOf("mp4a.40.5")!==-1)||!st&&Dt>=6?dt=Dt-3:((st&&st.indexOf("mp4a.40.2")!==-1&&(Dt>=6&&Tt===1||/vivaldi/i.test(Et))||!st&&Tt===1)&&(ut=2,mt=new Array(2)),dt=Dt)),mt[0]=ut<<3,mt[0]|=(14&Dt)>>1,mt[1]|=(1&Dt)<<7,mt[1]|=Tt<<3,ut===5&&(mt[1]|=(14&dt)>>1,mt[2]=(1&dt)<<7,mt[2]|=8,mt[3]=0),{config:mt,samplerate:Ct[Dt],channelCount:Tt,codec:"mp4a.40."+ut,manifestCodec:kt};x.trigger(X.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+Dt})}(L,v,T,b);if(!k)return;F.config=k.config,F.samplerate=k.samplerate,F.channelCount=k.channelCount,F.codec=k.codec,F.manifestCodec=k.manifestCodec,z.b.log("parsed codec:"+F.codec+", rate:"+k.samplerate+", channels:"+k.channelCount)}}function vt(F){return 9216e4/F}function m(F,L,v,T,b){var k,x=T+b*vt(F.samplerate),M=function(Et,kt){var Ct=ot(Et,kt);if(kt+Ct<=Et.length){var Dt=rt(Et,kt)-Ct;if(Dt>0)return{headerLength:Ct,frameLength:Dt}}}(L,v);if(M){var at=M.frameLength,st=M.headerLength,ut=st+at,dt=Math.max(0,v+ut-L.length);dt?(k=new Uint8Array(ut-st)).set(L.subarray(v+st,L.length),0):k=L.subarray(v+st,v+ut);var Tt={unit:k,pts:x};return dt||F.samples.push(Tt),{sample:Tt,length:ut,missing:dt}}var mt=L.length-v;return(k=new Uint8Array(mt)).set(L.subarray(v,L.length),0),{sample:{unit:k,pts:x},length:mt,missing:-1}}function O(F,L){return(O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,T){return v.__proto__=T,v})(F,L)}var D=function(F){var L,v;function T(k,x){var M;return(M=F.call(this)||this).observer=void 0,M.config=void 0,M.observer=k,M.config=x,M}v=F,(L=T).prototype=Object.create(v.prototype),L.prototype.constructor=L,O(L,v);var b=T.prototype;return b.resetInitSegment=function(k,x,M,at){F.prototype.resetInitSegment.call(this,k,x,M,at),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:x,duration:at,inputTimeScale:9e4,dropped:0}},T.probe=function(k){if(!k)return!1;for(var x=(R.b(k,0)||[]).length,M=k.length;x<M;x++)if(N(k,x))return z.b.log("ADTS sync word found !"),!0;return!1},b.canParse=function(k,x){return function(M,at){return function(st,ut){return ut+5<st.length}(M,at)&&tt(M,at)&&rt(M,at)<=M.length-at}(k,x)},b.appendFrame=function(k,x,M){K(k,this.observer,x,M,k.manifestCodec);var at=m(k,x,M,this.initPTS,this.frameIndex);if(at&&at.missing===0)return at},T}(nt);D.minProbeByteLength=9;var V=D,C=/\/emsg[-/]ID3/i,j=function(){function F(v,T){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=T}var L=F.prototype;return L.resetTimeStamp=function(){},L.resetInitSegment=function(v,T,b,k){var x=Object(B.h)(v),M=this.videoTrack=Y("video",1),at=this.audioTrack=Y("audio",1),st=this.txtTrack=Y("text",1);if(this.id3Track=Y("id3",1),this.timeOffset=0,x.video){var ut=x.video,dt=ut.id,Tt=ut.timescale,mt=ut.codec;M.id=dt,M.timescale=st.timescale=Tt,M.codec=mt}if(x.audio){var Et=x.audio,kt=Et.id,Ct=Et.timescale,Dt=Et.codec;at.id=kt,at.timescale=Ct,at.codec=Dt}st.id=B.a.text,M.sampleDuration=0,M.duration=at.duration=k},L.resetContiguity=function(){},F.probe=function(v){return v=v.length>16384?v.subarray(0,16384):v,Object(B.c)(v,["moof"]).length>0},L.demux=function(v,T){this.timeOffset=T;var b=v,k=this.videoTrack,x=this.txtTrack;if(this.config.progressive){this.remainderData&&(b=Object(B.b)(this.remainderData,v));var M=Object(B.l)(b);this.remainderData=M.remainder,k.samples=M.valid||new Uint8Array}else k.samples=b;var at=this.extractID3Track(k,T);return x.samples=Object(B.j)(T,k),{videoTrack:k,audioTrack:this.audioTrack,id3Track:at,textTrack:this.txtTrack}},L.flush=function(){var v=this.timeOffset,T=this.videoTrack,b=this.txtTrack;T.samples=this.remainderData||new Uint8Array,this.remainderData=null;var k=this.extractID3Track(T,this.timeOffset);return b.samples=Object(B.j)(v,T),{videoTrack:T,audioTrack:Y(),id3Track:k,textTrack:Y()}},L.extractID3Track=function(v,T){var b=this.id3Track;if(v.samples.length){var k=Object(B.c)(v.samples,["emsg"]);k&&k.forEach(function(x){var M=Object(B.g)(x);if(C.test(M.schemeIdUri)){var at=Object(c.a)(M.presentationTime)?M.presentationTime/M.timeScale:T+M.presentationTimeDelta/M.timeScale,st=M.payload;b.samples.push({data:st,len:st.byteLength,dts:at,pts:at,type:S.a.emsg})}})}return b},L.demuxSampleAes=function(v,T,b){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},L.destroy=function(){},F}();j.minProbeByteLength=1024;var U=j,q=null,et=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],G=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ct=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],yt=[0,1,1,4];function St(F,L,v,T,b){if(!(v+24>L.length)){var k=lt(L,v);if(k&&v+k.frameLength<=L.length){var x=T+b*(9e4*k.samplesPerFrame/k.sampleRate),M={unit:L.subarray(v,v+k.frameLength),pts:x,dts:x};return F.config=[],F.channelCount=k.channelCount,F.samplerate=k.sampleRate,F.samples.push(M),{sample:M,length:k.frameLength,missing:0}}}}function lt(F,L){var v=F[L+1]>>3&3,T=F[L+1]>>1&3,b=F[L+2]>>4&15,k=F[L+2]>>2&3;if(v!==1&&b!==0&&b!==15&&k!==3){var x=F[L+2]>>1&1,M=F[L+3]>>6,at=1e3*et[14*(v===3?3-T:T===3?3:4)+b-1],st=G[3*(v===3?0:v===2?1:2)+k],ut=M===3?1:2,dt=ct[v][T],Tt=yt[T],mt=8*dt*Tt,Et=Math.floor(dt*at/st+x)*Tt;if(q===null){var kt=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);q=kt?parseInt(kt[1]):0}return q&&q<=87&&T===2&&at>=224e3&&M===0&&(F[L+3]=128|F[L+3]),{sampleRate:st,channelCount:ut,frameLength:Et,samplesPerFrame:mt}}}function At(F,L){return F[L]===255&&(224&F[L+1])==224&&(6&F[L+1])!=0}function pt(F,L){return L+1<F.length&&At(F,L)}function It(F,L){if(L+1<F.length&&At(F,L)){var v=lt(F,L),T=4;v!=null&&v.frameLength&&(T=v.frameLength);var b=L+T;return b===F.length||pt(F,b)}return!1}var Rt=function(){function F(v){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=v,this.bytesAvailable=v.byteLength,this.word=0,this.bitsAvailable=0}var L=F.prototype;return L.loadWord=function(){var v=this.data,T=this.bytesAvailable,b=v.byteLength-T,k=new Uint8Array(4),x=Math.min(4,T);if(x===0)throw new Error("no bytes available");k.set(v.subarray(b,b+x)),this.word=new DataView(k.buffer).getUint32(0),this.bitsAvailable=8*x,this.bytesAvailable-=x},L.skipBits=function(v){var T;this.bitsAvailable>v?(this.word<<=v,this.bitsAvailable-=v):(v-=this.bitsAvailable,v-=(T=v>>3)>>3,this.bytesAvailable-=T,this.loadWord(),this.word<<=v,this.bitsAvailable-=v)},L.readBits=function(v){var T=Math.min(this.bitsAvailable,v),b=this.word>>>32-T;return v>32&&z.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=T,this.bitsAvailable>0?this.word<<=T:this.bytesAvailable>0&&this.loadWord(),(T=v-T)>0&&this.bitsAvailable?b<<T|this.readBits(T):b},L.skipLZ=function(){var v;for(v=0;v<this.bitsAvailable;++v)if(this.word&2147483648>>>v)return this.word<<=v,this.bitsAvailable-=v,v;return this.loadWord(),v+this.skipLZ()},L.skipUEG=function(){this.skipBits(1+this.skipLZ())},L.skipEG=function(){this.skipBits(1+this.skipLZ())},L.readUEG=function(){var v=this.skipLZ();return this.readBits(v+1)-1},L.readEG=function(){var v=this.readUEG();return 1&v?1+v>>>1:-1*(v>>>1)},L.readBoolean=function(){return this.readBits(1)===1},L.readUByte=function(){return this.readBits(8)},L.readUShort=function(){return this.readBits(16)},L.readUInt=function(){return this.readBits(32)},L.skipScalingList=function(v){for(var T=8,b=8,k=0;k<v;k++)b!==0&&(b=(T+this.readEG()+256)%256),T=b===0?T:b},L.readSPS=function(){var v,T,b,k=0,x=0,M=0,at=0,st=this.readUByte.bind(this),ut=this.readBits.bind(this),dt=this.readUEG.bind(this),Tt=this.readBoolean.bind(this),mt=this.skipBits.bind(this),Et=this.skipEG.bind(this),kt=this.skipUEG.bind(this),Ct=this.skipScalingList.bind(this);st();var Dt=st();if(ut(5),mt(3),st(),kt(),Dt===100||Dt===110||Dt===122||Dt===244||Dt===44||Dt===83||Dt===86||Dt===118||Dt===128){var Wt=dt();if(Wt===3&&mt(1),kt(),kt(),mt(1),Tt())for(T=Wt!==3?8:12,b=0;b<T;b++)Tt()&&Ct(b<6?16:64)}kt();var ce=dt();if(ce===0)dt();else if(ce===1)for(mt(1),Et(),Et(),v=dt(),b=0;b<v;b++)Et();kt(),mt(1);var le=dt(),ue=dt(),Ae=ut(1);Ae===0&&mt(1),mt(1),Tt()&&(k=dt(),x=dt(),M=dt(),at=dt());var Ft=[1,1];if(Tt()&&Tt())switch(st()){case 1:Ft=[1,1];break;case 2:Ft=[12,11];break;case 3:Ft=[10,11];break;case 4:Ft=[16,11];break;case 5:Ft=[40,33];break;case 6:Ft=[24,11];break;case 7:Ft=[20,11];break;case 8:Ft=[32,11];break;case 9:Ft=[80,33];break;case 10:Ft=[18,11];break;case 11:Ft=[15,11];break;case 12:Ft=[64,33];break;case 13:Ft=[160,99];break;case 14:Ft=[4,3];break;case 15:Ft=[3,2];break;case 16:Ft=[2,1];break;case 255:Ft=[st()<<8|st(),st()<<8|st()]}return{width:Math.ceil(16*(le+1)-2*k-2*x),height:(2-Ae)*(ue+1)*16-(Ae?2:4)*(M+at),pixelRatio:Ft}},L.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},F}(),Pt=function(){function F(v,T,b){this.keyData=void 0,this.decrypter=void 0,this.keyData=b,this.decrypter=new I.a(v,T,{removePKCS7Padding:!1})}var L=F.prototype;return L.decryptBuffer=function(v,T){this.decrypter.decrypt(v,this.keyData.key.buffer,this.keyData.iv.buffer,T)},L.decryptAacSample=function(v,T,b,k){var x=v[T].unit;if(!(x.length<=16)){var M=x.subarray(16,x.length-x.length%16),at=M.buffer.slice(M.byteOffset,M.byteOffset+M.length),st=this;this.decryptBuffer(at,function(ut){var dt=new Uint8Array(ut);x.set(dt,16),k||st.decryptAacSamples(v,T+1,b)})}},L.decryptAacSamples=function(v,T,b){for(;;T++){if(T>=v.length)return void b();if(!(v[T].unit.length<32)){var k=this.decrypter.isSync();if(this.decryptAacSample(v,T,b,k),!k)return}}},L.getAvcEncryptedData=function(v){for(var T=16*Math.floor((v.length-48)/160)+16,b=new Int8Array(T),k=0,x=32;x<v.length-16;x+=160,k+=16)b.set(v.subarray(x,x+16),k);return b},L.getAvcDecryptedUnit=function(v,T){for(var b=new Uint8Array(T),k=0,x=32;x<v.length-16;x+=160,k+=16)v.set(b.subarray(k,k+16),x);return v},L.decryptAvcSample=function(v,T,b,k,x,M){var at=ee(x.data),st=this.getAvcEncryptedData(at),ut=this;this.decryptBuffer(st.buffer,function(dt){x.data=ut.getAvcDecryptedUnit(at,dt),M||ut.decryptAvcSamples(v,T,b+1,k)})},L.decryptAvcSamples=function(v,T,b,k){if(v instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;T++,b=0){if(T>=v.length)return void k();for(var x=v[T].units;!(b>=x.length);b++){var M=x[b];if(!(M.data.length<=48||M.type!==1&&M.type!==5)){var at=this.decrypter.isSync();if(this.decryptAvcSample(v,T,b,k,M,at),!at)return}}}},F}();function Bt(){return(Bt=Object.assign?Object.assign.bind():function(F){for(var L=1;L<arguments.length;L++){var v=arguments[L];for(var T in v)Object.prototype.hasOwnProperty.call(v,T)&&(F[T]=v[T])}return F}).apply(this,arguments)}var Ot=function(){function F(v,T,b){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=v,this.config=T,this.typeSupported=b}F.probe=function(v){var T=F.syncOffset(v);return!(T<0)&&(T&&z.b.warn("MPEG2-TS detected but first sync word found @ offset "+T+", junk ahead ?"),!0)},F.syncOffset=function(v){for(var T=Math.min(1e3,v.length-564),b=0;b<T;){if(v[b]===71&&v[b+188]===71&&v[b+376]===71)return b;b++}return-1},F.createTrack=function(v,T){return{container:v==="video"||v==="audio"?"video/mp2t":void 0,type:v,id:B.a[v],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:v==="audio"?T:void 0}};var L=F.prototype;return L.resetInitSegment=function(v,T,b,k){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=F.createTrack("video"),this._audioTrack=F.createTrack("audio",k),this._id3Track=F.createTrack("id3"),this._txtTrack=F.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.audioCodec=T,this.videoCodec=b,this._duration=k},L.resetTimeStamp=function(){},L.resetContiguity=function(){var v=this._audioTrack,T=this._avcTrack,b=this._id3Track;v&&(v.pesData=null),T&&(T.pesData=null),b&&(b.pesData=null),this.aacOverFlow=null},L.demux=function(v,T,b,k){var x;b===void 0&&(b=!1),k===void 0&&(k=!1),b||(this.sampleAes=null);var M=this._avcTrack,at=this._audioTrack,st=this._id3Track,ut=this._txtTrack,dt=M.pid,Tt=M.pesData,mt=at.pid,Et=st.pid,kt=at.pesData,Ct=st.pesData,Dt=!1,Wt=this.pmtParsed,ce=this._pmtId,le=v.length;if(this.remainderData&&(le=(v=Object(B.b)(this.remainderData,v)).length,this.remainderData=null),le<188&&!k)return this.remainderData=v,{audioTrack:at,videoTrack:M,id3Track:st,textTrack:ut};var ue=Math.max(0,F.syncOffset(v));(le-=(le+ue)%188)<v.byteLength&&!k&&(this.remainderData=new Uint8Array(v.buffer,le,v.buffer.byteLength-le));for(var Ae=0,Ft=ue;Ft<le;Ft+=188)if(v[Ft]===71){var ke=!!(64&v[Ft+1]),Me=((31&v[Ft+1])<<8)+v[Ft+2],Qt=void 0;if((48&v[Ft+3])>>4>1){if((Qt=Ft+5+v[Ft+4])===Ft+188)continue}else Qt=Ft+4;switch(Me){case dt:ke&&(Tt&&(x=Ht(Tt))&&this.parseAVCPES(M,ut,x,!1),Tt={data:[],size:0}),Tt&&(Tt.data.push(v.subarray(Qt,Ft+188)),Tt.size+=Ft+188-Qt);break;case mt:if(ke){if(kt&&(x=Ht(kt)))switch(at.segmentCodec){case"aac":this.parseAACPES(at,x);break;case"mp3":this.parseMPEGPES(at,x)}kt={data:[],size:0}}kt&&(kt.data.push(v.subarray(Qt,Ft+188)),kt.size+=Ft+188-Qt);break;case Et:ke&&(Ct&&(x=Ht(Ct))&&this.parseID3PES(st,x),Ct={data:[],size:0}),Ct&&(Ct.data.push(v.subarray(Qt,Ft+188)),Ct.size+=Ft+188-Qt);break;case 0:ke&&(Qt+=v[Qt]+1),ce=this._pmtId=Kt(v,Qt);break;case ce:ke&&(Qt+=v[Qt]+1);var xt=wt(v,Qt,this.typeSupported,b);xt?((dt=xt.avc)>0&&(M.pid=dt),(mt=xt.audio)>0&&(at.pid=mt,at.segmentCodec=xt.segmentCodec),(Et=xt.id3)>0&&(st.pid=Et)):this.observer.emit(X.a.ERROR,X.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_PARSING_ERROR,fatal:!0,reason:"Found "+Ae+" TS packet/s that do not start with 0x47"}),Dt&&!Wt&&(z.b.log("reparse from beginning"),Dt=!1,Ft=ue-188),Wt=this.pmtParsed=!0;break;case 17:case 8191:break;default:Dt=!0}}else Ae++;Ae>0&&this.observer.emit(X.a.ERROR,X.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Ae+" TS packet/s that do not start with 0x47"}),M.pesData=Tt,at.pesData=kt,st.pesData=Ct;var Oe={audioTrack:at,videoTrack:M,id3Track:st,textTrack:ut};return k&&this.extractRemainingSamples(Oe),Oe},L.flush=function(){var v,T=this.remainderData;return this.remainderData=null,v=T?this.demux(T,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(v),this.sampleAes?this.decrypt(v,this.sampleAes):v},L.extractRemainingSamples=function(v){var T,b=v.audioTrack,k=v.videoTrack,x=v.id3Track,M=v.textTrack,at=k.pesData,st=b.pesData,ut=x.pesData;if(at&&(T=Ht(at))?(this.parseAVCPES(k,M,T,!0),k.pesData=null):k.pesData=at,st&&(T=Ht(st))){switch(b.segmentCodec){case"aac":this.parseAACPES(b,T);break;case"mp3":this.parseMPEGPES(b,T)}b.pesData=null}else st!=null&&st.size&&z.b.log("last AAC PES packet truncated,might overlap between fragments"),b.pesData=st;ut&&(T=Ht(ut))?(this.parseID3PES(x,T),x.pesData=null):x.pesData=ut},L.demuxSampleAes=function(v,T,b){var k=this.demux(v,b,!0,!this.config.progressive),x=this.sampleAes=new Pt(this.observer,this.config,T);return this.decrypt(k,x)},L.decrypt=function(v,T){return new Promise(function(b){var k=v.audioTrack,x=v.videoTrack;k.samples&&k.segmentCodec==="aac"?T.decryptAacSamples(k.samples,0,function(){x.samples?T.decryptAvcSamples(x.samples,0,0,function(){b(v)}):b(v)}):x.samples&&T.decryptAvcSamples(x.samples,0,0,function(){b(v)})})},L.destroy=function(){this._duration=0},L.parseAVCPES=function(v,T,b,k){var x,M=this,at=this.parseAVCNALu(v,b.data),st=this.avcSample,ut=!1;b.data=null,st&&at.length&&!v.audFound&&(Nt(st,v),st=this.avcSample=_t(!1,b.pts,b.dts,"")),at.forEach(function(dt){switch(dt.type){case 1:x=!0,st||(st=M.avcSample=_t(!0,b.pts,b.dts,"")),st.frame=!0;var Tt=dt.data;if(ut&&Tt.length>4){var mt=new Rt(Tt).readSliceType();mt!==2&&mt!==4&&mt!==7&&mt!==9||(st.key=!0)}break;case 5:x=!0,st||(st=M.avcSample=_t(!0,b.pts,b.dts,"")),st.key=!0,st.frame=!0;break;case 6:x=!0,Object(B.i)(ee(dt.data),b.pts,T.samples);break;case 7:if(x=!0,ut=!0,!v.sps){var Et=new Rt(dt.data).readSPS();v.width=Et.width,v.height=Et.height,v.pixelRatio=Et.pixelRatio,v.sps=[dt.data],v.duration=M._duration;for(var kt=dt.data.subarray(1,4),Ct="avc1.",Dt=0;Dt<3;Dt++){var Wt=kt[Dt].toString(16);Wt.length<2&&(Wt="0"+Wt),Ct+=Wt}v.codec=Ct}break;case 8:x=!0,v.pps||(v.pps=[dt.data]);break;case 9:x=!1,v.audFound=!0,st&&Nt(st,v),st=M.avcSample=_t(!1,b.pts,b.dts,"");break;case 12:x=!0;break;default:x=!1,st&&(st.debug+="unknown NAL "+dt.type+" ")}st&&x&&st.units.push(dt)}),k&&st&&(Nt(st,v),this.avcSample=null)},L.getLastNalUnit=function(v){var T,b,k=this.avcSample;if(k&&k.units.length!==0||(k=v[v.length-1]),(T=k)!==null&&T!==void 0&&T.units){var x=k.units;b=x[x.length-1]}return b},L.parseAVCNALu=function(v,T){var b,k,x=T.byteLength,M=v.naluState||0,at=M,st=[],ut=0,dt=-1,Tt=0;for(M===-1&&(dt=0,Tt=31&T[0],M=0,ut=1);ut<x;)if(b=T[ut++],M)if(M!==1)if(b)if(b===1){if(dt>=0){var mt={data:T.subarray(dt,ut-M-1),type:Tt};st.push(mt)}else{var Et=this.getLastNalUnit(v.samples);if(Et&&(at&&ut<=4-at&&Et.state&&(Et.data=Et.data.subarray(0,Et.data.byteLength-at)),(k=ut-M-1)>0)){var kt=new Uint8Array(Et.data.byteLength+k);kt.set(Et.data,0),kt.set(T.subarray(0,k),Et.data.byteLength),Et.data=kt,Et.state=0}}ut<x?(dt=ut,Tt=31&T[ut],M=0):M=-1}else M=0;else M=3;else M=b?0:2;else M=b?0:1;if(dt>=0&&M>=0){var Ct={data:T.subarray(dt,x),type:Tt,state:M};st.push(Ct)}if(st.length===0){var Dt=this.getLastNalUnit(v.samples);if(Dt){var Wt=new Uint8Array(Dt.data.byteLength+T.byteLength);Wt.set(Dt.data,0),Wt.set(T,Dt.data.byteLength),Dt.data=Wt}}return v.naluState=M,st},L.parseAACPES=function(v,T){var b,k,x,M,at,st=0,ut=this.aacOverFlow,dt=T.data;if(ut){this.aacOverFlow=null;var Tt=ut.missing,mt=ut.sample.unit.byteLength;if(Tt===-1){var Et=new Uint8Array(mt+dt.byteLength);Et.set(ut.sample.unit,0),Et.set(dt,mt),dt=Et}else{var kt=mt-Tt;ut.sample.unit.set(dt.subarray(0,Tt),kt),v.samples.push(ut.sample),st=ut.missing}}for(b=st,k=dt.length;b<k-1&&!J(dt,b);b++);if(!(b!==st&&(b<k-1?(x="AAC PES did not start with ADTS header,offset:"+b,M=!1):(x="no ADTS header found in AAC PES",M=!0),z.b.warn("parsing error:"+x),this.observer.emit(X.a.ERROR,X.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_PARSING_ERROR,fatal:M,reason:x}),M))){if(K(v,this.observer,dt,b,this.audioCodec),T.pts!==void 0)at=T.pts;else{if(!ut)return void z.b.warn("[tsdemuxer]: AAC PES unknown PTS");var Ct=vt(v.samplerate);at=ut.sample.pts+Ct}for(var Dt,Wt=0;b<k;){if(b+=(Dt=m(v,dt,b,at,Wt)).length,Dt.missing){this.aacOverFlow=Dt;break}for(Wt++;b<k-1&&!J(dt,b);b++);}}},L.parseMPEGPES=function(v,T){var b=T.data,k=b.length,x=0,M=0,at=T.pts;if(at!==void 0)for(;M<k;)if(pt(b,M)){var st=St(v,b,M,at,x);if(!st)break;M+=st.length,x++}else M++;else z.b.warn("[tsdemuxer]: MPEG PES unknown PTS")},L.parseID3PES=function(v,T){if(T.pts!==void 0){var b=Bt({},T,{type:this._avcTrack?S.a.emsg:S.a.audioId3});v.samples.push(b)}else z.b.warn("[tsdemuxer]: ID3 PES unknown PTS")},F}();function _t(F,L,v,T){return{key:F,frame:!1,pts:L,dts:v,units:[],debug:T,length:0}}function Kt(F,L){return(31&F[L+10])<<8|F[L+11]}function wt(F,L,v,T){var b={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},k=L+3+((15&F[L+1])<<8|F[L+2])-4,x=!1;for(L+=12+((15&F[L+10])<<8|F[L+11]);L<k;){var M=(31&F[L+1])<<8|F[L+2];switch(F[L]){case 207:if(!T){z.b.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:b.audio===-1&&(b.audio=M);break;case 21:b.id3===-1&&(b.id3=M);break;case 219:if(!T){z.b.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:b.avc===-1&&(b.avc=M);break;case 3:case 4:v.mpeg!==!0&&v.mp3!==!0?z.b.log("MPEG audio found, not supported in this browser"):b.audio===-1&&(b.audio=M,b.segmentCodec="mp3");break;case 36:z.b.warn("Unsupported HEVC stream type found"),x=!0}L+=5+((15&F[L+3])<<8|F[L+4])}return x?null:b}function Ht(F){var L,v,T,b,k,x=0,M=F.data;if(!F||F.size===0)return null;for(;M[0].length<19&&M.length>1;){var at=new Uint8Array(M[0].length+M[1].length);at.set(M[0]),at.set(M[1],M[0].length),M[0]=at,M.splice(1,1)}if(((L=M[0])[0]<<16)+(L[1]<<8)+L[2]===1){if((v=(L[4]<<8)+L[5])&&v>F.size-6)return null;var st=L[7];192&st&&(b=536870912*(14&L[9])+4194304*(255&L[10])+16384*(254&L[11])+128*(255&L[12])+(254&L[13])/2,64&st?b-(k=536870912*(14&L[14])+4194304*(255&L[15])+16384*(254&L[16])+128*(255&L[17])+(254&L[18])/2)>54e5&&(z.b.warn(Math.round((b-k)/9e4)+"s delta between PTS and DTS, align them"),b=k):k=b);var ut=(T=L[8])+9;if(F.size<=ut)return null;F.size-=ut;for(var dt=new Uint8Array(F.size),Tt=0,mt=M.length;Tt<mt;Tt++){var Et=(L=M[Tt]).byteLength;if(ut){if(ut>Et){ut-=Et;continue}L=L.subarray(ut),Et-=ut,ut=0}dt.set(L,x),x+=Et}return v&&(v-=T+3),{data:dt,pts:b,dts:k,len:v}}return null}function Nt(F,L){if(F.units.length&&F.frame){if(F.pts===void 0){var v=L.samples,T=v.length;if(!T)return void L.dropped++;var b=v[T-1];F.pts=b.pts,F.dts=b.dts}L.samples.push(F)}F.debug.length&&z.b.log(F.pts+"/"+F.dts+":"+F.debug)}function ee(F){for(var L=F.byteLength,v=[],T=1;T<L-2;)F[T]===0&&F[T+1]===0&&F[T+2]===3?(v.push(T+2),T+=2):T++;if(v.length===0)return F;var b=L-v.length,k=new Uint8Array(b),x=0;for(T=0;T<b;x++,T++)x===v[0]&&(x++,v.shift()),k[T]=F[x];return k}Ot.minProbeByteLength=188;var qt=Ot;function ie(F,L){return(ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,T){return v.__proto__=T,v})(F,L)}var oe=function(F){var L,v;function T(){return F.apply(this,arguments)||this}v=F,(L=T).prototype=Object.create(v.prototype),L.prototype.constructor=L,ie(L,v);var b=T.prototype;return b.resetInitSegment=function(k,x,M,at){F.prototype.resetInitSegment.call(this,k,x,M,at),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:x,duration:at,inputTimeScale:9e4,dropped:0}},T.probe=function(k){if(!k)return!1;for(var x=(R.b(k,0)||[]).length,M=k.length;x<M;x++)if(It(k,x))return z.b.log("MPEG Audio sync word found !"),!0;return!1},b.canParse=function(k,x){return function(M,at){return At(M,at)&&4<=M.length-at}(k,x)},b.appendFrame=function(k,x,M){if(this.initPTS!==null)return St(k,x,M,this.initPTS,this.frameIndex)},T}(nt);oe.minProbeByteLength=4;var zt=oe,Gt=H(13),ne=H(6),Xt=function(){function F(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var L=F.prototype;return L.destroy=function(){},L.resetTimeStamp=function(v){this.initPTS=v,this.lastEndDTS=null},L.resetNextTimestamp=function(){this.lastEndDTS=null},L.resetInitSegment=function(v,T,b){this.audioCodec=T,this.videoCodec=b,this.generateInitSegment(v),this.emitInitSegment=!0},L.generateInitSegment=function(v){var T=this.audioCodec,b=this.videoCodec;if(!v||!v.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var k=this.initData=Object(B.h)(v);T||(T=pe(k.audio,ne.a.AUDIO)),b||(b=pe(k.video,ne.a.VIDEO));var x={};k.audio&&k.video?x.audiovideo={container:"video/mp4",codec:T+","+b,initSegment:v,id:"main"}:k.audio?x.audio={container:"audio/mp4",codec:T,initSegment:v,id:"audio"}:k.video?x.video={container:"video/mp4",codec:b,initSegment:v,id:"main"}:z.b.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=x},L.remux=function(v,T,b,k,x){var M,at=this.initPTS,st=this.lastEndDTS,ut={audio:void 0,video:void 0,text:k,id3:b,initSegment:void 0};Object(c.a)(st)||(st=this.lastEndDTS=x||0);var dt=T.samples;if(!dt||!dt.length)return ut;var Tt={initPTS:void 0,timescale:1},mt=this.initData;if(mt&&mt.length||(this.generateInitSegment(dt),mt=this.initData),!mt||!mt.length)return z.b.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),ut;this.emitInitSegment&&(Tt.tracks=this.initTracks,this.emitInitSegment=!1),Object(c.a)(at)||(this.initPTS=Tt.initPTS=at=ve(mt,dt,st));var Et=Object(B.d)(dt,mt),kt=st,Ct=Et+kt;Object(B.f)(mt,dt,at),Et>0?this.lastEndDTS=Ct:(z.b.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var Dt=!!mt.audio,Wt=!!mt.video,ce="";Dt&&(ce+="audio"),Wt&&(ce+="video");var le={data1:dt,startPTS:kt,startDTS:kt,endPTS:Ct,endDTS:Ct,type:ce,hasAudio:Dt,hasVideo:Wt,nb:1,dropped:0};ut.audio=le.type==="audio"?le:void 0,ut.video=le.type!=="audio"?le:void 0,ut.initSegment=Tt;var ue=(M=this.initPTS)!=null?M:0;return ut.id3=Object(Gt.b)(b,x,ue,ue),k.samples.length&&(ut.text=Object(Gt.c)(k,x,ue)),ut},F}(),ve=function(F,L,v){return Object(B.e)(F,L)-v};function pe(F,L){var v=F==null?void 0:F.codec;return v&&v.length>4?v:v==="hvc1"||v==="hev1"?"hvc1.1.c.L120.90":v==="av01"?"av01.0.04M.08":v==="avc1"||L===ne.a.VIDEO?"avc1.42e01e":"mp4a.40.5"}var ae,te=Xt,de=H(15);try{ae=self.performance.now.bind(self.performance)}catch{z.b.debug("Unable to use Performance API on this environment"),ae=self.Date.now}var se=[{demux:qt,remux:Gt.a},{demux:U,remux:te},{demux:V,remux:Gt.a},{demux:zt,remux:Gt.a}],Yt=1024;se.forEach(function(F){var L=F.demux;Yt=Math.max(Yt,L.minProbeByteLength)});var Le=function(){function F(v,T,b,k,x){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new de.a,this.observer=v,this.typeSupported=T,this.config=b,this.vendor=k,this.id=x}var L=F.prototype;return L.configure=function(v){this.transmuxConfig=v,this.decrypter&&this.decrypter.reset()},L.push=function(v,T,b,k){var x=this,M=b.transmuxing;M.executeStart=ae();var at=new Uint8Array(v),st=this.cache,ut=this.config,dt=this.currentTransmuxState,Tt=this.transmuxConfig;k&&(this.currentTransmuxState=k);var mt=function(we,fe){var xe=null;return we.byteLength>0&&fe!=null&&fe.key!=null&&fe.iv!==null&&fe.method!=null&&(xe=fe),xe}(at,T);if(mt&&mt.method==="AES-128"){var Et=this.getDecrypter();if(!ut.enableSoftwareAES)return this.decryptionPromise=Et.webCryptoDecrypt(at,mt.key.buffer,mt.iv.buffer).then(function(we){var fe=x.push(we,null,b);return x.decryptionPromise=null,fe}),this.decryptionPromise;var kt=Et.softwareDecrypt(at,mt.key.buffer,mt.iv.buffer);if(!kt)return M.executeEnd=ae(),me(b);at=new Uint8Array(kt)}var Ct=k||dt,Dt=Ct.contiguous,Wt=Ct.discontinuity,ce=Ct.trackSwitch,le=Ct.accurateTimeOffset,ue=Ct.timeOffset,Ae=Ct.initSegmentChange,Ft=Tt.audioCodec,ke=Tt.videoCodec,Me=Tt.defaultInitPts,Qt=Tt.duration,xt=Tt.initSegmentData;if((Wt||ce||Ae)&&this.resetInitSegment(xt,Ft,ke,Qt),(Wt||Ae)&&this.resetInitialTimestamp(Me),Dt||this.resetContiguity(),this.needsProbing(at,Wt,ce)){if(st.dataLength){var Oe=st.flush();at=Object(B.b)(Oe,at)}this.configureTransmuxer(at,Tt)}var Ce=this.transmux(at,mt,ue,le,b),Ie=this.currentTransmuxState;return Ie.contiguous=!0,Ie.discontinuity=!1,Ie.trackSwitch=!1,M.executeEnd=ae(),Ce},L.flush=function(v){var T=this,b=v.transmuxing;b.executeStart=ae();var k=this.decrypter,x=this.cache,M=this.currentTransmuxState,at=this.decryptionPromise;if(at)return at.then(function(){return T.flush(v)});var st=[],ut=M.timeOffset;if(k){var dt=k.flush();dt&&st.push(this.push(dt,null,v))}var Tt=x.dataLength;x.reset();var mt=this.demuxer,Et=this.remuxer;if(!mt||!Et)return Tt>=Yt&&this.observer.emit(X.a.ERROR,X.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),b.executeEnd=ae(),[me(v)];var kt=mt.flush(ut);return Ee(kt)?kt.then(function(Ct){return T.flushRemux(st,Ct,v),st}):(this.flushRemux(st,kt,v),st)},L.flushRemux=function(v,T,b){var k=T.audioTrack,x=T.videoTrack,M=T.id3Track,at=T.textTrack,st=this.currentTransmuxState,ut=st.accurateTimeOffset,dt=st.timeOffset;z.b.log("[transmuxer.ts]: Flushed fragment "+b.sn+(b.part>-1?" p: "+b.part:"")+" of level "+b.level);var Tt=this.remuxer.remux(k,x,M,at,dt,ut,!0,this.id);v.push({remuxResult:Tt,chunkMeta:b}),b.transmuxing.executeEnd=ae()},L.resetInitialTimestamp=function(v){var T=this.demuxer,b=this.remuxer;T&&b&&(T.resetTimeStamp(v),b.resetTimeStamp(v))},L.resetContiguity=function(){var v=this.demuxer,T=this.remuxer;v&&T&&(v.resetContiguity(),T.resetNextTimestamp())},L.resetInitSegment=function(v,T,b,k){var x=this.demuxer,M=this.remuxer;x&&M&&(x.resetInitSegment(v,T,b,k),M.resetInitSegment(v,T,b))},L.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},L.transmux=function(v,T,b,k,x){return T&&T.method==="SAMPLE-AES"?this.transmuxSampleAes(v,T,b,k,x):this.transmuxUnencrypted(v,b,k,x)},L.transmuxUnencrypted=function(v,T,b,k){var x=this.demuxer.demux(v,T,!1,!this.config.progressive),M=x.audioTrack,at=x.videoTrack,st=x.id3Track,ut=x.textTrack;return{remuxResult:this.remuxer.remux(M,at,st,ut,T,b,!1,this.id),chunkMeta:k}},L.transmuxSampleAes=function(v,T,b,k,x){var M=this;return this.demuxer.demuxSampleAes(v,T,b).then(function(at){return{remuxResult:M.remuxer.remux(at.audioTrack,at.videoTrack,at.id3Track,at.textTrack,b,k,!1,M.id),chunkMeta:x}})},L.configureTransmuxer=function(v,T){for(var b,k=this.config,x=this.observer,M=this.typeSupported,at=this.vendor,st=T.audioCodec,ut=T.defaultInitPts,dt=T.duration,Tt=T.initSegmentData,mt=T.videoCodec,Et=0,kt=se.length;Et<kt;Et++)if(se[Et].demux.probe(v)){b=se[Et];break}b||(z.b.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),b={demux:U,remux:te});var Ct=this.demuxer,Dt=this.remuxer,Wt=b.remux,ce=b.demux;Dt&&Dt instanceof Wt||(this.remuxer=new Wt(x,k,M,at)),Ct&&Ct instanceof ce||(this.demuxer=new ce(x,k,M),this.probe=ce.probe),this.resetInitSegment(Tt,st,mt,dt),this.resetInitialTimestamp(ut)},L.needsProbing=function(v,T,b){return!this.demuxer||!this.remuxer||T||b},L.getDecrypter=function(){var v=this.decrypter;return v||(v=this.decrypter=new I.a(this.observer,this.config)),v},F}(),me=function(F){return{remuxResult:{},chunkMeta:F}};function Ee(F){return"then"in F&&F.then instanceof Function}var Re=function(F,L,v,T,b){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=F,this.videoCodec=L,this.initSegmentData=v,this.duration=T,this.defaultInitPts=b},Se=function(F,L,v,T,b,k){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=F,this.contiguous=L,this.accurateTimeOffset=v,this.trackSwitch=T,this.timeOffset=b,this.initSegmentChange=k}},function(Mt,ht,H){var X,w,I,c,R;X=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,w=/^(?=([^\/?#]*))\1([^]*)$/,I=/(?:\/|^)\.(?=\/)/g,c=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,R={buildAbsoluteURL:function(S,Y,B){if(B=B||{},S=S.trim(),!(Y=Y.trim())){if(!B.alwaysNormalize)return S;var _=R.parseURL(S);if(!_)throw new Error("Error trying to parse base URL.");return _.path=R.normalizePath(_.path),R.buildURLFromParts(_)}var P=R.parseURL(Y);if(!P)throw new Error("Error trying to parse relative URL.");if(P.scheme)return B.alwaysNormalize?(P.path=R.normalizePath(P.path),R.buildURLFromParts(P)):Y;var $=R.parseURL(S);if(!$)throw new Error("Error trying to parse base URL.");if(!$.netLoc&&$.path&&$.path[0]!=="/"){var nt=w.exec($.path);$.netLoc=nt[1],$.path=nt[2]}$.netLoc&&!$.path&&($.path="/");var z={scheme:$.scheme,netLoc:P.netLoc,path:null,params:P.params,query:P.query,fragment:P.fragment};if(!P.netLoc&&(z.netLoc=$.netLoc,P.path[0]!=="/"))if(P.path){var tt=$.path,ot=tt.substring(0,tt.lastIndexOf("/")+1)+P.path;z.path=R.normalizePath(ot)}else z.path=$.path,P.params||(z.params=$.params,P.query||(z.query=$.query));return z.path===null&&(z.path=B.alwaysNormalize?R.normalizePath(P.path):P.path),R.buildURLFromParts(z)},parseURL:function(S){var Y=X.exec(S);return Y?{scheme:Y[1]||"",netLoc:Y[2]||"",path:Y[3]||"",params:Y[4]||"",query:Y[5]||"",fragment:Y[6]||""}:null},normalizePath:function(S){for(S=S.split("").reverse().join("").replace(I,"");S.length!==(S=S.replace(c,"")).length;);return S.split("").reverse().join("")},buildURLFromParts:function(S){return S.scheme+S.netLoc+S.path+S.params+S.query+S.fragment}},Mt.exports=R},function(Mt,ht,H){H.d(ht,"a",function(){return ot}),H.d(ht,"d",function(){return rt}),H.d(ht,"b",function(){return J}),H.d(ht,"c",function(){return N});var X=H(3),w=function(){function m(){}return m.getSilentFrame=function(O,D){switch(O){case"mp4a.40.2":if(D===1)return new Uint8Array([0,200,0,128,35,128]);if(D===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(D===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(D===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(D===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(D===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(D===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(D===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(D===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},m}(),I=Math.pow(2,32)-1,c=function(){function m(){}return m.init=function(){var O;for(O in m.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},m.types)m.types.hasOwnProperty(O)&&(m.types[O]=[O.charCodeAt(0),O.charCodeAt(1),O.charCodeAt(2),O.charCodeAt(3)]);var D=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),V=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);m.HDLR_TYPES={video:D,audio:V};var C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),j=new Uint8Array([0,0,0,0,0,0,0,0]);m.STTS=m.STSC=m.STCO=j,m.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),m.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),m.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),m.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var U=new Uint8Array([105,115,111,109]),q=new Uint8Array([97,118,99,49]),et=new Uint8Array([0,0,0,1]);m.FTYP=m.box(m.types.ftyp,U,et,U,q),m.DINF=m.box(m.types.dinf,m.box(m.types.dref,C))},m.box=function(O){for(var D=8,V=arguments.length,C=new Array(V>1?V-1:0),j=1;j<V;j++)C[j-1]=arguments[j];for(var U=C.length,q=U;U--;)D+=C[U].byteLength;var et=new Uint8Array(D);for(et[0]=D>>24&255,et[1]=D>>16&255,et[2]=D>>8&255,et[3]=255&D,et.set(O,4),U=0,D=8;U<q;U++)et.set(C[U],D),D+=C[U].byteLength;return et},m.hdlr=function(O){return m.box(m.types.hdlr,m.HDLR_TYPES[O])},m.mdat=function(O){return m.box(m.types.mdat,O)},m.mdhd=function(O,D){D*=O;var V=Math.floor(D/(I+1)),C=Math.floor(D%(I+1));return m.box(m.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,O>>24&255,O>>16&255,O>>8&255,255&O,V>>24,V>>16&255,V>>8&255,255&V,C>>24,C>>16&255,C>>8&255,255&C,85,196,0,0]))},m.mdia=function(O){return m.box(m.types.mdia,m.mdhd(O.timescale,O.duration),m.hdlr(O.type),m.minf(O))},m.mfhd=function(O){return m.box(m.types.mfhd,new Uint8Array([0,0,0,0,O>>24,O>>16&255,O>>8&255,255&O]))},m.minf=function(O){return O.type==="audio"?m.box(m.types.minf,m.box(m.types.smhd,m.SMHD),m.DINF,m.stbl(O)):m.box(m.types.minf,m.box(m.types.vmhd,m.VMHD),m.DINF,m.stbl(O))},m.moof=function(O,D,V){return m.box(m.types.moof,m.mfhd(O),m.traf(V,D))},m.moov=function(O){for(var D=O.length,V=[];D--;)V[D]=m.trak(O[D]);return m.box.apply(null,[m.types.moov,m.mvhd(O[0].timescale,O[0].duration)].concat(V).concat(m.mvex(O)))},m.mvex=function(O){for(var D=O.length,V=[];D--;)V[D]=m.trex(O[D]);return m.box.apply(null,[m.types.mvex].concat(V))},m.mvhd=function(O,D){D*=O;var V=Math.floor(D/(I+1)),C=Math.floor(D%(I+1)),j=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,O>>24&255,O>>16&255,O>>8&255,255&O,V>>24,V>>16&255,V>>8&255,255&V,C>>24,C>>16&255,C>>8&255,255&C,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return m.box(m.types.mvhd,j)},m.sdtp=function(O){var D,V,C=O.samples||[],j=new Uint8Array(4+C.length);for(D=0;D<C.length;D++)V=C[D].flags,j[D+4]=V.dependsOn<<4|V.isDependedOn<<2|V.hasRedundancy;return m.box(m.types.sdtp,j)},m.stbl=function(O){return m.box(m.types.stbl,m.stsd(O),m.box(m.types.stts,m.STTS),m.box(m.types.stsc,m.STSC),m.box(m.types.stsz,m.STSZ),m.box(m.types.stco,m.STCO))},m.avc1=function(O){var D,V,C,j=[],U=[];for(D=0;D<O.sps.length;D++)C=(V=O.sps[D]).byteLength,j.push(C>>>8&255),j.push(255&C),j=j.concat(Array.prototype.slice.call(V));for(D=0;D<O.pps.length;D++)C=(V=O.pps[D]).byteLength,U.push(C>>>8&255),U.push(255&C),U=U.concat(Array.prototype.slice.call(V));var q=m.box(m.types.avcC,new Uint8Array([1,j[3],j[4],j[5],255,224|O.sps.length].concat(j).concat([O.pps.length]).concat(U))),et=O.width,G=O.height,ct=O.pixelRatio[0],yt=O.pixelRatio[1];return m.box(m.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,et>>8&255,255&et,G>>8&255,255&G,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),q,m.box(m.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),m.box(m.types.pasp,new Uint8Array([ct>>24,ct>>16&255,ct>>8&255,255&ct,yt>>24,yt>>16&255,yt>>8&255,255&yt])))},m.esds=function(O){var D=O.config.length;return new Uint8Array([0,0,0,0,3,23+D,0,1,0,4,15+D,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([D]).concat(O.config).concat([6,1,2]))},m.mp4a=function(O){var D=O.samplerate;return m.box(m.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,O.channelCount,0,16,0,0,0,0,D>>8&255,255&D,0,0]),m.box(m.types.esds,m.esds(O)))},m.mp3=function(O){var D=O.samplerate;return m.box(m.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,O.channelCount,0,16,0,0,0,0,D>>8&255,255&D,0,0]))},m.stsd=function(O){return O.type==="audio"?O.segmentCodec==="mp3"&&O.codec==="mp3"?m.box(m.types.stsd,m.STSD,m.mp3(O)):m.box(m.types.stsd,m.STSD,m.mp4a(O)):m.box(m.types.stsd,m.STSD,m.avc1(O))},m.tkhd=function(O){var D=O.id,V=O.duration*O.timescale,C=O.width,j=O.height,U=Math.floor(V/(I+1)),q=Math.floor(V%(I+1));return m.box(m.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,D>>24&255,D>>16&255,D>>8&255,255&D,0,0,0,0,U>>24,U>>16&255,U>>8&255,255&U,q>>24,q>>16&255,q>>8&255,255&q,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,C>>8&255,255&C,0,0,j>>8&255,255&j,0,0]))},m.traf=function(O,D){var V=m.sdtp(O),C=O.id,j=Math.floor(D/(I+1)),U=Math.floor(D%(I+1));return m.box(m.types.traf,m.box(m.types.tfhd,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,255&C])),m.box(m.types.tfdt,new Uint8Array([1,0,0,0,j>>24,j>>16&255,j>>8&255,255&j,U>>24,U>>16&255,U>>8&255,255&U])),m.trun(O,V.length+16+20+8+16+8+8),V)},m.trak=function(O){return O.duration=O.duration||4294967295,m.box(m.types.trak,m.tkhd(O),m.mdia(O))},m.trex=function(O){var D=O.id;return m.box(m.types.trex,new Uint8Array([0,0,0,0,D>>24,D>>16&255,D>>8&255,255&D,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},m.trun=function(O,D){var V,C,j,U,q,et,G=O.samples||[],ct=G.length,yt=12+16*ct,St=new Uint8Array(yt);for(D+=8+yt,St.set([0,0,15,1,ct>>>24&255,ct>>>16&255,ct>>>8&255,255&ct,D>>>24&255,D>>>16&255,D>>>8&255,255&D],0),V=0;V<ct;V++)j=(C=G[V]).duration,U=C.size,q=C.flags,et=C.cts,St.set([j>>>24&255,j>>>16&255,j>>>8&255,255&j,U>>>24&255,U>>>16&255,U>>>8&255,255&U,q.isLeading<<2|q.dependsOn,q.isDependedOn<<6|q.hasRedundancy<<4|q.paddingValue<<1|q.isNonSync,61440&q.degradPrio,15&q.degradPrio,et>>>24&255,et>>>16&255,et>>>8&255,255&et],12+16*V);return m.box(m.types.trun,St)},m.initSegment=function(O){m.types||m.init();var D=m.moov(O),V=new Uint8Array(m.FTYP.byteLength+D.byteLength);return V.set(m.FTYP),V.set(D,m.FTYP.byteLength),V},m}();c.types=void 0,c.HDLR_TYPES=void 0,c.STTS=void 0,c.STSC=void 0,c.STCO=void 0,c.STSZ=void 0,c.VMHD=void 0,c.SMHD=void 0,c.STSD=void 0,c.FTYP=void 0,c.DINF=void 0;var R=c,S=H(0),Y=H(2),B=H(1),_=H(4),P=H(9);function $(){return($=Object.assign?Object.assign.bind():function(m){for(var O=1;O<arguments.length;O++){var D=arguments[O];for(var V in D)Object.prototype.hasOwnProperty.call(D,V)&&(m[V]=D[V])}return m}).apply(this,arguments)}var nt=null,z=null,tt=!1,ot=function(){function m(D,V,C,j){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=D,this.config=V,this.typeSupported=C,this.ISGenerated=!1,nt===null){var U=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);nt=U?parseInt(U[1]):0}if(z===null){var q=navigator.userAgent.match(/Safari\/(\d+)/i);z=q?parseInt(q[1]):0}tt=!(nt&&nt>=75||z&&z>=600)}var O=m.prototype;return O.destroy=function(){},O.resetTimeStamp=function(D){B.b.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=D},O.resetNextTimestamp=function(){B.b.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},O.resetInitSegment=function(){B.b.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},O.getVideoStartPts=function(D){var V=!1,C=D.reduce(function(j,U){var q=U.pts-j;return q<-4294967296?(V=!0,rt(j,U.pts)):q>0?j:U.pts},D[0].pts);return V&&B.b.debug("PTS rollover detected"),C},O.remux=function(D,V,C,j,U,q,et,G){var ct,yt,St,lt,At,pt,It=U,Rt=U,Pt=D.pid>-1,Bt=V.pid>-1,Ot=V.samples.length,_t=D.samples.length>0,Kt=et&&Ot>0||Ot>1;if((!Pt||_t)&&(!Bt||Kt)||this.ISGenerated||et){this.ISGenerated||(St=this.generateIS(D,V,U));var wt,Ht=this.isVideoContiguous,Nt=-1;if(Kt&&(Nt=function(zt){for(var Gt=0;Gt<zt.length;Gt++)if(zt[Gt].key)return Gt;return-1}(V.samples),!Ht&&this.config.forceKeyFrameOnDiscontinuity))if(pt=!0,Nt>0){B.b.warn("[mp4-remuxer]: Dropped "+Nt+" out of "+Ot+" video samples due to a missing keyframe");var ee=this.getVideoStartPts(V.samples);V.samples=V.samples.slice(Nt),V.dropped+=Nt,wt=Rt+=(V.samples[0].pts-ee)/V.inputTimeScale}else Nt===-1&&(B.b.warn("[mp4-remuxer]: No keyframe found out of "+Ot+" video samples"),pt=!1);if(this.ISGenerated){if(_t&&Kt){var qt=this.getVideoStartPts(V.samples),ie=(rt(D.samples[0].pts,qt)-qt)/V.inputTimeScale;It+=Math.max(0,ie),Rt+=Math.max(0,-ie)}if(_t){if(D.samplerate||(B.b.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),St=this.generateIS(D,V,U)),yt=this.remuxAudio(D,It,this.isAudioContiguous,q,Bt||Kt||G===_.b.AUDIO?Rt:void 0),Kt){var oe=yt?yt.endPTS-yt.startPTS:0;V.inputTimeScale||(B.b.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),St=this.generateIS(D,V,U)),ct=this.remuxVideo(V,Rt,Ht,oe)}}else Kt&&(ct=this.remuxVideo(V,Rt,Ht,0));ct&&(ct.firstKeyFrame=Nt,ct.independent=Nt!==-1,ct.firstKeyFramePTS=wt)}}return this.ISGenerated&&(C.samples.length&&(At=J(C,U,this._initPTS,this._initDTS)),j.samples.length&&(lt=N(j,U,this._initPTS))),{audio:yt,video:ct,initSegment:St,independent:pt,text:lt,id3:At}},O.generateIS=function(D,V,C){var j,U,q,et=D.samples,G=V.samples,ct=this.typeSupported,yt={},St=!Object(X.a)(this._initPTS),lt="audio/mp4";if(St&&(j=U=1/0),D.config&&et.length){switch(D.timescale=D.samplerate,D.segmentCodec){case"mp3":ct.mpeg?(lt="audio/mpeg",D.codec=""):ct.mp3&&(D.codec="mp3")}yt.audio={id:"audio",container:lt,codec:D.codec,initSegment:D.segmentCodec==="mp3"&&ct.mpeg?new Uint8Array(0):R.initSegment([D]),metadata:{channelCount:D.channelCount}},St&&(q=D.inputTimeScale,j=U=et[0].pts-Math.round(q*C))}if(V.sps&&V.pps&&G.length&&(V.timescale=V.inputTimeScale,yt.video={id:"main",container:"video/mp4",codec:V.codec,initSegment:R.initSegment([V]),metadata:{width:V.width,height:V.height}},St)){q=V.inputTimeScale;var At=this.getVideoStartPts(G),pt=Math.round(q*C);U=Math.min(U,rt(G[0].dts,At)-pt),j=Math.min(j,At-pt)}if(Object.keys(yt).length)return this.ISGenerated=!0,St&&(this._initPTS=j,this._initDTS=U),{tracks:yt,initPTS:j,timescale:q}},O.remuxVideo=function(D,V,C,j){var U,q,et=D.inputTimeScale,G=D.samples,ct=[],yt=G.length,St=this._initPTS,lt=this.nextAvcDts,At=8,pt=this.videoSampleDuration,It=Number.POSITIVE_INFINITY,Rt=Number.NEGATIVE_INFINITY,Pt=0,Bt=!1;C&&lt!==null||(lt=V*et-(G[0].pts-rt(G[0].dts,G[0].pts)));for(var Ot=0;Ot<yt;Ot++){var _t=G[Ot];_t.pts=rt(_t.pts-St,lt),_t.dts=rt(_t.dts-St,lt),_t.dts>_t.pts&&(Pt=Math.max(Math.min(Pt,_t.pts-_t.dts),-18e3)),_t.dts<G[Ot>0?Ot-1:Ot].dts&&(Bt=!0)}Bt&&G.sort(function(Tt,mt){var Et=Tt.dts-mt.dts,kt=Tt.pts-mt.pts;return Et||kt}),U=G[0].dts;var Kt=(q=G[G.length-1].dts)-U,wt=Kt?Math.round(Kt/(yt-1)):pt||D.inputTimeScale/30;if(Pt<0){if(Pt<-2*wt){B.b.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(P.b)(-wt,!0)+" ms");for(var Ht=Pt,Nt=0;Nt<yt;Nt++)G[Nt].dts=Ht=Math.max(Ht,G[Nt].pts-wt),G[Nt].pts=Math.max(Ht,G[Nt].pts)}else{B.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(P.b)(Pt,!0)+" ms to overcome this issue");for(var ee=0;ee<yt;ee++)G[ee].dts=G[ee].dts+Pt}U=G[0].dts}if(C){var qt=U-lt,ie=qt>wt;if(ie||qt<-1){ie?B.b.warn("AVC: "+Object(P.b)(qt,!0)+" ms ("+qt+"dts) hole between fragments detected, filling it"):B.b.warn("AVC: "+Object(P.b)(-qt,!0)+" ms ("+qt+"dts) overlapping between fragments detected"),U=lt;var oe=G[0].pts-qt;G[0].dts=U,G[0].pts=oe,B.b.log("Video: First PTS/DTS adjusted: "+Object(P.b)(oe,!0)+"/"+Object(P.b)(U,!0)+", delta: "+Object(P.b)(qt,!0)+" ms")}}tt&&(U=Math.max(0,U));for(var zt=0,Gt=0,ne=0;ne<yt;ne++){for(var Xt=G[ne],ve=Xt.units,pe=ve.length,ae=0,te=0;te<pe;te++)ae+=ve[te].data.length;Gt+=ae,zt+=pe,Xt.length=ae,Xt.dts=Math.max(Xt.dts,U),Xt.pts=Math.max(Xt.pts,Xt.dts,0),It=Math.min(Xt.pts,It),Rt=Math.max(Xt.pts,Rt)}q=G[yt-1].dts;var de,se=Gt+4*zt+8;try{de=new Uint8Array(se)}catch{return void this.observer.emit(S.a.ERROR,S.a.ERROR,{type:Y.b.MUX_ERROR,details:Y.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:se,reason:"fail allocating video mdat "+se})}var Yt=new DataView(de.buffer);Yt.setUint32(0,se),de.set(R.types.mdat,4);for(var Le=!1,me=0;me<yt;me++){for(var Ee=G[me],Re=Ee.units,Se=0,F=0,L=Re.length;F<L;F++){var v=Re[F],T=v.data,b=v.data.byteLength;Yt.setUint32(At,b),At+=4,de.set(T,At),At+=b,Se+=4+b}if(me<yt-1)pt=G[me+1].dts-Ee.dts;else{var k=this.config,x=me>0?Ee.dts-G[me-1].dts:wt;if(k.stretchShortVideoTrack&&this.nextAudioPts!==null){var M=Math.floor(k.maxBufferHole*et),at=(j?It+j*et:this.nextAudioPts)-Ee.pts;at>M?((pt=at-x)<0?pt=x:Le=!0,B.b.log("[mp4-remuxer]: It is approximately "+at/90+" ms to the next segment; using duration "+pt/90+" ms for the last video frame.")):pt=x}else pt=x}var st=Math.round(Ee.pts-Ee.dts);ct.push(new K(Ee.key,pt,Se,st))}if(ct.length&&nt&&nt<70){var ut=ct[0].flags;ut.dependsOn=2,ut.isNonSync=0}pt=Le||!pt?wt:pt,this.nextAvcDts=lt=q+pt,this.videoSampleDuration=pt,this.isVideoContiguous=!0;var dt={data1:R.moof(D.sequenceNumber++,U,$({},D,{samples:ct})),data2:de,startPTS:It/et,endPTS:(Rt+pt)/et,startDTS:U/et,endDTS:lt/et,type:"video",hasAudio:!1,hasVideo:!0,nb:ct.length,dropped:D.dropped};return D.samples=[],D.dropped=0,dt},O.remuxAudio=function(D,V,C,j,U){var q=D.inputTimeScale,et=q/(D.samplerate?D.samplerate:q),G=D.segmentCodec==="aac"?1024:1152,ct=G*et,yt=this._initPTS,St=D.segmentCodec==="mp3"&&this.typeSupported.mpeg,lt=[],At=U!==void 0,pt=D.samples,It=St?0:8,Rt=this.nextAudioPts||-1,Pt=V*q;if(this.isAudioContiguous=C=C||pt.length&&Rt>0&&(j&&Math.abs(Pt-Rt)<9e3||Math.abs(rt(pt[0].pts-yt,Pt)-Rt)<20*ct),pt.forEach(function(L){L.pts=rt(L.pts-yt,Pt)}),!C||Rt<0){if(!(pt=pt.filter(function(L){return L.pts>=0})).length)return;Rt=U===0?0:j&&!At?Math.max(0,Pt):pt[0].pts}if(D.segmentCodec==="aac")for(var Bt=this.config.maxAudioFramesDrift,Ot=0,_t=Rt;Ot<pt.length;Ot++){var Kt=pt[Ot],wt=Kt.pts,Ht=wt-_t,Nt=Math.abs(1e3*Ht/q);if(Ht<=-Bt*ct&&At)Ot===0&&(B.b.warn("Audio frame @ "+(wt/q).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Ht/q)+" ms."),this.nextAudioPts=Rt=_t=wt);else if(Ht>=Bt*ct&&Nt<1e4&&At){var ee=Math.round(Ht/ct);(_t=wt-ee*ct)<0&&(ee--,_t+=ct),Ot===0&&(this.nextAudioPts=Rt=_t),B.b.warn("[mp4-remuxer]: Injecting "+ee+" audio frame @ "+(_t/q).toFixed(3)+"s due to "+Math.round(1e3*Ht/q)+" ms gap.");for(var qt=0;qt<ee;qt++){var ie=Math.max(_t,0),oe=w.getSilentFrame(D.manifestCodec||D.codec,D.channelCount);oe||(B.b.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),oe=Kt.unit.subarray()),pt.splice(Ot,0,{unit:oe,pts:ie}),_t+=ct,Ot++}}Kt.pts=_t,_t+=ct}for(var zt,Gt=null,ne=null,Xt=0,ve=pt.length;ve--;)Xt+=pt[ve].unit.byteLength;for(var pe=0,ae=pt.length;pe<ae;pe++){var te=pt[pe],de=te.unit,se=te.pts;if(ne!==null)lt[pe-1].duration=Math.round((se-ne)/et);else{if(C&&D.segmentCodec==="aac"&&(se=Rt),Gt=se,!(Xt>0))return;Xt+=It;try{zt=new Uint8Array(Xt)}catch{return void this.observer.emit(S.a.ERROR,S.a.ERROR,{type:Y.b.MUX_ERROR,details:Y.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:Xt,reason:"fail allocating audio mdat "+Xt})}St||(new DataView(zt.buffer).setUint32(0,Xt),zt.set(R.types.mdat,4))}zt.set(de,It);var Yt=de.byteLength;It+=Yt,lt.push(new K(!0,G,Yt,0)),ne=se}var Le=lt.length;if(Le){var me=lt[lt.length-1];this.nextAudioPts=Rt=ne+et*me.duration;var Ee=St?new Uint8Array(0):R.moof(D.sequenceNumber++,Gt/et,$({},D,{samples:lt}));D.samples=[];var Re=Gt/q,Se=Rt/q,F={data1:Ee,data2:zt,startPTS:Re,endPTS:Se,startDTS:Re,endDTS:Se,type:"audio",hasAudio:!0,hasVideo:!1,nb:Le};return this.isAudioContiguous=!0,F}},O.remuxEmptyAudio=function(D,V,C,j){var U=D.inputTimeScale,q=U/(D.samplerate?D.samplerate:U),et=this.nextAudioPts,G=(et!==null?et:j.startDTS*U)+this._initDTS,ct=j.endDTS*U+this._initDTS,yt=1024*q,St=Math.ceil((ct-G)/yt),lt=w.getSilentFrame(D.manifestCodec||D.codec,D.channelCount);if(B.b.warn("[mp4-remuxer]: remux empty Audio"),lt){for(var At=[],pt=0;pt<St;pt++){var It=G+pt*yt;At.push({unit:lt,pts:It,dts:It})}return D.samples=At,this.remuxAudio(D,V,C,!1)}B.b.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},m}();function rt(m,O){var D;if(O===null)return m;for(D=O<m?-8589934592:8589934592;Math.abs(m-O)>4294967296;)m+=D;return m}function J(m,O,D,V){var C=m.samples.length;if(C){for(var j=m.inputTimeScale,U=0;U<C;U++){var q=m.samples[U];q.pts=rt(q.pts-D,O*j)/j,q.dts=rt(q.dts-V,O*j)/j}var et=m.samples;return m.samples=[],{samples:et}}}function N(m,O,D){var V=m.samples.length;if(V){for(var C=m.inputTimeScale,j=0;j<V;j++){var U=m.samples[j];U.pts=rt(U.pts-D,O*C)/C}m.samples.sort(function(et,G){return et.pts-G.pts});var q=m.samples;return m.samples=[],{samples:q}}}var K=function(m,O,D,V){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=O,this.size=D,this.cts=V,this.flags=new vt(m)},vt=function(m){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=m?2:1,this.isNonSync=m?0:1}},function(Mt,ht,H){H.d(ht,"a",function(){return X});var X=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},function(Mt,ht,H){H.d(ht,"a",function(){return X});var X=function(){function w(){this.chunks=[],this.dataLength=0}var I=w.prototype;return I.push=function(c){this.chunks.push(c),this.dataLength+=c.length},I.flush=function(){var c,R=this.chunks,S=this.dataLength;return R.length?(c=R.length===1?R[0]:function(Y,B){for(var _=new Uint8Array(B),P=0,$=0;$<Y.length;$++){var nt=Y[$];_.set(nt,P),P+=nt.length}return _}(R,S),this.reset(),c):new Uint8Array(0)},I.reset=function(){this.chunks.length=0,this.dataLength=0},w}()},function(Mt,ht,H){var X=Object.prototype.hasOwnProperty,w="~";function I(){}function c(B,_,P){this.fn=B,this.context=_,this.once=P||!1}function R(B,_,P,$,nt){if(typeof P!="function")throw new TypeError("The listener must be a function");var z=new c(P,$||B,nt),tt=w?w+_:_;return B._events[tt]?B._events[tt].fn?B._events[tt]=[B._events[tt],z]:B._events[tt].push(z):(B._events[tt]=z,B._eventsCount++),B}function S(B,_){--B._eventsCount==0?B._events=new I:delete B._events[_]}function Y(){this._events=new I,this._eventsCount=0}Object.create&&(I.prototype=Object.create(null),new I().__proto__||(w=!1)),Y.prototype.eventNames=function(){var B,_,P=[];if(this._eventsCount===0)return P;for(_ in B=this._events)X.call(B,_)&&P.push(w?_.slice(1):_);return Object.getOwnPropertySymbols?P.concat(Object.getOwnPropertySymbols(B)):P},Y.prototype.listeners=function(B){var _=w?w+B:B,P=this._events[_];if(!P)return[];if(P.fn)return[P.fn];for(var $=0,nt=P.length,z=new Array(nt);$<nt;$++)z[$]=P[$].fn;return z},Y.prototype.listenerCount=function(B){var _=w?w+B:B,P=this._events[_];return P?P.fn?1:P.length:0},Y.prototype.emit=function(B,_,P,$,nt,z){var tt=w?w+B:B;if(!this._events[tt])return!1;var ot,rt,J=this._events[tt],N=arguments.length;if(J.fn){switch(J.once&&this.removeListener(B,J.fn,void 0,!0),N){case 1:return J.fn.call(J.context),!0;case 2:return J.fn.call(J.context,_),!0;case 3:return J.fn.call(J.context,_,P),!0;case 4:return J.fn.call(J.context,_,P,$),!0;case 5:return J.fn.call(J.context,_,P,$,nt),!0;case 6:return J.fn.call(J.context,_,P,$,nt,z),!0}for(rt=1,ot=new Array(N-1);rt<N;rt++)ot[rt-1]=arguments[rt];J.fn.apply(J.context,ot)}else{var K,vt=J.length;for(rt=0;rt<vt;rt++)switch(J[rt].once&&this.removeListener(B,J[rt].fn,void 0,!0),N){case 1:J[rt].fn.call(J[rt].context);break;case 2:J[rt].fn.call(J[rt].context,_);break;case 3:J[rt].fn.call(J[rt].context,_,P);break;case 4:J[rt].fn.call(J[rt].context,_,P,$);break;default:if(!ot)for(K=1,ot=new Array(N-1);K<N;K++)ot[K-1]=arguments[K];J[rt].fn.apply(J[rt].context,ot)}}return!0},Y.prototype.on=function(B,_,P){return R(this,B,_,P,!1)},Y.prototype.once=function(B,_,P){return R(this,B,_,P,!0)},Y.prototype.removeListener=function(B,_,P,$){var nt=w?w+B:B;if(!this._events[nt])return this;if(!_)return S(this,nt),this;var z=this._events[nt];if(z.fn)z.fn!==_||$&&!z.once||P&&z.context!==P||S(this,nt);else{for(var tt=0,ot=[],rt=z.length;tt<rt;tt++)(z[tt].fn!==_||$&&!z[tt].once||P&&z[tt].context!==P)&&ot.push(z[tt]);ot.length?this._events[nt]=ot.length===1?ot[0]:ot:S(this,nt)}return this},Y.prototype.removeAllListeners=function(B){var _;return B?(_=w?w+B:B,this._events[_]&&S(this,_)):(this._events=new I,this._eventsCount=0),this},Y.prototype.off=Y.prototype.removeListener,Y.prototype.addListener=Y.prototype.on,Y.prefixed=w,Y.EventEmitter=Y,Mt.exports=Y},function(Mt,ht,H){H.d(ht,"a",function(){return Y});var X=function(){function B(_,P){this.subtle=void 0,this.aesIV=void 0,this.subtle=_,this.aesIV=P}return B.prototype.decrypt=function(_,P){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},P,_)},B}(),w=function(){function B(_,P){this.subtle=void 0,this.key=void 0,this.subtle=_,this.key=P}return B.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},B}(),I=H(10),c=function(){function B(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var _=B.prototype;return _.uint8ArrayToUint32Array_=function(P){for(var $=new DataView(P),nt=new Uint32Array(4),z=0;z<4;z++)nt[z]=$.getUint32(4*z);return nt},_.initTable=function(){var P=this.sBox,$=this.invSBox,nt=this.subMix,z=nt[0],tt=nt[1],ot=nt[2],rt=nt[3],J=this.invSubMix,N=J[0],K=J[1],vt=J[2],m=J[3],O=new Uint32Array(256),D=0,V=0,C=0;for(C=0;C<256;C++)O[C]=C<128?C<<1:C<<1^283;for(C=0;C<256;C++){var j=V^V<<1^V<<2^V<<3^V<<4;j=j>>>8^255&j^99,P[D]=j,$[j]=D;var U=O[D],q=O[U],et=O[q],G=257*O[j]^16843008*j;z[D]=G<<24|G>>>8,tt[D]=G<<16|G>>>16,ot[D]=G<<8|G>>>24,rt[D]=G,G=16843009*et^65537*q^257*U^16843008*D,N[j]=G<<24|G>>>8,K[j]=G<<16|G>>>16,vt[j]=G<<8|G>>>24,m[j]=G,D?(D=U^O[O[O[et^U]]],V^=O[O[V]]):D=V=1}},_.expandKey=function(P){for(var $=this.uint8ArrayToUint32Array_(P),nt=!0,z=0;z<$.length&&nt;)nt=$[z]===this.key[z],z++;if(!nt){this.key=$;var tt=this.keySize=$.length;if(tt!==4&&tt!==6&&tt!==8)throw new Error("Invalid aes key size="+tt);var ot,rt,J,N,K=this.ksRows=4*(tt+6+1),vt=this.keySchedule=new Uint32Array(K),m=this.invKeySchedule=new Uint32Array(K),O=this.sBox,D=this.rcon,V=this.invSubMix,C=V[0],j=V[1],U=V[2],q=V[3];for(ot=0;ot<K;ot++)ot<tt?J=vt[ot]=$[ot]:(N=J,ot%tt==0?(N=O[(N=N<<8|N>>>24)>>>24]<<24|O[N>>>16&255]<<16|O[N>>>8&255]<<8|O[255&N],N^=D[ot/tt|0]<<24):tt>6&&ot%tt==4&&(N=O[N>>>24]<<24|O[N>>>16&255]<<16|O[N>>>8&255]<<8|O[255&N]),vt[ot]=J=(vt[ot-tt]^N)>>>0);for(rt=0;rt<K;rt++)ot=K-rt,N=3&rt?vt[ot]:vt[ot-4],m[rt]=rt<4||ot<=4?N:C[O[N>>>24]]^j[O[N>>>16&255]]^U[O[N>>>8&255]]^q[O[255&N]],m[rt]=m[rt]>>>0}},_.networkToHostOrderSwap=function(P){return P<<24|(65280&P)<<8|(16711680&P)>>8|P>>>24},_.decrypt=function(P,$,nt){for(var z,tt,ot,rt,J,N,K,vt,m,O,D,V,C,j,U=this.keySize+6,q=this.invKeySchedule,et=this.invSBox,G=this.invSubMix,ct=G[0],yt=G[1],St=G[2],lt=G[3],At=this.uint8ArrayToUint32Array_(nt),pt=At[0],It=At[1],Rt=At[2],Pt=At[3],Bt=new Int32Array(P),Ot=new Int32Array(Bt.length),_t=this.networkToHostOrderSwap;$<Bt.length;){for(m=_t(Bt[$]),O=_t(Bt[$+1]),D=_t(Bt[$+2]),V=_t(Bt[$+3]),J=m^q[0],N=V^q[1],K=D^q[2],vt=O^q[3],C=4,j=1;j<U;j++)z=ct[J>>>24]^yt[N>>16&255]^St[K>>8&255]^lt[255&vt]^q[C],tt=ct[N>>>24]^yt[K>>16&255]^St[vt>>8&255]^lt[255&J]^q[C+1],ot=ct[K>>>24]^yt[vt>>16&255]^St[J>>8&255]^lt[255&N]^q[C+2],rt=ct[vt>>>24]^yt[J>>16&255]^St[N>>8&255]^lt[255&K]^q[C+3],J=z,N=tt,K=ot,vt=rt,C+=4;z=et[J>>>24]<<24^et[N>>16&255]<<16^et[K>>8&255]<<8^et[255&vt]^q[C],tt=et[N>>>24]<<24^et[K>>16&255]<<16^et[vt>>8&255]<<8^et[255&J]^q[C+1],ot=et[K>>>24]<<24^et[vt>>16&255]<<16^et[J>>8&255]<<8^et[255&N]^q[C+2],rt=et[vt>>>24]<<24^et[J>>16&255]<<16^et[N>>8&255]<<8^et[255&K]^q[C+3],Ot[$]=_t(z^pt),Ot[$+1]=_t(rt^It),Ot[$+2]=_t(ot^Rt),Ot[$+3]=_t(tt^Pt),pt=m,It=O,Rt=D,Pt=V,$+=4}return Ot.buffer},B}(),R=H(1),S=H(5),Y=function(){function B(P,$,nt){var z=(nt===void 0?{}:nt).removePKCS7Padding,tt=z===void 0||z;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=P,this.config=$,this.removePKCS7Padding=tt,tt)try{var ot=self.crypto;ot&&(this.subtle=ot.subtle||ot.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var _=B.prototype;return _.destroy=function(){this.observer=null},_.isSync=function(){return this.config.enableSoftwareAES},_.flush=function(){var P=this.currentResult;if(P){var $,nt,z,tt=new Uint8Array(P);return this.reset(),this.removePKCS7Padding?(nt=($=tt).byteLength,(z=nt&&new DataView($.buffer).getUint8(nt-1))?Object(I.a)($,0,nt-z):$):tt}this.reset()},_.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},_.decrypt=function(P,$,nt,z){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(P),$,nt);var tt=this.flush();tt&&z(tt.buffer)}else this.webCryptoDecrypt(new Uint8Array(P),$,nt).then(z)},_.softwareDecrypt=function(P,$,nt){var z=this.currentIV,tt=this.currentResult,ot=this.remainderData;this.logOnce("JS AES decrypt"),ot&&(P=Object(S.b)(ot,P),this.remainderData=null);var rt=this.getValidChunk(P);if(!rt.length)return null;z&&(nt=z);var J=this.softwareDecrypter;J||(J=this.softwareDecrypter=new c),J.expandKey($);var N=tt;return this.currentResult=J.decrypt(rt.buffer,0,nt),this.currentIV=Object(I.a)(rt,-16).buffer,N||null},_.webCryptoDecrypt=function(P,$,nt){var z=this,tt=this.subtle;return this.key===$&&this.fastAesKey||(this.key=$,this.fastAesKey=new w(tt,$)),this.fastAesKey.expandKey().then(function(ot){return tt?new X(tt,nt).decrypt(P.buffer,ot):Promise.reject(new Error("web crypto not initialized"))}).catch(function(ot){return z.onWebCryptoError(ot,P,$,nt)})},_.onWebCryptoError=function(P,$,nt,z){return R.b.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",P),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt($,nt,z)},_.getValidChunk=function(P){var $=P,nt=P.length-P.length%16;return nt!==P.length&&($=Object(I.a)(P,0,nt),this.remainderData=Object(I.a)(P,nt)),$},_.logOnce=function(P){this.logEnabled&&(R.b.log("[decrypter.ts]: "+P),this.logEnabled=!1)},B}()},function(Mt,ht,H){H.d(ht,"a",function(){return I});var X=H(12);function w(c,R){for(var S=0;S<R.length;S++){var Y=R[S];Y.enumerable=Y.enumerable||!1,Y.configurable=!0,"value"in Y&&(Y.writable=!0),Object.defineProperty(c,Y.key,Y)}}var I=function(){function c(Y,B){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=B?Object(X.buildAbsoluteURL)(Y,B,{alwaysNormalize:!0}):Y}var R,S;return c.fromURL=function(Y,B){return new c(Y,B)},c.fromURI=function(Y){return new c(Y)},R=c,(S=[{key:"uri",get:function(){return this._uri}}])&&w(R.prototype,S),Object.defineProperty(R,"prototype",{writable:!1}),c}()},function(Mt,ht,H){function X(R){var S={};function Y(_){if(S[_])return S[_].exports;var P=S[_]={i:_,l:!1,exports:{}};return R[_].call(P.exports,P,P.exports,Y),P.l=!0,P.exports}Y.m=R,Y.c=S,Y.i=function(_){return _},Y.d=function(_,P,$){Y.o(_,P)||Object.defineProperty(_,P,{configurable:!1,enumerable:!0,get:$})},Y.r=function(_){Object.defineProperty(_,"__esModule",{value:!0})},Y.n=function(_){var P=_&&_.__esModule?function(){return _.default}:function(){return _};return Y.d(P,"a",P),P},Y.o=function(_,P){return Object.prototype.hasOwnProperty.call(_,P)},Y.p="/",Y.oe=function(_){throw console.error(_),_};var B=Y(Y.s=ENTRY_MODULE);return B.default||B}function w(R){return(R+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function I(R,S,Y){var B={};B[Y]=[];var _=S.toString(),P=_.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!P)return B;for(var $,nt=P[1],z=new RegExp("(\\\\n|\\W)"+w(nt)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");$=z.exec(_);)$[3]!=="dll-reference"&&B[Y].push($[3]);for(z=new RegExp("\\("+w(nt)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");$=z.exec(_);)R[$[2]]||(B[Y].push($[1]),R[$[2]]=H($[1]).m),B[$[2]]=B[$[2]]||[],B[$[2]].push($[4]);for(var tt,ot=Object.keys(B),rt=0;rt<ot.length;rt++)for(var J=0;J<B[ot[rt]].length;J++)tt=B[ot[rt]][J],isNaN(1*tt)||(B[ot[rt]][J]=1*B[ot[rt]][J]);return B}function c(R){return Object.keys(R).reduce(function(S,Y){return S||R[Y].length>0},!1)}Mt.exports=function(R,S){S=S||{};var Y={main:H.m},B=S.all?{main:Object.keys(Y.main)}:function(z,tt){for(var ot={main:[tt]},rt={main:[]},J={main:{}};c(ot);)for(var N=Object.keys(ot),K=0;K<N.length;K++){var vt=N[K],m=ot[vt].pop();if(J[vt]=J[vt]||{},!J[vt][m]&&z[vt][m]){J[vt][m]=!0,rt[vt]=rt[vt]||[],rt[vt].push(m);for(var O=I(z,z[vt][m],vt),D=Object.keys(O),V=0;V<D.length;V++)ot[D[V]]=ot[D[V]]||[],ot[D[V]]=ot[D[V]].concat(O[D[V]])}}return rt}(Y,R),_="";Object.keys(B).filter(function(z){return z!=="main"}).forEach(function(z){for(var tt=0;B[z][tt];)tt++;B[z].push(tt),Y[z][tt]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",_=_+"var "+z+" = ("+X.toString().replace("ENTRY_MODULE",JSON.stringify(tt))+")({"+B[z].map(function(ot){return JSON.stringify(ot)+": "+Y[z][ot].toString()}).join(",")+`});
`}),_=_+"new (("+X.toString().replace("ENTRY_MODULE",JSON.stringify(R))+")({"+B.main.map(function(z){return JSON.stringify(z)+": "+Y.main[z].toString()}).join(",")+"}))(self);";var P=new window.Blob([_],{type:"text/javascript"});if(S.bare)return P;var $=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(P),nt=new window.Worker($);return nt.objectURL=$,nt}},function(Mt,ht,H){H.r(ht),H.d(ht,"default",function(){return R});var X=H(11),w=H(0),I=H(1),c=H(16);function R(_){var P=new c.EventEmitter,$=function(nt,z){_.postMessage({event:nt,data:z})};P.on(w.a.FRAG_DECRYPTED,$),P.on(w.a.ERROR,$),_.addEventListener("message",function(nt){var z=nt.data;switch(z.cmd){case"init":var tt=JSON.parse(z.config);_.transmuxer=new X.c(P,z.typeSupported,tt,z.vendor,z.id),Object(I.a)(tt.debug),$("init",null);break;case"configure":_.transmuxer.configure(z.config);break;case"demux":var ot=_.transmuxer.push(z.data,z.decryptdata,z.chunkMeta,z.state);Object(X.d)(ot)?ot.then(function(N){S(_,N)}):S(_,ot);break;case"flush":var rt=z.chunkMeta,J=_.transmuxer.flush(rt);Object(X.d)(J)?J.then(function(N){B(_,N,rt)}):B(_,J,rt)}})}function S(_,P){if(!(($=P.remuxResult).audio||$.video||$.text||$.id3||$.initSegment))return!1;var $,nt=[],z=P.remuxResult,tt=z.audio,ot=z.video;return tt&&Y(nt,tt),ot&&Y(nt,ot),_.postMessage({event:"transmuxComplete",data:P},nt),!0}function Y(_,P){P.data1&&_.push(P.data1.buffer),P.data2&&_.push(P.data2.buffer)}function B(_,P,$){P.reduce(function(nt,z){return S(_,z)||nt},!1)||_.postMessage({event:"transmuxComplete",data:P[0]}),_.postMessage({event:"flush",data:$})}},function(Mt,ht,H){H.r(ht),H.d(ht,"default",function(){return Si});var X,w=H(12),I=H(3),c=H(0),R=H(2),S=H(1),Y=H(5),B=/^(\d+)x(\d+)$/,_=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,P=function(){function h(t){for(var e in typeof t=="string"&&(t=h.parseAttrList(t)),t)t.hasOwnProperty(e)&&(this[e]=t[e])}var o=h.prototype;return o.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},o.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var i=new Uint8Array(e.length/2),n=0;n<e.length/2;n++)i[n]=parseInt(e.slice(2*n,2*n+2),16);return i}return null},o.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},o.decimalFloatingPoint=function(t){return parseFloat(this[t])},o.optionalFloat=function(t,e){var i=this[t];return i?parseFloat(i):e},o.enumeratedString=function(t){return this[t]},o.bool=function(t){return this[t]==="YES"},o.decimalResolution=function(t){var e=B.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},h.parseAttrList=function(t){var e,i={};for(_.lastIndex=0;(e=_.exec(t))!==null;){var n=e[2];n.indexOf('"')===0&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[e[1]]=n}return i},h}();function $(){return($=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])}return h}).apply(this,arguments)}function nt(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}(function(h){h.ID="ID",h.CLASS="CLASS",h.START_DATE="START-DATE",h.DURATION="DURATION",h.END_DATE="END-DATE",h.END_ON_NEXT="END-ON-NEXT",h.PLANNED_DURATION="PLANNED-DURATION",h.SCTE35_OUT="SCTE35-OUT",h.SCTE35_IN="SCTE35-IN"})(X||(X={}));var z=function(){function h(e,i){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,i){var n=i.attr;for(var s in n)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]!==n[s]){S.b.warn('DATERANGE tag attribute: "'+s+'" does not match for tags with ID: "'+e.ID+'"'),this._badValueForSameId=s;break}e=$(new P({}),n,e)}if(this.attr=e,this._startDate=new Date(e[X.START_DATE]),X.END_DATE in this.attr){var r=new Date(this.attr[X.END_DATE]);Object(I.a)(r.getTime())&&(this._endDate=r)}}var o,t;return o=h,(t=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var e=this.duration;return e!==null?new Date(this._startDate.getTime()+1e3*e):null}},{key:"duration",get:function(){if(X.DURATION in this.attr){var e=this.attr.decimalFloatingPoint(X.DURATION);if(Object(I.a)(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return X.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(X.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(X.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(I.a)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&nt(o.prototype,t),Object.defineProperty(o,"prototype",{writable:!1}),h}(),tt=H(6);function ot(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}var rt=function(){function h(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=e}var o,t;return h.prototype.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var i=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!i,this.advanced=this.endSN>e.endSN||i>0||i===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},o=h,(t=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(I.a)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return(e=this.partList)!==null&&e!==void 0&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return(e=this.fragments)!==null&&e!==void 0&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return(e=this.partList)!==null&&e!==void 0&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return(e=this.partList)!==null&&e!==void 0&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&ot(o.prototype,t),Object.defineProperty(o,"prototype",{writable:!1}),h}(),J=H(18),N={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function K(h,o){return MediaSource.isTypeSupported((o||"video")+'/mp4;codecs="'+h+'"')}var vt=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,m=/#EXT-X-MEDIA:(.*)/g,O=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),D=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),V=/\.(mp4|m4s|m4v|m4a)$/i,C=function(){function h(){}return h.findGroup=function(o,t){for(var e=0;e<o.length;e++){var i=o[e];if(i.id===t)return i}},h.convertAVC1ToAVCOTI=function(o){var t=o.split(".");if(t.length>2){var e=t.shift()+".";return e+=parseInt(t.shift()).toString(16),e+=("000"+parseInt(t.shift()).toString(16)).slice(-4)}return o},h.resolve=function(o,t){return w.buildAbsoluteURL(t,o,{alwaysNormalize:!0})},h.parseMasterPlaylist=function(o,t){var e,i=[],n={},s=!1;for(vt.lastIndex=0;(e=vt.exec(o))!=null;)if(e[1]){var r=new P(e[1]),a={attrs:r,bitrate:r.decimalInteger("AVERAGE-BANDWIDTH")||r.decimalInteger("BANDWIDTH"),name:r.NAME,url:h.resolve(e[2],t)},l=r.decimalResolution("RESOLUTION");l&&(a.width=l.width,a.height=l.height),j((r.CODECS||"").split(/[ ,]+/).filter(function(d){return d}),a),a.videoCodec&&a.videoCodec.indexOf("avc1")!==-1&&(a.videoCodec=h.convertAVC1ToAVCOTI(a.videoCodec)),i.push(a)}else if(e[3]){var u=new P(e[3]);u["DATA-ID"]&&(s=!0,n[u["DATA-ID"]]=u)}return{levels:i,sessionData:s?n:null}},h.parseMasterPlaylistMedia=function(o,t,e,i){var n;i===void 0&&(i=[]);var s=[],r=0;for(m.lastIndex=0;(n=m.exec(o))!==null;){var a=new P(n[1]);if(a.TYPE===e){var l={attrs:a,bitrate:0,id:r++,groupId:a["GROUP-ID"],instreamId:a["INSTREAM-ID"],name:a.NAME||a.LANGUAGE||"",type:e,default:a.bool("DEFAULT"),autoselect:a.bool("AUTOSELECT"),forced:a.bool("FORCED"),lang:a.LANGUAGE,url:a.URI?h.resolve(a.URI,t):""};if(i.length){var u=h.findGroup(i,l.groupId)||i[0];U(l,u,"audioCodec"),U(l,u,"textCodec")}s.push(l)}}return s},h.parseLevelPlaylist=function(o,t,e,i,n){var s,r,a,l=new rt(t),u=l.fragments,d=null,f=0,g=0,p=0,y=0,A=null,E=new tt.b(i,t),W=-1,Z=!1;for(O.lastIndex=0,l.m3u8=o;(s=O.exec(o))!==null;){Z&&(Z=!1,(E=new tt.b(i,t)).start=p,E.sn=f,E.cc=y,E.level=e,d&&(E.initSegment=d,E.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));var Q=s[1];if(Q){E.duration=parseFloat(Q);var it=(" "+s[2]).slice(1);E.title=it||null,E.tagList.push(it?["INF",Q,it]:["INF",Q])}else if(s[3])Object(I.a)(E.duration)&&(E.start=p,a&&(E.levelkey=a),E.sn=f,E.level=e,E.cc=y,E.urlId=n,u.push(E),E.relurl=(" "+s[3]).slice(1),q(E,A),A=E,p+=E.duration,f++,g=0,Z=!0);else if(s[4]){var ft=(" "+s[4]).slice(1);A?E.setByteRange(ft,A):E.setByteRange(ft)}else if(s[5])E.rawProgramDateTime=(" "+s[5]).slice(1),E.tagList.push(["PROGRAM-DATE-TIME",E.rawProgramDateTime]),W===-1&&(W=u.length);else{if(!(s=s[0].match(D))){S.b.warn("No matches on slow regex match for level playlist!");continue}for(r=1;r<s.length&&s[r]===void 0;r++);var bt=(" "+s[r]).slice(1),gt=(" "+s[r+1]).slice(1),Lt=s[r+2]?(" "+s[r+2]).slice(1):"";switch(bt){case"PLAYLIST-TYPE":l.type=gt.toUpperCase();break;case"MEDIA-SEQUENCE":f=l.startSN=parseInt(gt);break;case"SKIP":var jt=new P(gt),Vt=jt.decimalInteger("SKIPPED-SEGMENTS");if(Object(I.a)(Vt)){l.skippedSegments=Vt;for(var re=Vt;re--;)u.unshift(null);f+=Vt}var $t=jt.enumeratedString("RECENTLY-REMOVED-DATERANGES");$t&&(l.recentlyRemovedDateranges=$t.split("	"));break;case"TARGETDURATION":l.targetduration=parseFloat(gt);break;case"VERSION":l.version=parseInt(gt);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"#":(gt||Lt)&&E.tagList.push(Lt?[gt,Lt]:[gt]);break;case"DISCONTINUITY":y++,E.tagList.push(["DIS"]);break;case"GAP":E.tagList.push([bt]);break;case"BITRATE":E.tagList.push([bt,gt]);break;case"DATERANGE":var he=new P(gt),ge=new z(he,l.dateRanges[he.ID]);ge.isValid||l.skippedSegments?l.dateRanges[ge.id]=ge:S.b.warn('Ignoring invalid DATERANGE tag: "'+gt+'"'),E.tagList.push(["EXT-X-DATERANGE",gt]);break;case"DISCONTINUITY-SEQUENCE":y=parseInt(gt);break;case"KEY":var Jt,Zt=new P(gt),be=Zt.enumeratedString("METHOD"),Te=Zt.URI,De=Zt.hexadecimalInteger("IV"),_e=Zt.enumeratedString("KEYFORMATVERSIONS"),Li=Zt.enumeratedString("KEYID"),ar=(Jt=Zt.enumeratedString("KEYFORMAT"))!=null?Jt:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(ar)>-1){S.b.warn("Keyformat "+ar+" is not supported from the manifest");continue}if(ar!=="identity")continue;be&&(a=J.a.fromURL(t,Te),Te&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(be)>=0&&(a.method=be,a.keyFormat=ar,Li&&(a.keyID=Li),_e&&(a.keyFormatVersions=_e),a.iv=De));break;case"START":var Ai=new P(gt).decimalFloatingPoint("TIME-OFFSET");Object(I.a)(Ai)&&(l.startTimeOffset=Ai);break;case"MAP":var Di=new P(gt);if(E.duration){var Ri=new tt.b(i,t);et(Ri,Di,e,a),d=Ri,E.initSegment=d,d.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=d.rawProgramDateTime)}else et(E,Di,e,a),d=E,Z=!0;break;case"SERVER-CONTROL":var Ve=new P(gt);l.canBlockReload=Ve.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=Ve.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&Ve.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=Ve.optionalFloat("PART-HOLD-BACK",0),l.holdBack=Ve.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var On=new P(gt);l.partTarget=On.decimalFloatingPoint("PART-TARGET");break;case"PART":var Ye=l.partList;Ye||(Ye=l.partList=[]);var Cn=g>0?Ye[Ye.length-1]:void 0,wn=g++,_i=new tt.c(new P(gt),E,t,wn,Cn);Ye.push(_i),E.duration+=_i.duration;break;case"PRELOAD-HINT":var xn=new P(gt);l.preloadHint=xn;break;case"RENDITION-REPORT":var Pn=new P(gt);l.renditionReports=l.renditionReports||[],l.renditionReports.push(Pn);break;default:S.b.warn("line parsed but not handled: "+s)}}}A&&!A.relurl?(u.pop(),p-=A.duration,l.partList&&(l.fragmentHint=A)):l.partList&&(q(E,A),E.cc=y,l.fragmentHint=E);var Rr=u.length,sr=u[0],_r=u[Rr-1];if((p+=l.skippedSegments*l.targetduration)>0&&Rr&&_r){l.averagetargetduration=p/Rr;var ki=_r.sn;l.endSN=ki!=="initSegment"?ki:0,sr&&(l.startCC=sr.cc,sr.initSegment||l.fragments.every(function(We){return We.relurl&&(qe=We.relurl,V.test((ze=(je=w.parseURL(qe))===null||je===void 0?void 0:je.path)!=null?ze:""));var qe,ze,je})&&(S.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(E=new tt.b(i,t)).relurl=_r.relurl,E.level=e,E.sn="initSegment",sr.initSegment=E,l.needSidxRanges=!0))}else l.endSN=0,l.startCC=0;return l.fragmentHint&&(p+=l.fragmentHint.duration),l.totalduration=p,l.endCC=y,W>0&&function(We,qe){for(var ze=We[qe],je=qe;je--;){var or=We[je];if(!or)return;or.programDateTime=ze.programDateTime-1e3*or.duration,ze=or}}(u,W),l},h}();function j(h,o){["video","audio","text"].forEach(function(t){var e=h.filter(function(n){return function(s,r){var a=N[r];return!!a&&a[s.slice(0,4)]===!0}(n,t)});if(e.length){var i=e.filter(function(n){return n.lastIndexOf("avc1",0)===0||n.lastIndexOf("mp4a",0)===0});o[t+"Codec"]=i.length>0?i[0]:e[0],h=h.filter(function(n){return e.indexOf(n)===-1})}}),o.unknownCodecs=h}function U(h,o,t){var e=o[t];e&&(h[t]=e)}function q(h,o){h.rawProgramDateTime?h.programDateTime=Date.parse(h.rawProgramDateTime):o!=null&&o.programDateTime&&(h.programDateTime=o.endProgramDateTime),Object(I.a)(h.programDateTime)||(h.programDateTime=null,h.rawProgramDateTime=null)}function et(h,o,t,e){h.relurl=o.URI,o.BYTERANGE&&h.setByteRange(o.BYTERANGE),h.level=t,h.sn="initSegment",e&&(h.levelkey=e),h.initSegment=null}var G=H(4);function ct(h,o){var t=h.url;return t!==void 0&&t.indexOf("data:")!==0||(t=o.url),t}var yt=function(){function h(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var o=h.prototype;return o.registerListeners=function(){var t=this.hls;t.on(c.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(c.a.LEVEL_LOADING,this.onLevelLoading,this),t.on(c.a.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(c.a.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},o.unregisterListeners=function(){var t=this.hls;t.off(c.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(c.a.LEVEL_LOADING,this.onLevelLoading,this),t.off(c.a.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(c.a.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},o.createInternalLoader=function(t){var e=this.hls.config,i=e.pLoader,n=e.loader,s=new(i||n)(e);return t.loader=s,this.loaders[t.type]=s,s},o.getInternalLoader=function(t){return this.loaders[t.type]},o.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},o.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},o.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},o.onManifestLoading=function(t,e){var i=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:G.a.MANIFEST,url:i,deliveryDirectives:null})},o.onLevelLoading=function(t,e){var i=e.id,n=e.level,s=e.url,r=e.deliveryDirectives;this.load({id:i,groupId:null,level:n,responseType:"text",type:G.a.LEVEL,url:s,deliveryDirectives:r})},o.onAudioTrackLoading=function(t,e){var i=e.id,n=e.groupId,s=e.url,r=e.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:G.a.AUDIO_TRACK,url:s,deliveryDirectives:r})},o.onSubtitleTrackLoading=function(t,e){var i=e.id,n=e.groupId,s=e.url,r=e.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:G.a.SUBTITLE_TRACK,url:s,deliveryDirectives:r})},o.load=function(t){var e,i,n,s,r,a,l=this.hls.config,u=this.getInternalLoader(t);if(u){var d=u.context;if(d&&d.url===t.url)return void S.b.trace("[playlist-loader]: playlist request ongoing");S.b.log("[playlist-loader]: aborting previous loader for type: "+t.type),u.abort()}switch(t.type){case G.a.MANIFEST:i=l.manifestLoadingMaxRetry,n=l.manifestLoadingTimeOut,s=l.manifestLoadingRetryDelay,r=l.manifestLoadingMaxRetryTimeout;break;case G.a.LEVEL:case G.a.AUDIO_TRACK:case G.a.SUBTITLE_TRACK:i=0,n=l.levelLoadingTimeOut;break;default:i=l.levelLoadingMaxRetry,n=l.levelLoadingTimeOut,s=l.levelLoadingRetryDelay,r=l.levelLoadingMaxRetryTimeout}if(u=this.createInternalLoader(t),(e=t.deliveryDirectives)!==null&&e!==void 0&&e.part&&(t.type===G.a.LEVEL&&t.level!==null?a=this.hls.levels[t.level].details:t.type===G.a.AUDIO_TRACK&&t.id!==null?a=this.hls.audioTracks[t.id].details:t.type===G.a.SUBTITLE_TRACK&&t.id!==null&&(a=this.hls.subtitleTracks[t.id].details),a)){var f=a.partTarget,g=a.targetduration;f&&g&&(n=Math.min(1e3*Math.max(3*f,.8*g),n))}var p={timeout:n,maxRetry:i,retryDelay:s,maxRetryDelay:r,highWaterMark:0},y={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(t,p,y)},o.loadsuccess=function(t,e,i,n){if(n===void 0&&(n=null),i.isSidxRequest)return this.handleSidxRequest(t,i),void this.handlePlaylistLoaded(t,e,i,n);this.resetInternalLoader(i.type);var s=t.data;s.indexOf("#EXTM3U")===0?(e.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,e,i,n):this.handleMasterPlaylist(t,e,i,n)):this.handleManifestParsingError(t,i,"no EXTM3U delimiter",n)},o.loaderror=function(t,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!1,t)},o.loadtimeout=function(t,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!0)},o.handleMasterPlaylist=function(t,e,i,n){var s=this.hls,r=t.data,a=ct(t,i),l=C.parseMasterPlaylist(r,a),u=l.levels,d=l.sessionData;if(u.length){var f=u.map(function(E){return{id:E.attrs.AUDIO,audioCodec:E.audioCodec}}),g=u.map(function(E){return{id:E.attrs.SUBTITLES,textCodec:E.textCodec}}),p=C.parseMasterPlaylistMedia(r,a,"AUDIO",f),y=C.parseMasterPlaylistMedia(r,a,"SUBTITLES",g),A=C.parseMasterPlaylistMedia(r,a,"CLOSED-CAPTIONS");p.length&&(p.some(function(E){return!E.url})||!u[0].audioCodec||u[0].attrs.AUDIO||(S.b.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new P({}),bitrate:0,url:""}))),s.trigger(c.a.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:y,captions:A,url:a,stats:e,networkDetails:n,sessionData:d})}else this.handleManifestParsingError(t,i,"no level found in manifest",n)},o.handleTrackOrLevelPlaylist=function(t,e,i,n){var s=this.hls,r=i.id,a=i.level,l=i.type,u=ct(t,i),d=Object(I.a)(r)?r:0,f=Object(I.a)(a)?a:d,g=function(W){switch(W.type){case G.a.AUDIO_TRACK:return G.b.AUDIO;case G.a.SUBTITLE_TRACK:return G.b.SUBTITLE;default:return G.b.MAIN}}(i),p=C.parseLevelPlaylist(t.data,u,f,g,d);if(p.fragments.length){if(l===G.a.MANIFEST){var y={attrs:new P({}),bitrate:0,details:p,name:"",url:u};s.trigger(c.a.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:u,stats:e,networkDetails:n,sessionData:null})}if(e.parsing.end=performance.now(),p.needSidxRanges){var A,E=(A=p.fragments[0].initSegment)===null||A===void 0?void 0:A.url;this.load({url:E,isSidxRequest:!0,type:l,level:a,levelDetails:p,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=p,this.handlePlaylistLoaded(t,e,i,n)}else s.trigger(c.a.ERROR,{type:R.b.NETWORK_ERROR,details:R.a.LEVEL_EMPTY_ERROR,fatal:!1,url:u,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},o.handleSidxRequest=function(t,e){var i=Object(Y.k)(new Uint8Array(t.data));if(i){var n=i.references,s=e.levelDetails;n.forEach(function(r,a){var l=r.info,u=s.fragments[a];u.byteRange.length===0&&u.setByteRange(String(1+l.end-l.start)+"@"+String(l.start)),u.initSegment&&u.initSegment.setByteRange(String(i.moovEndOffset)+"@0")})}},o.handleManifestParsingError=function(t,e,i,n){this.hls.trigger(c.a.ERROR,{type:R.b.NETWORK_ERROR,details:R.a.MANIFEST_PARSING_ERROR,fatal:e.type===G.a.MANIFEST,url:t.url,reason:i,response:t,context:e,networkDetails:n})},o.handleNetworkError=function(t,e,i,n){i===void 0&&(i=!1),S.b.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var s=R.a.UNKNOWN,r=!1,a=this.getInternalLoader(t);switch(t.type){case G.a.MANIFEST:s=i?R.a.MANIFEST_LOAD_TIMEOUT:R.a.MANIFEST_LOAD_ERROR,r=!0;break;case G.a.LEVEL:s=i?R.a.LEVEL_LOAD_TIMEOUT:R.a.LEVEL_LOAD_ERROR,r=!1;break;case G.a.AUDIO_TRACK:s=i?R.a.AUDIO_TRACK_LOAD_TIMEOUT:R.a.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case G.a.SUBTITLE_TRACK:s=i?R.a.SUBTITLE_TRACK_LOAD_TIMEOUT:R.a.SUBTITLE_LOAD_ERROR,r=!1}a&&this.resetInternalLoader(t.type);var l={type:R.b.NETWORK_ERROR,details:s,fatal:r,url:t.url,loader:a,context:t,networkDetails:e};n&&(l.response=n),this.hls.trigger(c.a.ERROR,l)},o.handlePlaylistLoaded=function(t,e,i,n){var s=i.type,r=i.level,a=i.id,l=i.groupId,u=i.loader,d=i.levelDetails,f=i.deliveryDirectives;if(d!=null&&d.targetduration){if(u)switch(d.live&&(u.getCacheAge&&(d.ageHeader=u.getCacheAge()||0),u.getCacheAge&&!isNaN(d.ageHeader)||(d.ageHeader=0)),s){case G.a.MANIFEST:case G.a.LEVEL:this.hls.trigger(c.a.LEVEL_LOADED,{details:d,level:r||0,id:a||0,stats:e,networkDetails:n,deliveryDirectives:f});break;case G.a.AUDIO_TRACK:this.hls.trigger(c.a.AUDIO_TRACK_LOADED,{details:d,id:a||0,groupId:l||"",stats:e,networkDetails:n,deliveryDirectives:f});break;case G.a.SUBTITLE_TRACK:this.hls.trigger(c.a.SUBTITLE_TRACK_LOADED,{details:d,id:a||0,groupId:l||"",stats:e,networkDetails:n,deliveryDirectives:f})}}else this.handleManifestParsingError(t,i,"invalid target duration",n)},h}(),St=function(){function h(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this._registerListeners()}var o=h.prototype;return o._registerListeners=function(){this.hls.on(c.a.KEY_LOADING,this.onKeyLoading,this)},o._unregisterListeners=function(){this.hls.off(c.a.KEY_LOADING,this.onKeyLoading)},o.destroy=function(){for(var t in this._unregisterListeners(),this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={}},o.onKeyLoading=function(t,e){var i=e.frag,n=i.type,s=this.loaders[n];if(i.decryptdata){var r=i.decryptdata.uri;if(r!==this.decrypturl||this.decryptkey===null){var a=this.hls.config;if(s&&(S.b.warn("abort previous key loader for type:"+n),s.abort()),!r)return void S.b.warn("key uri is falsy");var l=a.loader,u=i.loader=this.loaders[n]=new l(a);this.decrypturl=r,this.decryptkey=null;var d={url:r,frag:i,responseType:"arraybuffer"},f={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:a.fragLoadingRetryDelay,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:0},g={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(d,f,g)}else this.decryptkey&&(i.decryptdata.key=this.decryptkey,this.hls.trigger(c.a.KEY_LOADED,{frag:i}))}else S.b.warn("Missing decryption data on fragment in onKeyLoading")},o.loadsuccess=function(t,e,i){var n=i.frag;n.decryptdata?(this.decryptkey=n.decryptdata.key=new Uint8Array(t.data),n.loader=null,delete this.loaders[n.type],this.hls.trigger(c.a.KEY_LOADED,{frag:n})):S.b.error("after key load, decryptdata unset")},o.loaderror=function(t,e){var i=e.frag,n=i.loader;n&&n.abort(),delete this.loaders[i.type],this.hls.trigger(c.a.ERROR,{type:R.b.NETWORK_ERROR,details:R.a.KEY_LOAD_ERROR,fatal:!1,frag:i,response:t})},o.loadtimeout=function(t,e){var i=e.frag,n=i.loader;n&&n.abort(),delete this.loaders[i.type],this.hls.trigger(c.a.ERROR,{type:R.b.NETWORK_ERROR,details:R.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},h}();function lt(h,o){var t;try{t=new Event("addtrack")}catch{(t=document.createEvent("Event")).initEvent("addtrack",!1,!1)}t.track=h,o.dispatchEvent(t)}function At(h,o){var t=h.mode;if(t==="disabled"&&(h.mode="hidden"),h.cues&&!h.cues.getCueById(o.id))try{if(h.addCue(o),!h.cues.getCueById(o.id))throw new Error("addCue is failed for: "+o)}catch(i){S.b.debug("[texttrack-utils]: "+i);var e=new self.TextTrackCue(o.startTime,o.endTime,o.text);e.id=o.id,h.addCue(e)}t==="disabled"&&(h.mode=t)}function pt(h){var o=h.mode;if(o==="disabled"&&(h.mode="hidden"),h.cues)for(var t=h.cues.length;t--;)h.removeCue(h.cues[t]);o==="disabled"&&(h.mode=o)}function It(h,o,t,e){var i=h.mode;if(i==="disabled"&&(h.mode="hidden"),h.cues&&h.cues.length>0)for(var n=function(r,a,l){var u=[],d=function(y,A){if(A<y[0].startTime)return 0;var E=y.length-1;if(A>y[E].endTime)return-1;for(var W=0,Z=E;W<=Z;){var Q=Math.floor((Z+W)/2);if(A<y[Q].startTime)Z=Q-1;else{if(!(A>y[Q].startTime&&W<E))return Q;W=Q+1}}return y[W].startTime-A<A-y[Z].startTime?W:Z}(r,a);if(d>-1)for(var f=d,g=r.length;f<g;f++){var p=r[f];if(p.startTime>=a&&p.endTime<=l)u.push(p);else if(p.startTime>l)return u}return u}(h.cues,o,t),s=0;s<n.length;s++)e&&!e(n[s])||h.removeCue(n[s]);i==="disabled"&&(h.mode=i)}var Rt=H(7),Pt=H(8);function Bt(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function Ot(h,o){return h.getTime()/1e3-o}var _t=function(){function h(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var o=h.prototype;return o.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},o._registerListeners=function(){var t=this.hls;t.on(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(c.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(c.a.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(c.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(c.a.LEVEL_UPDATED,this.onLevelUpdated,this)},o._unregisterListeners=function(){var t=this.hls;t.off(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(c.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(c.a.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(c.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(c.a.LEVEL_UPDATED,this.onLevelUpdated,this)},o.onMediaAttached=function(t,e){this.media=e.media},o.onMediaDetaching=function(){this.id3Track&&(pt(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},o.onManifestLoading=function(){this.dateRangeCuesAppended={}},o.createTrack=function(t){var e=this.getID3Track(t.textTracks);return e.mode="hidden",e},o.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var i=t[e];if(i.kind==="metadata"&&i.label==="id3")return lt(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},o.onFragParsingMetadata=function(t,e){if(this.media){var i=this.hls.config,n=i.enableEmsgMetadataCues,s=i.enableID3MetadataCues;if(n||s){var r=e.frag,a=e.samples,l=e.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var u=l.edge||r.end,d=Bt(),f=!1,g={},p=0;p<a.length;p++){var y=a[p].type;if((y!==Pt.a.emsg||n)&&s){var A=Rt.c(a[p].data);if(A){var E=a[p].pts,W=u;W-E<=0&&(W=E+.25);for(var Z=0;Z<A.length;Z++){var Q=A[Z];if(!Rt.e(Q)){var it=new d(E,W,"");it.value=Q,y&&(it.type=y),this.id3Track.addCue(it),g[Q.key]=null,f=!0}}}}}f&&this.updateId3CueEnds(g)}}},o.updateId3CueEnds=function(t){var e,i=(e=this.id3Track)===null||e===void 0?void 0:e.cues;if(i)for(var n=i.length;n--;){var s,r=i[n],a=(s=r.value)===null||s===void 0?void 0:s.key;if(a&&a in t){var l=t[a];l&&r.endTime!==l&&(r.endTime=l),t[a]=r.startTime}}},o.onBufferFlushing=function(t,e){var i=e.startOffset,n=e.endOffset,s=e.type,r=this.id3Track,a=this.hls;if(a){var l=a.config,u=l.enableEmsgMetadataCues,d=l.enableID3MetadataCues;r&&(u||d)&&It(r,i,n,s==="audio"?function(f){return f.type===Pt.a.audioId3&&d}:s==="video"?function(f){return f.type===Pt.a.emsg&&u}:function(f){return f.type===Pt.a.audioId3&&d||f.type===Pt.a.emsg&&u})}},o.onLevelUpdated=function(t,e){var i=this,n=e.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var s=this.dateRangeCuesAppended,r=this.id3Track,a=n.dateRanges,l=Object.keys(a);if(r)for(var u=Object.keys(s).filter(function(Z){return!l.includes(Z)}),d=function(Z){var Q=u[Z];Object.keys(s[Q].cues).forEach(function(it){r.removeCue(s[Q].cues[it])}),delete s[Q]},f=u.length;f--;)d(f);var g=n.fragments[n.fragments.length-1];if(l.length!==0&&Object(I.a)(g==null?void 0:g.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var p=g.programDateTime/1e3-g.start,y=n.edge||g.end,A=Bt(),E=function(Z){var Q=l[Z],it=a[Q],ft=s[Q],bt=(ft==null?void 0:ft.cues)||{},gt=(ft==null?void 0:ft.durationKnown)||!1,Lt=Ot(it.startDate,p),jt=y,Vt=it.endDate;if(Vt)jt=Ot(Vt,p),gt=!0;else if(it.endOnNext&&!gt){var re=l.reduce(function(Te,De){var _e=a[De];return _e.class===it.class&&_e.id!==De&&_e.startDate>it.startDate&&Te.push(_e),Te},[]).sort(function(Te,De){return Te.startDate.getTime()-De.startDate.getTime()})[0];re&&(jt=Ot(re.startDate,p),gt=!0)}for(var $t,he=Object.keys(it.attr),ge=0;ge<he.length;ge++){var Jt=he[ge];if(Jt!==X.ID&&Jt!==X.CLASS&&Jt!==X.START_DATE&&Jt!==X.DURATION&&Jt!==X.END_DATE&&Jt!==X.END_ON_NEXT){var Zt=bt[Jt];if(Zt)gt&&!ft.durationKnown&&(Zt.endTime=jt);else{var be=it.attr[Jt];Zt=new A(Lt,jt,""),Jt!==X.SCTE35_OUT&&Jt!==X.SCTE35_IN||($t=be,be=Uint8Array.from($t.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),Zt.value={key:Jt,data:be},Zt.type=Pt.a.dateRange,i.id3Track.addCue(Zt),bt[Jt]=Zt}}}s[Q]={cues:bt,dateRange:it,durationKnown:gt}},W=0;W<l.length;W++)E(W)}}},h}();function Kt(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}var wt,Ht=function(){function h(i){var n=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return n.timeupdate()},this.hls=i,this.config=i.config,this.registerListeners()}var o,t,e=h.prototype;return e.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},e.registerListeners=function(){this.hls.on(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(c.a.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(c.a.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(c.a.ERROR,this.onError,this)},e.unregisterListeners=function(){this.hls.off(c.a.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(c.a.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(c.a.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(c.a.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(c.a.ERROR,this.onError)},e.onMediaAttached=function(i,n){this.media=n.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},e.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},e.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},e.onLevelUpdated=function(i,n){var s=n.details;this.levelDetails=s,s.advanced&&this.timeupdate(),!s.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},e.onError=function(i,n){n.details===R.a.BUFFER_STALLED_ERROR&&(this.stallCount++,S.b.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},e.timeupdate=function(){var i=this.media,n=this.levelDetails;if(i&&n){this.currentTime=i.currentTime;var s=this.computeLatency();if(s!==null){this._latency=s;var r=this.config,a=r.lowLatencyMode,l=r.maxLiveSyncPlaybackRate;if(a&&l!==1){var u=this.targetLatency;if(u!==null){var d=s-u,f=d<Math.min(this.maxLatency,u+n.targetduration);if(n.live&&f&&d>.05&&this.forwardBufferLength>1){var g=Math.min(2,Math.max(1,l)),p=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20;i.playbackRate=Math.min(g,Math.max(1,p))}else i.playbackRate!==1&&i.playbackRate!==0&&(i.playbackRate=1)}}}}},e.estimateLiveEdge=function(){var i=this.levelDetails;return i===null?null:i.edge+i.age},e.computeLatency=function(){var i=this.estimateLiveEdge();return i===null?null:i-this.currentTime},o=h,(t=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var i=this.config,n=this.levelDetails;return i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:n?i.liveMaxLatencyDurationCount*n.targetduration:0}},{key:"targetLatency",get:function(){var i=this.levelDetails;if(i===null)return null;var n=i.holdBack,s=i.partHoldBack,r=i.targetduration,a=this.config,l=a.liveSyncDuration,u=a.liveSyncDurationCount,d=a.lowLatencyMode,f=this.hls.userConfig,g=d&&s||n;(f.liveSyncDuration||f.liveSyncDurationCount||g===0)&&(g=l!==void 0?l:u*r);var p=r;return g+Math.min(1*this.stallCount,p)}},{key:"liveSyncPosition",get:function(){var i=this.estimateLiveEdge(),n=this.targetLatency,s=this.levelDetails;if(i===null||n===null||s===null)return null;var r=s.edge,a=i-n-this.edgeStalled,l=r-s.totalduration,u=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(l,a),u)}},{key:"drift",get:function(){var i=this.levelDetails;return i===null?1:i.drift}},{key:"edgeStalled",get:function(){var i=this.levelDetails;if(i===null)return 0;var n=3*(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.max(i.age-n,0)}},{key:"forwardBufferLength",get:function(){var i=this.media,n=this.levelDetails;if(!i||!n)return 0;var s=i.buffered.length;return(s?i.buffered.end(s-1):n.edge)-this.currentTime}}])&&Kt(o.prototype,t),Object.defineProperty(o,"prototype",{writable:!1}),h}();function Nt(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}(function(h){h.No="",h.Yes="YES",h.v2="v2"})(wt||(wt={}));var ee=function(){function h(o,t,e){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=o,this.part=t,this.skip=e}return h.prototype.addDirectives=function(o){var t=new self.URL(o);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.toString()},h}(),qt=function(){function h(e){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this.attrs=e.attrs,this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(function(i){return i}).join(",").replace(/\.[^.,]+/g,"")}var o,t;return o=h,(t=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var i=e%this.url.length;this._urlId!==i&&(this.details=void 0,this._urlId=i)}}])&&Nt(o.prototype,t),Object.defineProperty(o,"prototype",{writable:!1}),h}();function ie(){return(ie=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])}return h}).apply(this,arguments)}function oe(h,o,t){switch(o){case"audio":h.audioGroupIds||(h.audioGroupIds=[]),h.audioGroupIds.push(t);break;case"text":h.textGroupIds||(h.textGroupIds=[]),h.textGroupIds.push(t)}}function zt(h){var o={};h.forEach(function(t){var e=t.groupId||"";t.id=o[e]=o[e]||0,o[e]++})}function Gt(h,o){var t=o.startPTS;if(Object(I.a)(t)){var e,i=0;o.sn>h.sn?(i=t-h.start,e=h):(i=h.start-t,e=o),e.duration!==i&&(e.duration=i)}else o.sn>h.sn?h.cc===o.cc&&h.minEndPTS?o.start=h.start+(h.minEndPTS-h.start):o.start=h.start+h.duration:o.start=Math.max(h.start-o.duration,0)}function ne(h,o,t,e,i,n){e-t<=0&&(S.b.warn("Fragment should have a positive duration",o),e=t+o.duration,n=i+o.duration);var s=t,r=e,a=o.startPTS,l=o.endPTS;if(Object(I.a)(a)){var u=Math.abs(a-t);Object(I.a)(o.deltaPTS)?o.deltaPTS=Math.max(u,o.deltaPTS):o.deltaPTS=u,s=Math.max(t,a),t=Math.min(t,a),i=Math.min(i,o.startDTS),r=Math.min(e,l),e=Math.max(e,l),n=Math.max(n,o.endDTS)}o.duration=e-t;var d=t-o.start;o.appendedPTS=e,o.start=o.startPTS=t,o.maxStartPTS=s,o.startDTS=i,o.endPTS=e,o.minEndPTS=r,o.endDTS=n;var f,g=o.sn;if(!h||g<h.startSN||g>h.endSN)return 0;var p=g-h.startSN,y=h.fragments;for(y[p]=o,f=p;f>0;f--)Gt(y[f],y[f-1]);for(f=p;f<y.length-1;f++)Gt(y[f],y[f+1]);return h.fragmentHint&&Gt(y[y.length-1],h.fragmentHint),h.PTSKnown=h.alignedSliding=!0,d}function Xt(h,o){for(var t=null,e=h.fragments,i=e.length-1;i>=0;i--){var n=e[i].initSegment;if(n){t=n;break}}h.fragmentHint&&delete h.fragmentHint.endPTS;var s,r=0;if(function(g,p,y){for(var A=p.skippedSegments,E=Math.max(g.startSN,p.startSN)-p.startSN,W=(g.fragmentHint?1:0)+(A?p.endSN:Math.min(g.endSN,p.endSN))-p.startSN,Z=p.startSN-g.startSN,Q=p.fragmentHint?p.fragments.concat(p.fragmentHint):p.fragments,it=g.fragmentHint?g.fragments.concat(g.fragmentHint):g.fragments,ft=E;ft<=W;ft++){var bt=it[Z+ft],gt=Q[ft];A&&!gt&&ft<A&&(gt=p.fragments[ft]=bt),bt&&gt&&y(bt,gt)}}(h,o,function(g,p){g.relurl&&(r=g.cc-p.cc),Object(I.a)(g.startPTS)&&Object(I.a)(g.endPTS)&&(p.start=p.startPTS=g.startPTS,p.startDTS=g.startDTS,p.appendedPTS=g.appendedPTS,p.maxStartPTS=g.maxStartPTS,p.endPTS=g.endPTS,p.endDTS=g.endDTS,p.minEndPTS=g.minEndPTS,p.duration=g.endPTS-g.startPTS,p.duration&&(s=p),o.PTSKnown=o.alignedSliding=!0),p.elementaryStreams=g.elementaryStreams,p.loader=g.loader,p.stats=g.stats,p.urlId=g.urlId,g.initSegment&&(p.initSegment=g.initSegment,t=g.initSegment)}),t&&(o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments).forEach(function(g){var p;g.initSegment&&g.initSegment.relurl!==((p=t)===null||p===void 0?void 0:p.relurl)||(g.initSegment=t)}),o.skippedSegments)if(o.deltaUpdateFailed=o.fragments.some(function(g){return!g}),o.deltaUpdateFailed){S.b.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var a=o.skippedSegments;a--;)o.fragments.shift();o.startSN=o.fragments[0].sn,o.startCC=o.fragments[0].cc}else o.canSkipDateRanges&&(o.dateRanges=function(g,p,y){var A=ie({},g);return y&&y.forEach(function(E){delete A[E]}),Object.keys(p).forEach(function(E){var W=new z(p[E].attr,A[E]);W.isValid?A[E]=W:S.b.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(p[E].attr)+'"')}),A}(h.dateRanges,o.dateRanges,o.recentlyRemovedDateranges));var l=o.fragments;if(r){S.b.warn("discontinuity sliding from playlist, take drift into account");for(var u=0;u<l.length;u++)l[u].cc+=r}o.skippedSegments&&(o.startCC=o.fragments[0].cc),function(g,p,y){if(g&&p)for(var A=0,E=0,W=g.length;E<=W;E++){var Z=g[E],Q=p[E+A];Z&&Q&&Z.index===Q.index&&Z.fragment.sn===Q.fragment.sn?y(Z,Q):A--}}(h.partList,o.partList,function(g,p){p.elementaryStreams=g.elementaryStreams,p.stats=g.stats}),s?ne(o,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):ve(h,o),l.length&&(o.totalduration=o.edge-l[0].start),o.driftStartTime=h.driftStartTime,o.driftStart=h.driftStart;var d=o.advancedDateTime;if(o.advanced&&d){var f=o.edge;o.driftStart||(o.driftStartTime=d,o.driftStart=f),o.driftEndTime=d,o.driftEnd=f}else o.driftEndTime=h.driftEndTime,o.driftEnd=h.driftEnd,o.advancedDateTime=h.advancedDateTime}function ve(h,o){var t=o.startSN+o.skippedSegments-h.startSN,e=h.fragments;t<0||t>=e.length||pe(o,e[t].start)}function pe(h,o){if(o){for(var t=h.fragments,e=h.skippedSegments;e<t.length;e++)t[e].start+=o;h.fragmentHint&&(h.fragmentHint.start+=o)}}var ae=function(){function h(t,e){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=S.b.log.bind(S.b,e+":"),this.warn=S.b.warn.bind(S.b,e+":"),this.hls=t}var o=h.prototype;return o.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},o.onError=function(t,e){e.fatal&&e.type===R.b.NETWORK_ERROR&&this.clearTimer()},o.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},o.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},o.stopLoad=function(){this.canLoad=!1,this.clearTimer()},o.switchParams=function(t,e){var i=e==null?void 0:e.renditionReports;if(i)for(var n=0;n<i.length;n++){var s=i[n],r=""+s.URI;if(r===t.slice(-r.length)){var a=parseInt(s["LAST-MSN"]),l=parseInt(s["LAST-PART"]);if(e&&this.hls.config.lowLatencyMode){var u=Math.min(e.age-e.partTarget,e.targetduration);l!==void 0&&u>e.partTarget&&(l+=1)}if(Object(I.a)(a))return new ee(a,Object(I.a)(l)?l:void 0,wt.No)}}},o.loadPlaylist=function(t){},o.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},o.playlistLoaded=function(t,e,i){var n=this,s=e.details,r=e.stats,a=r.loading.end?Math.max(0,self.performance.now()-r.loading.end):0;if(s.advancedDateTime=Date.now()-a,s.live||i!=null&&i.live){if(s.reloaded(i),i&&this.log("live playlist "+t+" "+(s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED")),i&&s.fragments.length>0&&Xt(i,s),!this.canLoad||!s.live)return;var l,u=void 0,d=void 0;if(s.canBlockReload&&s.endSN&&s.advanced){var f=this.hls.config.lowLatencyMode,g=s.lastPartSn,p=s.endSN,y=s.lastPartIndex,A=g===p;y!==-1?(u=A?p+1:g,d=A?f?0:y:y+1):u=p+1;var E=s.age,W=E+s.ageHeader,Z=Math.min(W-s.partTarget,1.5*s.targetduration);if(Z>0){if(i&&Z>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+Z+" with playlist age: "+s.age),Z=0;else{var Q=Math.floor(Z/s.targetduration);u+=Q,d!==void 0&&(d+=Math.round(Z%s.targetduration/s.partTarget)),this.log("CDN Tune-in age: "+s.ageHeader+"s last advanced "+E.toFixed(2)+"s goal: "+Z+" skip sn "+Q+" to part "+d)}s.tuneInGoal=Z}if(l=this.getDeliveryDirectives(s,e.deliveryDirectives,u,d),f||!A)return void this.loadPlaylist(l)}else l=this.getDeliveryDirectives(s,e.deliveryDirectives,u,d);var it=function(ft,bt){var gt,Lt=1e3*ft.levelTargetDuration,jt=Lt/2,Vt=ft.age,re=Vt>0&&Vt<3*Lt,$t=bt.loading.end-bt.loading.start,he=ft.availabilityDelay;if(ft.updated===!1)if(re){var ge=333*ft.misses;gt=Math.max(Math.min(jt,2*$t),ge),ft.availabilityDelay=(ft.availabilityDelay||0)+gt}else gt=jt;else re?(he=Math.min(he||Lt/2,Vt),ft.availabilityDelay=he,gt=he+Lt-Vt):gt=Lt-$t;return Math.round(gt)}(s,r);u!==void 0&&s.canBlockReload&&(it-=s.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(it)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist(l)},it)}else this.clearTimer()},o.getDeliveryDirectives=function(t,e,i,n){var s=function(r,a){var l=r.canSkipUntil,u=r.canSkipDateRanges,d=r.endSN;return l&&(a!==void 0?a-d:0)<l?u?wt.v2:wt.Yes:wt.No}(t,i);return e!=null&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,n=e.part,s=wt.No),new ee(i,n,s)},o.retryLoadingOrFail=function(t){var e,i=this,n=this.hls.config,s=this.retryCount<n.levelLoadingMaxRetry;if(s)if(this.retryCount++,t.details.indexOf("LoadTimeOut")>-1&&(e=t.context)!==null&&e!==void 0&&e.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist();else{var r=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return i.loadPlaylist()},r),this.warn("retry playlist loading #"+this.retryCount+" in "+r+' ms after "'+t.details+'"')}else this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0;return s},h}();function te(){return(te=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])}return h}).apply(this,arguments)}function de(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}function se(h,o){return(se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(h,o)}var Yt,Le=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),me=function(h){var o,t;function e(r){var a;return(a=h.call(this,r,"[level-controller]")||this)._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.onParsedComplete=void 0,a._registerListeners(),a}t=h,(o=e).prototype=Object.create(t.prototype),o.prototype.constructor=o,se(o,t);var i,n,s=e.prototype;return s._registerListeners=function(){var r=this.hls;r.on(c.a.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(c.a.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(c.a.FRAG_LOADED,this.onFragLoaded,this),r.on(c.a.ERROR,this.onError,this),r.on(c.a.PLAYBACK_REPLAY,this.onPlayBackReplay,this)},s._unregisterListeners=function(){var r=this.hls;r.off(c.a.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(c.a.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(c.a.FRAG_LOADED,this.onFragLoaded,this),r.off(c.a.ERROR,this.onError,this),r.off(c.a.PLAYBACK_REPLAY,this.onPlayBackReplay,this)},s.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,h.prototype.destroy.call(this)},s.startLoad=function(){this._levels.forEach(function(r){r.loadError=0}),h.prototype.startLoad.call(this)},s.onManifestLoaded=function(r,a){var l,u,d=[],f=[],g=[],p={},y=!1,A=!1,E=!1;if(a.levels.forEach(function(it){var ft=it.attrs;y=y||!(!it.width||!it.height),A=A||!!it.videoCodec,E=E||!!it.audioCodec,Le&&it.audioCodec&&it.audioCodec.indexOf("mp4a.40.34")!==-1&&(it.audioCodec=void 0);var bt=it.bitrate+"-"+it.attrs.RESOLUTION+"-"+it.attrs.CODECS;(u=p[bt])?u.url.push(it.url):(u=new qt(it),p[bt]=u,d.push(u)),ft&&(ft.AUDIO&&oe(u,"audio",ft.AUDIO),ft.SUBTITLES&&oe(u,"text",ft.SUBTITLES))}),(y||A)&&E&&(d=d.filter(function(it){var ft=it.videoCodec,bt=it.width,gt=it.height;return!!ft||!(!bt||!gt)})),d=d.filter(function(it){var ft=it.audioCodec,bt=it.videoCodec;return(!ft||K(ft,"audio"))&&(!bt||K(bt,"video"))}),a.audioTracks&&zt(f=a.audioTracks.filter(function(it){return!it.audioCodec||K(it.audioCodec,"audio")})),a.subtitles&&zt(g=a.subtitles),d.length>0){l=d[0].bitrate,d.sort(function(it,ft){return it.bitrate-ft.bitrate}),this._levels=d;for(var W=0;W<d.length;W++)if(d[W].bitrate===l){this._firstLevel=W,this.log("manifest loaded, "+d.length+" level(s) found, first bitrate: "+l);break}var Z=E&&!A,Q={levels:d,audioTracks:f,subtitleTracks:g,firstLevel:this._firstLevel,stats:a.stats,audio:E,video:A,altAudio:!Z&&f.some(function(it){return!!it.url})};this.hls.trigger(c.a.MANIFEST_PARSED,Q),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(c.a.ERROR,{type:R.b.MEDIA_ERROR,details:R.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},s.onPlayBackReplay=function(r,a){this.loadPlaylist()},s.onError=function(r,a){if(h.prototype.onError.call(this,r,a),!a.fatal){var l=a.context,u=this._levels[this.currentLevelIndex];if(l&&(l.type===G.a.AUDIO_TRACK&&u.audioGroupIds&&l.groupId===u.audioGroupIds[u.urlId]||l.type===G.a.SUBTITLE_TRACK&&u.textGroupIds&&l.groupId===u.textGroupIds[u.urlId]))this.redundantFailover(this.currentLevelIndex);else{var d,f=!1,g=!0;switch(a.details){case R.a.FRAG_LOAD_ERROR:case R.a.FRAG_LOAD_TIMEOUT:case R.a.KEY_LOAD_ERROR:case R.a.KEY_LOAD_TIMEOUT:if(a.frag){var p=this._levels[a.frag.level];p?(p.fragmentError++,p.fragmentError>this.hls.config.fragLoadingMaxRetry&&(d=a.frag.level)):d=a.frag.level}break;case R.a.LEVEL_LOAD_ERROR:case R.a.LEVEL_LOAD_TIMEOUT:l&&(l.deliveryDirectives&&(g=!1),d=l.level),f=!0;break;case R.a.REMUX_ALLOC_ERROR:d=a.level,f=!0}d!==void 0&&this.recoverLevel(a,d,f,g)}}},s.recoverLevel=function(r,a,l,u){var d=r.details,f=this._levels[a];if(f.loadError++,l){if(!this.retryLoadingOrFail(r))return void(this.currentLevelIndex=-1);r.levelRetry=!0}if(u){var g=f.url.length;if(g>1&&f.loadError<g)r.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){var p=a===0?this._levels.length-1:a-1;this.currentLevelIndex!==p&&this._levels[p].loadError===0&&(this.warn(d+": switch to "+p),r.levelRetry=!0,this.hls.nextAutoLevel=p)}}},s.redundantFailover=function(r){var a=this._levels[r],l=a.url.length;if(l>1){var u=(a.urlId+1)%l;this.warn("Switching to redundant URL-id "+u),this._levels.forEach(function(d){d.urlId=u}),this.level=r}},s.onFragLoaded=function(r,a){var l=a.frag;if(l!==void 0&&l.type===G.b.MAIN){var u=this._levels[l.level];u!==void 0&&(u.fragmentError=0,u.loadError=0)}},s.onLevelLoaded=function(r,a){var l,u,d=a.level,f=a.details,g=this._levels[d];if(!g)return this.warn("Invalid level index "+d),void((u=a.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(f.deltaUpdateFailed=!0));d===this.currentLevelIndex?(g.fragmentError===0&&(g.loadError=0,this.retryCount=0),this.playlistLoaded(d,a,g.details)):(l=a.deliveryDirectives)!==null&&l!==void 0&&l.skip&&(f.deltaUpdateFailed=!0)},s.onAudioTrackSwitched=function(r,a){var l=this.hls.levels[this.currentLevelIndex];if(l&&l.audioGroupIds){for(var u=-1,d=this.hls.audioTracks[a.id].groupId,f=0;f<l.audioGroupIds.length;f++)if(l.audioGroupIds[f]===d){u=f;break}u!==l.urlId&&(l.urlId=u,this.startLoad())}},s.loadPlaylist=function(r){var a=this.currentLevelIndex,l=this._levels[a];if(this.canLoad&&l&&l.url.length>0){var u=l.urlId,d=l.url[u];if(r)try{d=r.addDirectives(d)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Attempt loading level index "+a+(r?" at sn "+r.msn+" part "+r.part:"")+" with URL-id "+u+" "+d),this.clearTimer(),this.hls.trigger(c.a.LEVEL_LOADING,{url:d,level:a,id:u,deliveryDirectives:r||null})}},s.removeLevel=function(r,a){var l=function(d,f){return f!==a},u=this._levels.filter(function(d,f){return f!==r||d.url.length>1&&a!==void 0&&(d.url=d.url.filter(l),d.audioGroupIds&&(d.audioGroupIds=d.audioGroupIds.filter(l)),d.textGroupIds&&(d.textGroupIds=d.textGroupIds.filter(l)),d.urlId=0,!0)}).map(function(d,f){var g=d.details;return g!=null&&g.fragments&&g.fragments.forEach(function(p){p.level=f}),d});this._levels=u,this.hls.trigger(c.a.LEVELS_UPDATED,{levels:u})},i=e,(n=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(r){var a,l=this._levels;if(l.length!==0&&(this.currentLevelIndex!==r||(a=l[r])===null||a===void 0||!a.details)){if(r<0||r>=l.length){var u=r<0;if(this.hls.trigger(c.a.ERROR,{type:R.b.OTHER_ERROR,details:R.a.LEVEL_SWITCH_ERROR,level:r,fatal:u,reason:"invalid level idx"}),u)return;r=Math.min(r,l.length-1)}this.clearTimer();var d=this.currentLevelIndex,f=l[d],g=l[r];this.log("switching to level "+r+" from "+d),this.currentLevelIndex=r;var p=te({},g,{level:r,maxBitrate:g.maxBitrate,uri:g.uri,urlId:g.urlId});delete p._urlId,this.hls.trigger(c.a.LEVEL_SWITCHING,p);var y=g.details;if(!y||y.live){var A=this.switchParams(g.uri,f==null?void 0:f.details);this.loadPlaylist(A)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(r){this.manualLevelIndex=r,this._startLevel===void 0&&(this._startLevel=r),r!==-1&&(this.level=r)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(r){this._firstLevel=r}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var r=this.hls.config.startLevel;return r!==void 0?r:this._firstLevel}return this._startLevel},set:function(r){this._startLevel=r}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(r){this.level=r,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=r)}}])&&de(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),e}(ae);(function(h){h.NOT_LOADED="NOT_LOADED",h.APPENDING="APPENDING",h.PARTIAL="PARTIAL",h.OK="OK"})(Yt||(Yt={}));var Ee=function(){function h(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}var o=h.prototype;return o._registerListeners=function(){var t=this.hls;t.on(c.a.BUFFER_APPENDED,this.onBufferAppended,this),t.on(c.a.FRAG_BUFFERED,this.onFragBuffered,this),t.on(c.a.FRAG_LOADED,this.onFragLoaded,this)},o._unregisterListeners=function(){var t=this.hls;t.off(c.a.BUFFER_APPENDED,this.onBufferAppended,this),t.off(c.a.FRAG_BUFFERED,this.onFragBuffered,this),t.off(c.a.FRAG_LOADED,this.onFragLoaded,this)},o.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},o.getAppendedFrag=function(t,e){if(e===G.b.MAIN){var i=this.activeFragment,n=this.activeParts;if(!i)return null;if(n)for(var s=n.length;s--;){var r=n[s],a=r?r.end:i.appendedPTS;if(r.start<=t&&a!==void 0&&t<=a)return s>9&&(this.activeParts=n.slice(s-9)),r}else if(i.start<=t&&i.appendedPTS!==void 0&&t<=i.appendedPTS)return i}return this.getBufferedFrag(t,e)},o.getBufferedFrag=function(t,e){for(var i=this.fragments,n=Object.keys(i),s=n.length;s--;){var r=i[n[s]];if((r==null?void 0:r.body.type)===e&&r.buffered){var a=r.body;if(a.start<=t&&t<=a.end)return a}}return null},o.detectEvictedFragments=function(t,e,i){var n=this;Object.keys(this.fragments).forEach(function(s){var r=n.fragments[s];if(r)if(r.buffered){var a=r.range[t];a&&a.time.some(function(l){var u=!n.isTimeBuffered(l.startPTS,l.endPTS,e);return u&&n.removeFragment(r.body),u})}else r.body.type===i&&n.removeFragment(r.body)})},o.detectPartialFragments=function(t){var e=this,i=this.timeRanges,n=t.frag,s=t.part;if(i&&n.sn!=="initSegment"){var r=Se(n),a=this.fragments[r];a&&(Object.keys(i).forEach(function(l){var u=n.elementaryStreams[l];if(u){var d=i[l],f=s!==null||u.partial===!0;a.range[l]=e.getBufferedTimes(n,s,f,d)}}),a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},o.fragBuffered=function(t){var e=Se(t),i=this.fragments[e];i&&(i.loaded=null,i.buffered=!0)},o.getBufferedTimes=function(t,e,i,n){for(var s={time:[],partial:i},r=e?e.start:t.start,a=e?e.end:t.end,l=t.minEndPTS||a,u=t.maxStartPTS||r,d=0;d<n.length;d++){var f=n.start(d)-this.bufferPadding,g=n.end(d)+this.bufferPadding;if(u>=f&&l<=g){s.time.push({startPTS:Math.max(r,n.start(d)),endPTS:Math.min(a,n.end(d))});break}if(r<g&&a>f)s.partial=!0,s.time.push({startPTS:Math.max(r,n.start(d)),endPTS:Math.min(a,n.end(d))});else if(a<=f)break}return s},o.getPartialFragment=function(t){var e,i,n,s=null,r=0,a=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach(function(u){var d=l[u];d&&Re(d)&&(i=d.body.start-a,n=d.body.end+a,t>=i&&t<=n&&(e=Math.min(t-i,n-t),r<=e&&(s=d.body,r=e)))}),s},o.getState=function(t){var e=Se(t),i=this.fragments[e];return i?i.buffered?Re(i)?Yt.PARTIAL:Yt.OK:Yt.APPENDING:Yt.NOT_LOADED},o.isTimeBuffered=function(t,e,i){for(var n,s,r=0;r<i.length;r++){if(n=i.start(r)-this.bufferPadding,s=i.end(r)+this.bufferPadding,t>=n&&e<=s)return!0;if(e<=n)return!1}return!1},o.onFragLoaded=function(t,e){var i=e.frag,n=e.part;if(i.sn!=="initSegment"&&!i.bitrateTest&&!n){var s=Se(i);this.fragments[s]={body:i,loaded:e,buffered:!1,range:Object.create(null)}}},o.onBufferAppended=function(t,e){var i=this,n=e.frag,s=e.part,r=e.timeRanges;if(n.type===G.b.MAIN)if(this.activeFragment=n,s){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(s)}else this.activeParts=null;this.timeRanges=r,Object.keys(r).forEach(function(l){var u=r[l];if(i.detectEvictedFragments(l,u),!s)for(var d=0;d<u.length;d++)n.appendedPTS=Math.max(u.end(d),n.appendedPTS||0)})},o.onFragBuffered=function(t,e){this.detectPartialFragments(e)},o.hasFragment=function(t){var e=Se(t);return!!this.fragments[e]},o.removeFragmentsInRange=function(t,e,i){var n=this;Object.keys(this.fragments).forEach(function(s){var r=n.fragments[s];if(r&&r.buffered){var a=r.body;a.type===i&&a.start<e&&a.end>t&&n.removeFragment(a)}})},o.removeFragment=function(t){var e=Se(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[e]},o.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},h}();function Re(h){var o,t;return h.buffered&&(((o=h.range.video)===null||o===void 0?void 0:o.partial)||((t=h.range.audio)===null||t===void 0?void 0:t.partial))}function Se(h){return h.type+"_"+h.level+"_"+h.urlId+"_"+h.sn}var F=function(){function h(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var o=h.prototype;return o.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},o.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},o.onHandlerDestroyed=function(){},o.hasInterval=function(){return!!this._tickInterval},o.hasNextTick=function(){return!!this._tickTimer},o.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},o.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},o.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},o.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},o.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},o.doTick=function(){},h}(),L={length:0,start:function(){return 0},end:function(){return 0}},v=function(){function h(){}return h.isBuffered=function(o,t){try{if(o){for(var e=h.getBuffered(o),i=0;i<e.length;i++)if(t>=e.start(i)&&t<=e.end(i))return!0}}catch{}return!1},h.bufferInfo=function(o,t,e){try{if(o){var i,n=h.getBuffered(o),s=[];for(i=0;i<n.length;i++)s.push({start:n.start(i),end:n.end(i)});return this.bufferedInfo(s,t,e)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}},h.bufferedInfo=function(o,t,e){t=Math.max(0,t),o.sort(function(y,A){var E=y.start-A.start;return E||A.end-y.end});var i=[];if(e)for(var n=0;n<o.length;n++){var s=i.length;if(s){var r=i[s-1].end;o[n].start-r<e?o[n].end>r&&(i[s-1].end=o[n].end):i.push(o[n])}else i.push(o[n])}else i=o;for(var a,l=0,u=t,d=t,f=0;f<i.length;f++){var g=i[f].start,p=i[f].end;if(t+e>=g&&t<p)u=g,l=(d=p)-t;else if(t+e<g){a=g;break}}return{len:l,start:u||0,end:d||0,nextStart:a}},h.getBuffered=function(o){try{return o.buffered}catch(t){return S.b.log("failed to get media.buffered",t),L}},h}(),T=function(h,o,t,e,i,n){e===void 0&&(e=0),i===void 0&&(i=-1),n===void 0&&(n=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=h,this.sn=o,this.id=t,this.size=e,this.part=i,this.partial=n};function b(h,o){if(h){var t=h.start+o;h.start=h.startPTS=t,h.endPTS=t+h.duration}}function k(h,o){for(var t=o.fragments,e=0,i=t.length;e<i;e++)b(t[e],h);o.fragmentHint&&b(o.fragmentHint,h),o.alignedSliding=!0}function x(h,o,t){o&&(function(e,i,n){if(function(r,a,l){return!(!a.details||!(l.endCC>l.startCC||r&&r.cc<l.startCC))}(e,n,i)){var s=function(r,a){var l=r.fragments,u=a.fragments;if(u.length&&l.length){var d=function(f,g){for(var p=null,y=0,A=f.length;y<A;y++){var E=f[y];if(E&&E.cc===g){p=E;break}}return p}(l,u[0].cc);if(d&&(!d||d.startPTS))return d;S.b.log("No frag in previous level to align on")}else S.b.log("No fragments to align")}(n.details,i);s&&Object(I.a)(s.start)&&(S.b.log("Adjusting PTS using last level due to CC increase within current level "+i.url),k(s.start,i))}}(h,t,o),!t.alignedSliding&&o.details&&function(e,i){if(!(!i.fragments.length||!e.hasProgramDateTime||!i.hasProgramDateTime)){var n=i.fragments[0].programDateTime,s=e.fragments[0].programDateTime,r=(s-n)/1e3+i.fragments[0].start;r&&Object(I.a)(r)&&(S.b.log("Adjusting PTS using programDateTime delta "+(s-n)+"ms, sliding:"+r.toFixed(3)+" "+e.url+" "),k(r,e))}}(t,o.details),t.alignedSliding||!o.details||t.skippedSegments||ve(o.details,t))}function M(h,o){var t=h.programDateTime;if(t){var e=(t-o)/1e3;h.start=h.startPTS=e,h.endPTS=e+h.duration}}function at(h,o){if(o.fragments.length&&h.hasProgramDateTime&&o.hasProgramDateTime){var t=o.fragments[0].programDateTime-1e3*o.fragments[0].start;h.fragments.forEach(function(e){M(e,t)}),h.fragmentHint&&M(h.fragmentHint,t),h.alignedSliding=!0}}var st={search:function(h,o){for(var t=0,e=h.length-1,i=null,n=null;t<=e;){var s=o(n=h[i=(t+e)/2|0]);if(s>0)t=i+1;else{if(!(s<0))return n;e=i-1}}return null}};function ut(h,o,t,e){t===void 0&&(t=0),e===void 0&&(e=0);var i=null;if(h?i=o[h.sn-o[0].sn+1]||null:t===0&&o[0].start===0&&(i=o[0]),i&&dt(t,e,i)===0)return i;var n=st.search(o,dt.bind(null,t,e));return n||i}function dt(h,o,t){h===void 0&&(h=0),o===void 0&&(o=0);var e=Math.min(o,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-e<=h?1:t.start-e>h&&t.start?-1:0}function Tt(h,o,t){var e=1e3*Math.min(o,t.duration+(t.deltaPTS?t.deltaPTS:0));return(t.endProgramDateTime||0)-e>h}function mt(h){var o=typeof Map=="function"?new Map:void 0;return(mt=function(t){if(t===null||(e=t,Function.toString.call(e).indexOf("[native code]")===-1))return t;var e;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(t))return o.get(t);o.set(t,i)}function i(){return Et(t,arguments,Dt(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Ct(i,t)})(h)}function Et(h,o,t){return(Et=kt()?Reflect.construct.bind():function(e,i,n){var s=[null];s.push.apply(s,i);var r=new(Function.bind.apply(e,s));return n&&Ct(r,n.prototype),r}).apply(null,arguments)}function kt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ct(h,o){return(Ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(h,o)}function Dt(h){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)})(h)}var Wt=Math.pow(2,17),ce=function(){function h(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var o=h.prototype;return o.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},o.abort=function(){this.loader&&this.loader.abort()},o.load=function(t,e){var i=this,n=t.url;if(!n)return Promise.reject(new ue({type:R.b.NETWORK_ERROR,details:R.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var s=this.config,r=s.fLoader,a=s.loader;return new Promise(function(l,u){i.loader&&i.loader.destroy();var d=i.loader=t.loader=r?new r(s):new a(s),f=le(t),g={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:t.sn==="initSegment"?1/0:Wt};t.stats=d.stats,d.load(f,g,{onSuccess:function(p,y,A,E){i.resetLoader(t,d),l({frag:t,part:null,payload:p.data,networkDetails:E})},onError:function(p,y,A){i.resetLoader(t,d),u(new ue({type:R.b.NETWORK_ERROR,details:R.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:p,networkDetails:A}))},onAbort:function(p,y,A){i.resetLoader(t,d),u(new ue({type:R.b.NETWORK_ERROR,details:R.a.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:A}))},onTimeout:function(p,y,A){i.resetLoader(t,d),u(new ue({type:R.b.NETWORK_ERROR,details:R.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:A}))},onProgress:function(p,y,A,E){e&&e({frag:t,part:null,payload:A,networkDetails:E})}})})},o.loadPart=function(t,e,i){var n=this;this.abort();var s=this.config,r=s.fLoader,a=s.loader;return new Promise(function(l,u){n.loader&&n.loader.destroy();var d=n.loader=t.loader=r?new r(s):new a(s),f=le(t,e),g={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:Wt};e.stats=d.stats,d.load(f,g,{onSuccess:function(p,y,A,E){n.resetLoader(t,d),n.updateStatsFromPart(t,e);var W={frag:t,part:e,payload:p.data,networkDetails:E};i(W),l(W)},onError:function(p,y,A){n.resetLoader(t,d),u(new ue({type:R.b.NETWORK_ERROR,details:R.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:p,networkDetails:A}))},onAbort:function(p,y,A){t.stats.aborted=e.stats.aborted,n.resetLoader(t,d),u(new ue({type:R.b.NETWORK_ERROR,details:R.a.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,networkDetails:A}))},onTimeout:function(p,y,A){n.resetLoader(t,d),u(new ue({type:R.b.NETWORK_ERROR,details:R.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,networkDetails:A}))}})})},o.updateStatsFromPart=function(t,e){var i=t.stats,n=e.stats,s=n.total;if(i.loaded+=n.loaded,s){var r=Math.round(t.duration/e.duration),a=Math.min(Math.round(i.loaded/s),r),l=(r-a)*Math.round(i.loaded/a);i.total=i.loaded+l}else i.total=Math.max(i.loaded,i.total);var u=i.loading,d=n.loading;u.start?u.first+=d.first-d.start:(u.start=d.start,u.first=d.first),u.end=d.end},o.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},h}();function le(h,o){o===void 0&&(o=null);var t=o||h,e={frag:h,part:o,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,n=t.byteRangeEndOffset;return Object(I.a)(i)&&Object(I.a)(n)&&(e.rangeStart=i,e.rangeEnd=n),e}var ue=function(h){var o,t;function e(i){for(var n,s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return(n=h.call.apply(h,[this].concat(r))||this).data=void 0,n.data=i,n}return t=h,(o=e).prototype=Object.create(t.prototype),o.prototype.constructor=o,Ct(o,t),e}(mt(Error)),Ae=H(17),Ft={toString:function(h){for(var o="",t=h.length,e=0;e<t;e++)o+="["+h.start(e).toFixed(3)+","+h.end(e).toFixed(3)+"]";return o}};function ke(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}function Me(h,o){return(Me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(h,o)}var Qt="STOPPED",xt="IDLE",Oe="KEY_LOADING",Ce="FRAG_LOADING",Ie="FRAG_LOADING_WAITING_RETRY",we="WAITING_TRACK",fe="PARSING",xe="PARSED",Ze="ENDED",Ke="ERROR",He="WAITING_INIT_PTS",Ne="WAITING_LEVEL",dr=function(h){var o,t;function e(r,a,l){var u;return(u=h.call(this)||this).hls=void 0,u.fragPrevious=null,u.fragCurrent=null,u.fragmentTracker=void 0,u.transmuxer=null,u._state=Qt,u.media=void 0,u.mediaBuffer=void 0,u.config=void 0,u.bitrateTest=!1,u.lastCurrentTime=0,u.nextLoadPosition=0,u.startPosition=0,u.loadedmetadata=!1,u.fragLoadError=0,u.retryDate=0,u.levels=null,u.fragmentLoader=void 0,u.levelLastLoaded=null,u.startFragRequested=!1,u.decrypter=void 0,u.initPTS=[],u.onvseeking=null,u.onvended=null,u.logPrefix="",u.log=void 0,u.warn=void 0,u.logPrefix=l,u.log=S.b.log.bind(S.b,l+":"),u.warn=S.b.warn.bind(S.b,l+":"),u.hls=r,u.fragmentLoader=new ce(r.config),u.fragmentTracker=a,u.config=r.config,u.decrypter=new Ae.a(r,r.config),r.on(c.a.KEY_LOADED,u.onKeyLoaded,function(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}(u)),u}t=h,(o=e).prototype=Object.create(t.prototype),o.prototype.constructor=o,Me(o,t);var i,n,s=e.prototype;return s.doTick=function(){this.onTickEnd()},s.onTickEnd=function(){},s.startLoad=function(r){},s.stopLoad=function(){this.fragmentLoader.abort();var r=this.fragCurrent;r&&this.fragmentTracker.removeFragment(r),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Qt},s._streamEnded=function(r,a){var l=this.fragCurrent,u=this.fragmentTracker;if(!a.live&&l&&l.sn>=a.endSN&&!r.nextStart){var d=a.partList;if(d!=null&&d.length){var f=d[d.length-1];return v.isBuffered(this.media,f.start+f.duration/2)}var g=u.getState(l);return g===Yt.PARTIAL||g===Yt.OK}return!1},s.onMediaAttached=function(r,a){var l=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),l.addEventListener("seeking",this.onvseeking),l.addEventListener("ended",this.onvended);var u=this.config;this.levels&&u.autoStartLoad&&this.state===Qt&&this.startLoad(u.startPosition)},s.onMediaDetaching=function(){var r=this.media;r!=null&&r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r&&(r.removeEventListener("seeking",this.onvseeking),r.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},s.onMediaSeeking=function(){var r=this.config,a=this.fragCurrent,l=this.media,u=this.mediaBuffer,d=this.state,f=l?l.currentTime:0,g=v.bufferInfo(u||l,f,r.maxBufferHole);if(this.log("media seeking to "+(Object(I.a)(f)?f.toFixed(3):f)+", state: "+d),d===Ze)this.resetLoadingState();else if(a&&!g.len){var p=r.maxFragLookUpTolerance,y=a.start-p,A=f>a.start+a.duration+p;(f<y||A)&&(A&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.resetLoadingState())}l&&(this.lastCurrentTime=f),this.loadedmetadata||g.len||(this.nextLoadPosition=this.startPosition=f),this.tickImmediate()},s.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},s.onKeyLoaded=function(r,a){if(this.state===Oe&&a.frag===this.fragCurrent&&this.levels){this.state=xt;var l=this.levels[a.frag.level].details;l&&this.loadFragment(a.frag,l,a.frag.start)}},s.onHandlerDestroying=function(){this.stopLoad(),h.prototype.onHandlerDestroying.call(this)},s.onHandlerDestroyed=function(){this.state=Qt,this.hls.off(c.a.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,h.prototype.onHandlerDestroyed.call(this)},s.loadKey=function(r,a){this.log("Loading key for "+r.sn+" of ["+a.startSN+"-"+a.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level),this.state=Oe,this.fragCurrent=r,this.hls.trigger(c.a.KEY_LOADING,{frag:r})},s.loadFragment=function(r,a,l){this._loadFragForPlayback(r,a,l)},s._loadFragForPlayback=function(r,a,l){var u=this;this._doFragLoad(r,a,l,function(d){if(u.fragContextChanged(r))return u.warn("Fragment "+r.sn+(d.part?" p: "+d.part.index:"")+" of level "+r.level+" was dropped during download."),void u.fragmentTracker.removeFragment(r);r.stats.chunkCount++,u._handleFragmentLoadProgress(d)}).then(function(d){if(d){u.fragLoadError=0;var f=u.state;u.fragContextChanged(r)?(f===Ce||!u.fragCurrent&&f===fe)&&(u.fragmentTracker.removeFragment(r),u.state=xt):("payload"in d&&(u.log("Loaded fragment "+r.sn+" of level "+r.level),u.hls.trigger(c.a.FRAG_LOADED,d)),u._handleFragmentLoadComplete(d))}}).catch(function(d){u.state!==Qt&&(u.warn(d),u.resetFragmentLoading(r))})},s.flushMainBuffer=function(r,a,l){if(l===void 0&&(l=null),r-a){var u={startOffset:r,endOffset:a,type:l};this.fragLoadError=0,this.hls.trigger(c.a.BUFFER_FLUSHING,u)}},s._loadInitSegment=function(r){var a=this;this._doFragLoad(r).then(function(l){if(!l||a.fragContextChanged(r)||!a.levels)throw new Error("init load aborted");return l}).then(function(l){var u=a.hls,d=l.payload,f=r.decryptdata;if(d&&d.byteLength>0&&f&&f.key&&f.iv&&f.method==="AES-128"){var g=self.performance.now();return a.decrypter.webCryptoDecrypt(new Uint8Array(d),f.key.buffer,f.iv.buffer).then(function(p){var y=self.performance.now();return u.trigger(c.a.FRAG_DECRYPTED,{frag:r,payload:p,stats:{tstart:g,tdecrypt:y}}),l.payload=p,l})}return l}).then(function(l){var u=a.fragCurrent,d=a.hls,f=a.levels;if(!f)throw new Error("init load aborted, missing levels");f[r.level].details;var g=r.stats;a.state=xt,a.fragLoadError=0,r.data=new Uint8Array(l.payload),g.parsing.start=g.buffering.start=self.performance.now(),g.parsing.end=g.buffering.end=self.performance.now(),l.frag===u&&d.trigger(c.a.FRAG_BUFFERED,{stats:g,frag:u,part:null,id:r.type}),a.tick()}).catch(function(l){a.warn(l),a.resetFragmentLoading(r)})},s.fragContextChanged=function(r){var a=this.fragCurrent;return!r||!a||r.level!==a.level||r.sn!==a.sn||r.urlId!==a.urlId},s.fragBufferedComplete=function(r,a){var l=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+r.type+" sn: "+r.sn+(a?" part: "+a.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level+" "+Ft.toString(v.getBuffered(l))),this.state=xt,this.tick()},s._handleFragmentLoadComplete=function(r){var a=this.transmuxer;if(a){var l=r.frag,u=r.part,d=r.partsLoaded,f=!d||d.length===0||d.some(function(p){return!p}),g=new T(l.level,l.sn,l.stats.chunkCount+1,0,u?u.index:-1,!f);a.flush(g)}},s._handleFragmentLoadProgress=function(r){},s._doFragLoad=function(r,a,l,u){var d=this;if(l===void 0&&(l=null),!this.levels)throw new Error("frag load aborted, missing levels");if(l=Math.max(r.start,l||0),this.config.lowLatencyMode&&a){var f=a.partList;if(f&&u){l>r.end&&a.fragmentHint&&(r=a.fragmentHint);var g=this.getNextPart(f,r,l);if(g>-1){var p=f[g];return this.log("Loading part sn: "+r.sn+" p: "+p.index+" cc: "+r.cc+" of playlist ["+a.startSN+"-"+a.endSN+"] parts [0-"+g+"-"+(f.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(l.toFixed(3))),this.nextLoadPosition=p.start+p.duration,this.state=Ce,this.hls.trigger(c.a.FRAG_LOADING,{frag:r,part:f[g],targetBufferTime:l}),this.doFragPartsLoad(r,f,g,u).catch(function(y){return d.handleFragLoadError(y)})}if(!r.url||this.loadedEndOfParts(f,l))return Promise.resolve(null)}}return this.log("Loading fragment "+r.sn+" cc: "+r.cc+" "+(a?"of ["+a.startSN+"-"+a.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(l.toFixed(3))),Object(I.a)(r.sn)&&!this.bitrateTest&&(this.nextLoadPosition=r.start+r.duration),this.state=Ce,this.hls.trigger(c.a.FRAG_LOADING,{frag:r,targetBufferTime:l}),this.fragmentLoader.load(r,u).catch(function(y){return d.handleFragLoadError(y)})},s.doFragPartsLoad=function(r,a,l,u){var d=this;return new Promise(function(f,g){var p=[];(function y(A){var E=a[A];d.fragmentLoader.loadPart(r,E,u).then(function(W){p[E.index]=W;var Z=W.part;d.hls.trigger(c.a.FRAG_LOADED,W);var Q=a[A+1];if(!Q||Q.fragment!==r)return f({frag:r,part:Z,partsLoaded:p});y(A+1)}).catch(g)})(l)})},s.handleFragLoadError=function(r){var a=r.data;return a&&a.details===R.a.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(c.a.ERROR,a),null},s._handleTransmuxerFlush=function(r){var a=this.getCurrentContext(r);if(a&&this.state===fe){var l=a.frag,u=a.part,d=a.level,f=self.performance.now();l.stats.parsing.end=f,u&&(u.stats.parsing.end=f),this.updateLevelTiming(l,u,d,r.partial)}else this.fragCurrent||(this.state=xt)},s.getCurrentContext=function(r){var a=this.levels,l=r.level,u=r.sn,d=r.part;if(!a||!a[l])return this.warn("Levels object was unset while buffering fragment "+u+" of level "+l+". The current chunk will not be buffered."),null;var f=a[l],g=d>-1?function(y,A,E){if(!y||!y.details)return null;var W=y.details.partList;if(W)for(var Z=W.length;Z--;){var Q=W[Z];if(Q.index===E&&Q.fragment.sn===A)return Q}return null}(f,u,d):null,p=g?g.fragment:function(y,A,E){if(!y||!y.details)return null;var W=y.details,Z=W.fragments[A-W.startSN];return Z||((Z=W.fragmentHint)&&Z.sn===A?Z:A<W.startSN&&E&&E.sn===A?E:null)}(f,u,this.fragCurrent);return p?{frag:p,part:g,level:f}:null},s.bufferFragmentData=function(r,a,l,u){if(r&&this.state===fe){var d=r.data1,f=r.data2,g=d;if(d&&f&&(g=Object(Y.b)(d,f)),g&&g.length){var p={type:r.type,frag:a,part:l,chunkMeta:u,parent:a.type,data:g};this.hls.trigger(c.a.BUFFER_APPENDING,p),r.dropped&&r.independent&&!l&&this.flushBufferGap(a)}}},s.flushBufferGap=function(r){var a=this.media;if(a)if(v.isBuffered(a,a.currentTime)){var l=a.currentTime,u=v.bufferInfo(a,l,0),d=r.duration,f=Math.min(2*this.config.maxFragLookUpTolerance,.25*d),g=Math.max(Math.min(r.start-f,u.end-f),l+f);r.start-g>f&&this.flushMainBuffer(g,r.start)}else this.flushMainBuffer(0,r.start)},s.getFwdBufferInfo=function(r,a){var l=this.config,u=this.getLoadPosition();if(!Object(I.a)(u))return null;var d=v.bufferInfo(r,u,l.maxBufferHole);if(d.len===0&&d.nextStart!==void 0){var f=this.fragmentTracker.getBufferedFrag(u,a);if(f&&d.nextStart<f.end)return v.bufferInfo(r,u,Math.max(d.nextStart,l.maxBufferHole))}return d},s.getMaxBufferLength=function(r){var a,l=this.config;return a=r?Math.max(8*l.maxBufferSize/r,l.maxBufferLength):l.maxBufferLength,Math.min(a,l.maxMaxBufferLength)},s.reduceMaxBufferLength=function(r){var a=this.config,l=r||a.maxBufferLength;return a.maxMaxBufferLength>=l&&(a.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+a.maxMaxBufferLength+"s"),!0)},s.getNextFragment=function(r,a){var l,u,d=a.fragments,f=d.length;if(!f)return null;var g,p=this.config,y=d[0].start;if(a.live){var A=p.initialLiveManifestSize;if(f<A)return this.warn("Not enough fragments to start playback (have: "+f+", need: "+A+")"),null;a.PTSKnown||this.startFragRequested||this.startPosition!==-1||(g=this.getInitialLiveFragment(a,d),this.startPosition=g?this.hls.liveSyncPosition||g.start:r)}else r<=y&&(g=d[0]);if(!g){var E=p.lowLatencyMode?a.partEnd:a.fragmentEnd;g=this.getFragmentAtPosition(r,E,a)}return(l=g)===null||l===void 0||!l.initSegment||(u=g)!==null&&u!==void 0&&u.initSegment.data||this.bitrateTest||(g=g.initSegment),g},s.getNextPart=function(r,a,l){for(var u=-1,d=!1,f=!0,g=0,p=r.length;g<p;g++){var y=r[g];if(f=f&&!y.independent,u>-1&&l<y.start)break;var A=y.loaded;!A&&(d||y.independent||f)&&y.fragment===a&&(u=g),d=A}return u},s.loadedEndOfParts=function(r,a){var l=r[r.length-1];return l&&a>l.start&&l.loaded},s.getInitialLiveFragment=function(r,a){var l=this.fragPrevious,u=null;if(l){if(r.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+l.programDateTime),u=function(p,y,A){if(y===null||!Array.isArray(p)||!p.length||!Object(I.a)(y)||y<(p[0].programDateTime||0)||y>=(p[p.length-1].endProgramDateTime||0))return null;A=A||0;for(var E=0;E<p.length;++E){var W=p[E];if(Tt(y,A,W))return W}return null}(a,l.endProgramDateTime,this.config.maxFragLookUpTolerance)),!u){var d=l.sn+1;if(d>=r.startSN&&d<=r.endSN){var f=a[d-r.startSN];l.cc===f.cc&&(u=f,this.log("Live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=function(p,y){return st.search(p,function(A){return A.cc<y?1:A.cc>y?-1:0})}(a,l.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+u.sn)}}else{var g=this.hls.liveSyncPosition;g!==null&&(u=this.getFragmentAtPosition(g,this.bitrateTest?r.fragmentEnd:r.edge,r))}return u},s.getFragmentAtPosition=function(r,a,l){var u,d=this.config,f=this.fragPrevious,g=l.fragments,p=l.endSN,y=l.fragmentHint,A=d.maxFragLookUpTolerance,E=!!(d.lowLatencyMode&&l.partList&&y);if(E&&y&&!this.bitrateTest&&(g=g.concat(y),p=y.sn),r<a?u=ut(f,g,r,r>a-A?0:A):u=g[g.length-1],u){var W=u.sn-l.startSN,Z=f&&u.level===f.level,Q=g[W+1];f&&u.sn===f.sn&&!E&&Z&&(u.sn<p&&this.fragmentTracker.getState(Q)!==Yt.OK?(this.log("SN "+u.sn+" just loaded, load next one: "+Q.sn),u=Q):u=null)}return u},s.synchronizeToLiveEdge=function(r){var a=this.config,l=this.media;if(l){var u=this.hls.liveSyncPosition,d=l.currentTime,f=r.fragments[0].start,g=r.edge,p=d>=f-a.maxFragLookUpTolerance&&d<=g;if(u!==null&&l.duration>u&&(d<u||!p)){var y=a.liveMaxLatencyDuration!==void 0?a.liveMaxLatencyDuration:a.liveMaxLatencyDurationCount*r.targetduration;(!p&&l.readyState<4||d<g-y)&&(this.loadedmetadata||(this.nextLoadPosition=u),l.readyState&&(this.warn("Playback: "+d.toFixed(3)+" is located too far from the end of live sliding playlist: "+g+", reset currentTime to : "+u.toFixed(3)),l.currentTime=u))}}},s.alignPlaylists=function(r,a){var l=this.levels,u=this.levelLastLoaded,d=this.fragPrevious,f=u!==null?l[u]:null,g=r.fragments.length;if(!g)return this.warn("No fragments in live playlist"),0;var p=r.fragments[0].start,y=!a,A=r.alignedSliding&&Object(I.a)(p);if(y||!A&&!p){x(d,f,r);var E=r.fragments[0].start;return this.log("Live playlist sliding: "+E.toFixed(2)+" start-sn: "+(a?a.startSN:"na")+"->"+r.startSN+" prev-sn: "+(d?d.sn:"na")+" fragments: "+g),E}return p},s.waitForCdnTuneIn=function(r){return r.live&&r.canBlockReload&&r.partTarget&&r.tuneInGoal>Math.max(r.partHoldBack,3*r.partTarget)},s.setStartPosition=function(r,a){var l=this.startPosition;if(l<a&&(l=-1),l===-1||this.lastCurrentTime===-1){var u=r.startTimeOffset;Object(I.a)(u)?(l=a+u,u<0&&(l+=r.totalduration),l=Math.min(Math.max(a,l),a+r.totalduration),this.log("Start time offset "+u+" found in playlist, adjust startPosition to "+l),this.startPosition=l):r.live?l=this.hls.liveSyncPosition||a:this.startPosition=l=0,this.lastCurrentTime=l}this.nextLoadPosition=l},s.getLoadPosition=function(){var r=this.media,a=0;return this.loadedmetadata&&r?a=r.currentTime:this.nextLoadPosition&&(a=this.nextLoadPosition),a},s.handleFragLoadAborted=function(r,a){this.transmuxer&&r.sn!=="initSegment"&&r.stats.aborted&&(this.warn("Fragment "+r.sn+(a?" part"+a.index:"")+" of level "+r.level+" was aborted"),this.resetFragmentLoading(r))},s.resetFragmentLoading=function(r){this.fragCurrent&&this.fragContextChanged(r)||(this.state=xt)},s.onFragmentOrKeyLoadError=function(r,a){if(!a.fatal){var l=a.frag;if(l&&l.type===r){this.fragCurrent;var u=this.config;if(this.fragLoadError+1<=u.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(l.level))return;var d=Math.min(Math.pow(2,this.fragLoadError)*u.fragLoadingRetryDelay,u.fragLoadingMaxRetryTimeout);this.warn("Fragment "+l.sn+" of "+r+" "+l.level+" failed to load, retrying in "+d+"ms"),this.retryDate=self.performance.now()+d,this.fragLoadError++,this.state=Ie}else a.levelRetry?(r===G.b.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=xt):(S.b.error(a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.stopLoad(),this.state=Ke)}}},s.afterBufferFlushed=function(r,a,l){if(r){var u=v.getBuffered(r);this.fragmentTracker.detectEvictedFragments(a,u,l),this.state===Ze&&this.resetLoadingState()}},s.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=xt},s.resetLiveStartWhenNotLoaded=function(r){if(!this.loadedmetadata){this.startFragRequested=!1;var a=this.levels?this.levels[r].details:null;if(a!=null&&a.live)return this.startPosition=-1,this.setStartPosition(a,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},s.updateLevelTiming=function(r,a,l,u){var d=this,f=l.details;Object.keys(r.elementaryStreams).reduce(function(g,p){var y=r.elementaryStreams[p];if(y){var A=y.endPTS-y.startPTS;if(A<=0)return d.warn("Could not parse fragment "+r.sn+" "+p+" duration reliably ("+A+")"),g||!1;var E=u?0:ne(f,r,y.startPTS,y.endPTS,y.startDTS,y.endDTS);return d.hls.trigger(c.a.LEVEL_PTS_UPDATED,{details:f,level:l,drift:E,type:p,frag:r,start:y.startPTS,end:y.endPTS}),!0}return g},!1)||(this.warn("Found no media in fragment "+r.sn+" of level "+l.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=xe,this.hls.trigger(c.a.FRAG_PARSED,{frag:r,part:a})},s.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i=e,(n=[{key:"state",get:function(){return this._state},set:function(r){var a=this._state;a!==r&&(this._state=r,this.log(a+"->"+r))}}])&&ke(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),e}(F);function tr(){return self.MediaSource||self.WebKitMediaSource}function Cr(){return self.SourceBuffer||self.WebKitSourceBuffer}function wr(){var h=tr();if(!h)return!1;var o=Cr(),t=h&&typeof h.isTypeSupported=="function"&&h.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!o||o.prototype&&typeof o.prototype.appendBuffer=="function"&&typeof o.prototype.remove=="function";return!!t&&!!e}function xr(){var h=tr();return!!h&&!!(h&&typeof h.isTypeSupported=="function"&&h.isTypeSupported('video/mp4; codecs="hevc"'))}var xi=H(19),Ue=H(11),Pr=H(16),cr=tr()||{isTypeSupported:function(){return!1}},Fr=function(){function h(t,e,i,n){var s=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=t,this.id=e,this.onTransmuxComplete=i,this.onFlush=n;var r=t.config,a=function(f,g){(g=g||{}).frag=s.frag,g.id=s.id,t.trigger(f,g)};this.observer=new Pr.EventEmitter,this.observer.on(c.a.FRAG_DECRYPTED,a),this.observer.on(c.a.ERROR,a);var l={mp4:cr.isTypeSupported("video/mp4"),mpeg:cr.isTypeSupported("audio/mpeg"),mp3:cr.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(r.enableWorker&&typeof Worker<"u"){var d;S.b.log("demuxing in webworker");try{d=this.worker=xi(20),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(f){t.trigger(c.a.ERROR,{type:R.b.OTHER_ERROR,details:R.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(f.message+"  ("+f.filename+":"+f.lineno+")")})},d.postMessage({cmd:"init",typeSupported:l,vendor:u,id:e,config:JSON.stringify(r)})}catch(f){S.b.warn("Error in worker:",f),S.b.error("Error while initializing DemuxerWorker, fallback to inline"),d&&self.URL.revokeObjectURL(d.objectURL),this.transmuxer=new Ue.c(this.observer,l,r,u,e),this.worker=null}}else this.transmuxer=new Ue.c(this.observer,l,r,u,e)}var o=h.prototype;return o.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null,this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},o.push=function(t,e,i,n,s,r,a,l,u,d){var f,g,p=this;u.transmuxing.start=self.performance.now();var y=this.transmuxer,A=this.worker,E=r?r.start:s.start,W=s.decryptdata,Z=this.frag,Q=!(Z&&s.cc===Z.cc),it=!(Z&&u.level===Z.level),ft=Z?u.sn-Z.sn:-1,bt=this.part?u.part-this.part.index:-1,gt=!it&&(ft===1||ft===0&&bt===1),Lt=self.performance.now();(it||ft||s.stats.parsing.start===0)&&(s.stats.parsing.start=Lt),!r||!bt&&gt||(r.stats.parsing.start=Lt);var jt=!(Z&&((f=s.initSegment)===null||f===void 0?void 0:f.url)===((g=Z.initSegment)===null||g===void 0?void 0:g.url)),Vt=new Ue.b(Q,gt,l,it,E,jt);if(!gt||Q||jt){S.b.log("[transmuxer-interface, "+s.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+`
        discontinuity: `+Q+`
        trackSwitch: `+it+`
        contiguous: `+gt+`
        accurateTimeOffset: `+l+`
        timeOffset: `+E+`
        initSegmentChange: `+jt);var re=new Ue.a(i,n,e,a,d);this.configureTransmuxer(re)}if(this.frag=s,this.part=r,A)A.postMessage({cmd:"demux",data:t,decryptdata:W,chunkMeta:u,state:Vt},t instanceof ArrayBuffer?[t]:[]);else if(y){var $t=y.push(t,W,u,Vt);Object(Ue.d)($t)?$t.then(function(he){p.handleTransmuxComplete(he)}):this.handleTransmuxComplete($t)}},o.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var i=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:t});else if(i){var s=i.flush(t);Object(Ue.d)(s)?s.then(function(r){e.handleFlushResult(r,t)}):this.handleFlushResult(s,t)}},o.handleFlushResult=function(t,e){var i=this;t.forEach(function(n){i.handleTransmuxComplete(n)}),this.onFlush(e)},o.onWorkerMessage=function(t){var e=t.data,i=this.hls;switch(e.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data)}},o.configureTransmuxer=function(t){var e=this.worker,i=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):i&&i.configure(t)},o.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},h}(),Pi=function(){function h(t,e,i,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=i,this.hls=n}var o=h.prototype;return o.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},o.poll=function(t,e){var i=this.config,n=this.media,s=this.stalled;if(n!==null){var r=n.currentTime,a=n.seeking,l=this.seeking&&!a,u=!this.seeking&&a;if(this.seeking=a,r===t){if((u||l)&&(this.stalled=null),!(n.paused&&!a||n.ended||n.playbackRate===0)&&v.getBuffered(n).length){var d=v.bufferInfo(n,r,0),f=d.len>0,g=d.nextStart||0;if(f||g){if(a){var p=d.len>2,y=!g||e&&e.start<=r||g-r>2&&!this.fragmentTracker.getPartialFragment(r);if(p||y)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var A,E=Math.max(g,d.start||0)-r,W=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,Z=!(W==null||(A=W.details)===null||A===void 0)&&A.live?2*W.details.targetduration:2;if(E>0&&E<=Z)return void this._trySkipBufferHole(null)}var Q=self.performance.now();if(s!==null){var it=Q-s;if(a||!(it>=250)||(this._reportStall(d),this.media)){var ft=v.bufferInfo(n,r,i.maxBufferHole);this._tryFixBufferStall(ft,it)}}else this.stalled=Q}}}else if(this.moved=!0,s!==null){if(this.stallReported){var bt=self.performance.now()-s;S.b.warn("playback not stuck anymore @"+r+", after "+Math.round(bt)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},o._tryFixBufferStall=function(t,e){var i=this.config,n=this.fragmentTracker,s=this.media;if(s!==null){var r=s.currentTime,a=n.getPartialFragment(r);if(a&&(this._trySkipBufferHole(a)||!this.media))return;t.len>i.maxBufferHole&&e>1e3*i.highBufferWatchdogPeriod&&(S.b.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},o._reportStall=function(t){var e=this.hls,i=this.media;!this.stallReported&&i&&(this.stallReported=!0,S.b.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(t)+")"),e.trigger(c.a.ERROR,{type:R.b.MEDIA_ERROR,details:R.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:t.len}))},o._trySkipBufferHole=function(t){var e=this.config,i=this.hls,n=this.media;if(n===null)return 0;for(var s=n.currentTime,r=0,a=v.getBuffered(n),l=0;l<a.length;l++){var u=a.start(l);if(s+e.maxBufferHole>=r&&s<u){var d=Math.max(u+.05,n.currentTime+.1);return S.b.warn("skipping hole, adjusting currentTime from "+s+" to "+d),this.moved=!0,this.stalled=null,n.currentTime=d,t&&i.trigger(c.a.ERROR,{type:R.b.MEDIA_ERROR,details:R.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+d,frag:t}),d}r=a.end(l)}return 0},o._tryNudgeBuffer=function(){var t=this.config,e=this.hls,i=this.media,n=this.nudgeRetry;if(i!==null){var s=i.currentTime;if(this.nudgeRetry++,n<t.nudgeMaxRetry){var r=s+(n+1)*t.nudgeOffset;S.b.warn("Nudging 'currentTime' from "+s+" to "+r),i.currentTime=r,e.trigger(c.a.ERROR,{type:R.b.MEDIA_ERROR,details:R.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else S.b.error("Playhead still not moving while enough data buffered @"+s+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(c.a.ERROR,{type:R.b.MEDIA_ERROR,details:R.a.BUFFER_STALLED_ERROR,fatal:!0})}},h}();function Fi(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}function Mr(h,o){return(Mr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(h,o)}var Mi=function(h){var o,t;function e(r,a){var l;return(l=h.call(this,r,a,"[stream-controller]")||this).audioCodecSwap=!1,l.gapController=null,l.level=-1,l._forceStartLoad=!1,l.altAudio=!1,l.audioOnly=!1,l.fragPlaying=null,l.onvplaying=null,l.onvseeked=null,l.fragLastKbps=0,l.stalled=!1,l.couldBacktrack=!1,l.backtrackFragment=null,l.audioCodecSwitch=!1,l.videoBuffer=null,l.pauseFlag=!1,l.isLive=!0,l._registerListeners(),l}t=h,(o=e).prototype=Object.create(t.prototype),o.prototype.constructor=o,Mr(o,t);var i,n,s=e.prototype;return s._registerListeners=function(){var r=this.hls;r.on(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.a.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.a.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.a.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.a.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.a.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(c.a.ERROR,this.onError,this),r.on(c.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(c.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(c.a.BUFFER_CREATED,this.onBufferCreated,this),r.on(c.a.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(c.a.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(c.a.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var r=this.hls;r.off(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.a.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.a.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.a.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.a.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(c.a.ERROR,this.onError,this),r.off(c.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(c.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(c.a.BUFFER_CREATED,this.onBufferCreated,this),r.off(c.a.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(c.a.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(c.a.FRAG_BUFFERED,this.onFragBuffered,this)},s.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},s.startLoad=function(r){if(this.levels){var a=this.lastCurrentTime,l=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var u=l.startLevel;u===-1&&(l.config.testBandwidth?(u=0,this.bitrateTest=!0):u=l.nextAutoLevel),this.level=l.nextLoadLevel=u,this.loadedmetadata=!1}a>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),r=a),this.state=xt,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=Qt},s.stopLoad=function(){this._forceStartLoad=!1,h.prototype.stopLoad.call(this)},s.doTick=function(){switch(this.state){case xt:this.doTickIdle();break;case Ne:var r,a=this.levels,l=this.level,u=a==null||(r=a[l])===null||r===void 0?void 0:r.details;if(u&&(!u.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(u))break;this.state=xt;break}break;case Ie:var d,f=self.performance.now(),g=this.retryDate;(!g||f>=g||(d=this.media)!==null&&d!==void 0&&d.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=xt)}this.onTickEnd()},s.onTickEnd=function(){h.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},s.doTickIdle=function(){var r,a,l=this.hls,u=this.levelLastLoaded,d=this.levels,f=this.media,g=l.config,p=l.nextLoadLevel;if(u!==null&&(f||!this.startFragRequested&&g.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&d&&d[p]){var y=d[p];this.level=l.nextLoadLevel=p;var A=y.details;if(this.isLive=!A||A.live,!A||this.state===Ne||A.live&&this.levelLastLoaded!==p)this.state=Ne;else{var E=this.getMainFwdBufferInfo();if(E!==null&&!(E.len>=this.getMaxBufferLength(y.maxBitrate))){if(this._streamEnded(E,A)){var W={};return this.altAudio&&(W.type="video"),this.hls.trigger(c.a.BUFFER_EOS,W),void(this.state=Ze)}this.backtrackFragment&&this.backtrackFragment.start>E.end&&(this.backtrackFragment=null);var Z=this.backtrackFragment?this.backtrackFragment.start:E.end,Q=this.getNextFragment(Z,A);if(this.couldBacktrack&&!this.fragPrevious&&Q&&Q.sn!=="initSegment"&&this.fragmentTracker.getState(Q)!==Yt.OK){var it,ft=((it=this.backtrackFragment)!=null?it:Q).sn-A.startSN,bt=A.fragments[ft-1];bt&&Q.cc===bt.cc&&(Q=bt,this.fragmentTracker.removeFragment(bt))}else this.backtrackFragment&&E.len&&(this.backtrackFragment=null);if(Q&&this.fragmentTracker.getState(Q)===Yt.OK&&this.nextLoadPosition>Z){var gt=this.audioOnly&&!this.altAudio?tt.a.AUDIO:tt.a.VIDEO;this.afterBufferFlushed(f,gt,G.b.MAIN),Q=this.getNextFragment(this.nextLoadPosition,A)}Q&&(!Q.initSegment||Q.initSegment.data||this.bitrateTest||(Q=Q.initSegment),((r=Q.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(a=Q.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(Q,A,Z):this.loadKey(Q,A))}}}},s.loadFragment=function(r,a,l){var u,d=this.fragmentTracker.getState(r);this.fragCurrent=r,d===Yt.NOT_LOADED||d===Yt.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,r,a,l)):d===Yt.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((u=this.media)===null||u===void 0?void 0:u.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},s.getAppendedFrag=function(r){var a=this.fragmentTracker.getAppendedFrag(r,G.b.MAIN);return a&&"fragment"in a?a.fragment:a},s.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,G.b.MAIN)},s.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},s.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},s.nextLevelSwitch=function(){var r=this.levels,a=this.media;if(a!=null&&a.readyState){var l,u=this.getAppendedFrag(a.currentTime);if(u&&u.start>1&&this.flushMainBuffer(0,u.start-1),!a.paused&&r){var d=r[this.hls.nextLoadLevel],f=this.fragLastKbps;l=f&&this.fragCurrent?this.fragCurrent.duration*d.maxBitrate/(1e3*f)+1:0}else l=0;var g=this.getBufferedFrag(a.currentTime+l);if(g){var p=this.followingBufferedFrag(g);if(p){this.abortCurrentFrag();var y=p.maxStartPTS?p.maxStartPTS:p.start,A=p.duration,E=Math.max(g.end,y+Math.min(Math.max(A-this.config.maxFragLookUpTolerance,.5*A),.75*A));this.flushMainBuffer(E,Number.POSITIVE_INFINITY)}}}},s.abortCurrentFrag=function(){var r=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,r!=null&&r.loader&&r.loader.abort(),this.state){case Oe:case Ce:case Ie:case fe:case xe:this.state=xt}this.nextLoadPosition=this.getLoadPosition()},s.flushMainBuffer=function(r,a){h.prototype.flushMainBuffer.call(this,r,a,this.altAudio?"video":null)},s.onMediaAttached=function(r,a){h.prototype.onMediaAttached.call(this,r,a);var l=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),l.addEventListener("playing",this.onvplaying),l.addEventListener("seeked",this.onvseeked),this.gapController=new Pi(this.config,l,this.fragmentTracker,this.hls)},s.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),h.prototype.onMediaDetaching.call(this)},s.onMediaPlaying=function(){this.tick()},s.onMediaSeeked=function(){var r=this.media,a=r?r.currentTime:null;Object(I.a)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},s.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(c.a.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},s.onManifestParsed=function(r,a){var l,u,d,f=!1,g=!1;a.levels.forEach(function(p){(l=p.audioCodec)&&(l.indexOf("mp4a.40.2")!==-1&&(f=!0),l.indexOf("mp4a.40.5")!==-1&&(g=!0))}),this.audioCodecSwitch=f&&g&&typeof((d=Cr())==null||(u=d.prototype)===null||u===void 0?void 0:u.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},s.onLevelLoading=function(r,a){var l=this.levels;if(l&&this.state===xt){var u=l[a.level];(!u.details||u.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(u.details))&&(this.state=Ne)}},s.onLevelLoaded=function(r,a){var l,u=this.levels,d=a.level,f=a.details,g=f.totalduration;if(u){this.log("Level "+d+" loaded ["+f.startSN+","+f.endSN+"], cc ["+f.startCC+", "+f.endCC+"] duration:"+g);var p=this.fragCurrent;!p||this.state!==Ce&&this.state!==Ie||p.level!==a.level&&p.loader&&(this.state=xt,this.backtrackFragment=null,p.loader.abort());var y=u[d],A=0;if(f.live||(l=y.details)!==null&&l!==void 0&&l.live){if(f.fragments[0]||(f.deltaUpdateFailed=!0),f.deltaUpdateFailed)return;A=this.alignPlaylists(f,y.details)}if(y.details=f,this.levelLastLoaded=d,this.hls.trigger(c.a.LEVEL_UPDATED,{details:f,level:d}),this.state===Ne){if(this.waitForCdnTuneIn(f))return;this.state=xt}this.startFragRequested?f.live&&this.synchronizeToLiveEdge(f):this.setStartPosition(f,A),this.tick()}else this.warn("Levels were reset while loading level "+d)},s._handleFragmentLoadProgress=function(r){var a,l=r.frag,u=r.part,d=r.payload,f=this.levels;if(f){var g=f[l.level],p=g.details;if(p){var y=g.videoCodec,A=p.PTSKnown||!p.live,E=(a=l.initSegment)===null||a===void 0?void 0:a.data,W=this._getAudioCodec(g),Z=this.transmuxer=this.transmuxer||new Fr(this.hls,G.b.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),Q=u?u.index:-1,it=Q!==-1,ft=new T(l.level,l.sn,l.stats.chunkCount,d.byteLength,Q,it),bt=this.initPTS[l.cc];Z.push(d,E,W,y,l,u,p.totalduration,A,ft,bt)}else this.warn("Dropping fragment "+l.sn+" of level "+l.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+l.sn+" of level "+l.level+" will not be buffered")},s.onAudioTrackSwitching=function(r,a){var l=this.altAudio,u=!!a.url,d=a.id;if(!u){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var f=this.fragCurrent;f!=null&&f.loader&&(this.log("Switching to main audio track, cancel main fragment load"),f.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var g=this.hls;l&&g.trigger(c.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),g.trigger(c.a.AUDIO_TRACK_SWITCHED,{id:d})}},s.onAudioTrackSwitched=function(r,a){var l=a.id,u=!!this.hls.audioTracks[l].url;if(u){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=u,this.tick()},s.onBufferCreated=function(r,a){var l,u,d=a.tracks,f=!1;for(var g in d){var p=d[g];if(p.id==="main"){if(u=g,l=p,g==="video"){var y=d[g];y&&(this.videoBuffer=y.buffer)}}else f=!0}f&&l?(this.log("Alternate track found, use "+u+".buffered to schedule main fragment loading"),this.mediaBuffer=l.buffer):this.mediaBuffer=this.media},s.onFragBuffered=function(r,a){var l=a.frag,u=a.part;if(!l||l.type===G.b.MAIN){if(this.fragContextChanged(l))return this.warn("Fragment "+l.sn+(u?" p: "+u.index:"")+" of level "+l.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===xe&&(this.state=xt));var d=u?u.stats:l.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),l.sn!=="initSegment"&&(this.fragPrevious=l),this.fragBufferedComplete(l,u)}},s.onError=function(r,a){switch(a.details){case R.a.FRAG_LOAD_ERROR:case R.a.FRAG_LOAD_TIMEOUT:case R.a.KEY_LOAD_ERROR:case R.a.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G.b.MAIN,a);break;case R.a.LEVEL_LOAD_ERROR:case R.a.LEVEL_LOAD_TIMEOUT:this.state!==Ke&&(a.fatal?(this.warn(""+a.details),this.state=Ke):a.levelRetry||this.state!==Ne||(this.state=xt));break;case R.a.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===fe||this.state===xe)){var l=!0,u=this.getFwdBufferInfo(this.media,G.b.MAIN);u&&u.len>.5&&(l=!this.reduceMaxBufferLength(u.len)),l&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;case R.a.FRAG_PARSING_ERROR:a.fatal&&(S.b.log("---------"),this.hls.createdErrorNode(1),this.hls.destroy())}},s.checkBuffer=function(){var r=this.media,a=this.gapController;if(r&&a&&r.readyState){var l=v.getBuffered(r);if(!r.paused||this.pauseFlag||this.isLive||(this.pauseFlag=r.paused),this.fragCurrent&&!r.paused&&this.pauseFlag&&!this.isLive&&(this.pauseFlag=r.paused,this.hls.trigger(c.a.PLAYBACK_REPLAY,{frag:this.fragCurrent})),!this.loadedmetadata&&l.length)this.loadedmetadata=!0,this.seekToStartPos();else{var u=this.state!==xt?this.fragCurrent:null;a.poll(this.lastCurrentTime,u)}this.lastCurrentTime=r.currentTime}},s.onFragLoadEmergencyAborted=function(){this.state=xt,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},s.onBufferFlushed=function(r,a){var l=a.type;if(l!==tt.a.AUDIO||this.audioOnly&&!this.altAudio){var u=(l===tt.a.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(u,l,G.b.MAIN)}},s.onLevelsUpdated=function(r,a){this.levels=a.levels},s.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},s.seekToStartPos=function(){var r=this.media,a=r.currentTime,l=this.startPosition;if(l>=0&&a<l){if(r.seeking)return void S.b.log("could not seek to "+l+", already seeking at "+a);var u=v.getBuffered(r),d=(u.length?u.start(0):0)-l;d>0&&(d<this.config.maxBufferHole||d<this.config.maxFragLookUpTolerance)&&(S.b.log("adjusting start position by "+d+" to match buffer start"),l+=d,this.startPosition=l),this.log("seek to target start position "+l+" from current time "+a),r.currentTime=l}},s._getAudioCodec=function(r){var a=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=a.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),a},s._loadBitrateTestFrag=function(r){var a=this;this._doFragLoad(r).then(function(l){var u=a.hls;if(l&&!u.nextLoadLevel&&!a.fragContextChanged(r)){a.fragLoadError=0,a.state=xt,a.startFragRequested=!1,a.bitrateTest=!1;var d=r.stats;d.parsing.start=d.parsing.end=d.buffering.start=d.buffering.end=self.performance.now(),u.trigger(c.a.FRAG_LOADED,l)}})},s._handleTransmuxComplete=function(r){var a,l="main",u=this.hls,d=r.remuxResult,f=r.chunkMeta,g=this.getCurrentContext(f);if(!g)return this.warn("The loading context changed while buffering fragment "+f.sn+" of level "+f.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(f.level);var p=g.frag,y=g.part,A=g.level,E=d.video,W=d.text,Z=d.id3,Q=d.initSegment,it=A.details,ft=this.altAudio?void 0:d.audio;if(!this.fragContextChanged(p)){if(this.state=fe,Q){Q.tracks&&(this._bufferInitSegment(A,Q.tracks,p,f),u.trigger(c.a.FRAG_PARSING_INIT_SEGMENT,{frag:p,id:l,tracks:Q.tracks}));var bt=Q.initPTS,gt=Q.timescale;Object(I.a)(bt)&&(this.initPTS[p.cc]=bt,u.trigger(c.a.INIT_PTS_FOUND,{frag:p,id:l,initPTS:bt,timescale:gt}))}if(E&&d.independent!==!1){if(it){var Lt=E.startPTS,jt=E.endPTS,Vt=E.startDTS,re=E.endDTS;if(y)y.elementaryStreams[E.type]={startPTS:Lt,endPTS:jt,startDTS:Vt,endDTS:re};else if(E.firstKeyFrame&&E.independent&&(this.couldBacktrack=!0),E.dropped&&E.independent){var $t=this.getMainFwdBufferInfo();if(($t?$t.end:this.getLoadPosition())+this.config.maxBufferHole<(E.firstKeyFramePTS?E.firstKeyFramePTS:Lt)-this.config.maxBufferHole)return void this.backtrack(p);p.setElementaryStreamInfo(E.type,p.start,jt,p.start,re,!0)}p.setElementaryStreamInfo(E.type,Lt,jt,Vt,re),this.backtrackFragment&&(this.backtrackFragment=p),this.bufferFragmentData(E,p,y,f)}}else if(d.independent===!1)return void this.backtrack(p);if(ft){var he=ft.startPTS,ge=ft.endPTS,Jt=ft.startDTS,Zt=ft.endDTS;y&&(y.elementaryStreams[tt.a.AUDIO]={startPTS:he,endPTS:ge,startDTS:Jt,endDTS:Zt}),p.setElementaryStreamInfo(tt.a.AUDIO,he,ge,Jt,Zt),this.bufferFragmentData(ft,p,y,f)}if(it&&Z!=null&&(a=Z.samples)!==null&&a!==void 0&&a.length){var be={id:l,frag:p,details:it,samples:Z.samples};u.trigger(c.a.FRAG_PARSING_METADATA,be)}if(it&&W){var Te={id:l,frag:p,details:it,samples:W.samples};u.trigger(c.a.FRAG_PARSING_USERDATA,Te)}}},s._bufferInitSegment=function(r,a,l,u){var d=this;if(this.state===fe){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var f=a.audio,g=a.video,p=a.audiovideo;if(f){var y=r.audioCodec,A=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(y&&(y=y.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),f.metadata.channelCount!==1&&A.indexOf("firefox")===-1&&(y="mp4a.40.5")),A.indexOf("android")!==-1&&f.container!=="audio/mpeg"&&(y="mp4a.40.2",this.log("Android: force audio codec to "+y)),r.audioCodec&&r.audioCodec!==y&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+y+'"'),f.levelCodec=y,f.id="main",this.log("Init audio buffer, container:"+f.container+", codecs[selected/level/parsed]=["+(y||"")+"/"+(r.audioCodec||"")+"/"+f.codec+"]")}g&&(g.levelCodec=r.videoCodec,g.id="main",this.log("Init video buffer, container:"+g.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+g.codec+"]")),p&&this.log("Init audiovideo buffer, container:"+p.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+p.codec+"]"),this.hls.trigger(c.a.BUFFER_CODECS,a),Object.keys(a).forEach(function(E){var W=a[E].initSegment;W!=null&&W.byteLength&&d.hls.trigger(c.a.BUFFER_APPENDING,{type:E,data:W,frag:l,part:null,chunkMeta:u,parent:l.type})}),this.tick()}},s.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,G.b.MAIN)},s.backtrack=function(r){this.couldBacktrack=!0,this.backtrackFragment=r,this.resetTransmuxer(),this.flushBufferGap(r),this.fragmentTracker.removeFragment(r),this.fragPrevious=null,this.nextLoadPosition=r.start,this.state=xt},s.checkFragmentChanged=function(){var r=this.media,a=null;if(r&&r.readyState>1&&r.seeking===!1){var l=r.currentTime;if(v.isBuffered(r,l)?a=this.getAppendedFrag(l):v.isBuffered(r,l+.1)&&(a=this.getAppendedFrag(l+.1)),a){this.backtrackFragment=null;var u=this.fragPlaying,d=a.level;u&&a.sn===u.sn&&u.level===d&&a.urlId===u.urlId||(this.hls.trigger(c.a.FRAG_CHANGED,{frag:a}),u&&u.level===d||this.hls.trigger(c.a.LEVEL_SWITCHED,{level:d}),this.fragPlaying=a)}}},i=e,(n=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentFrag",get:function(){var r=this.media;return r?this.fragPlaying||this.getAppendedFrag(r.currentTime):null}},{key:"currentProgramDateTime",get:function(){var r=this.media;if(r){var a=r.currentTime,l=this.currentFrag;if(l&&Object(I.a)(a)&&Object(I.a)(l.programDateTime)){var u=l.programDateTime+1e3*(a-l.start);return new Date(u)}}return null}},{key:"currentLevel",get:function(){var r=this.currentFrag;return r?r.level:-1}},{key:"nextBufferedFrag",get:function(){var r=this.currentFrag;return r?this.followingBufferedFrag(r):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&Fi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),e}(dr),er=function(){function h(t,e,i){e===void 0&&(e=0),i===void 0&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=i}var o=h.prototype;return o.sample=function(t,e){var i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t},o.getTotalWeight=function(){return this.totalWeight_},o.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},h}(),Ni=function(){function h(t,e,i){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new er(t),this.fast_=new er(e)}var o=h.prototype;return o.update=function(t,e){var i=this.slow_,n=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new er(t,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==e&&(this.fast_=new er(e,n.getEstimate(),n.getTotalWeight()))},o.sample=function(t,e){var i=(t=Math.max(t,this.minDelayMs_))/1e3,n=8*e/i;this.fast_.sample(i,n),this.slow_.sample(i,n)},o.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},o.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},o.destroy=function(){},h}();function Ui(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}var Bi=function(){function h(i){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=i;var n=i.config;this.bwEstimator=new Ni(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var o,t,e=h.prototype;return e.registerListeners=function(){var i=this.hls;i.on(c.a.FRAG_LOADING,this.onFragLoading,this),i.on(c.a.FRAG_LOADED,this.onFragLoaded,this),i.on(c.a.FRAG_BUFFERED,this.onFragBuffered,this),i.on(c.a.LEVEL_LOADED,this.onLevelLoaded,this),i.on(c.a.ERROR,this.onError,this)},e.unregisterListeners=function(){var i=this.hls;i.off(c.a.FRAG_LOADING,this.onFragLoading,this),i.off(c.a.FRAG_LOADED,this.onFragLoaded,this),i.off(c.a.FRAG_BUFFERED,this.onFragBuffered,this),i.off(c.a.LEVEL_LOADED,this.onLevelLoaded,this),i.off(c.a.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},e.onFragLoading=function(i,n){var s,r=n.frag;r.type===G.b.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=(s=n.part)!=null?s:null,this.timer=self.setInterval(this.onCheck,100)))},e.onLevelLoaded=function(i,n){var s=this.hls.config;n.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD)},e._abandonRulesCheck=function(){var i=this.fragCurrent,n=this.partCurrent,s=this.hls,r=s.autoLevelEnabled,a=s.config,l=s.media;if(i&&l){var u=n?n.stats:i.stats,d=n?n.duration:i.duration;if(u.aborted)return S.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!l.paused&&l.playbackRate&&l.readyState){var f=performance.now()-u.loading.start,g=Math.abs(l.playbackRate);if(!(f<=500*d/g)){var p=s.levels,y=s.minAutoLevel,A=p[i.level],E=u.total||Math.max(u.loaded,Math.round(d*A.maxBitrate/8)),W=Math.max(1,u.bwEstimate?u.bwEstimate/8:1e3*u.loaded/f),Z=(E-u.loaded)/W,Q=l.currentTime,it=(v.bufferInfo(l,Q,a.maxBufferHole).end-Q)/g;if(!(it>=2*d/g||Z<=it)){var ft,bt=Number.POSITIVE_INFINITY;for(ft=i.level-1;ft>y&&!((bt=d*p[ft].maxBitrate/(6.4*W))<it);ft--);if(!(bt>=Z)){var gt=this.bwEstimator.getEstimate();S.b.warn("Fragment "+i.sn+(n?" part "+n.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+ft+`
      Current BW estimate: `+(Object(I.a)(gt)?(gt/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+Z.toFixed(3)+` s
      Estimated load time for the next fragment: `+bt.toFixed(3)+` s
      Time to underbuffer: `+it.toFixed(3)+" s"),s.nextLoadLevel=ft,this.bwEstimator.sample(f,u.loaded),this.clearTimer(),i.loader&&(this.fragCurrent=this.partCurrent=null,i.loader.abort()),s.trigger(c.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:n,stats:u})}}}}}},e.onFragLoaded=function(i,n){var s=n.frag,r=n.part;if(s.type===G.b.MAIN&&Object(I.a)(s.sn)){var a=r?r.stats:s.stats,l=r?r.duration:s.duration;if(this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var u=this.hls.levels[s.level],d=(u.loaded?u.loaded.bytes:0)+a.loaded,f=(u.loaded?u.loaded.duration:0)+l;u.loaded={bytes:d,duration:f},u.realBitrate=Math.round(8*d/f)}if(s.bitrateTest){var g={stats:a,frag:s,part:r,id:s.type};this.onFragBuffered(c.a.FRAG_BUFFERED,g),s.bitrateTest=!1}}},e.onFragBuffered=function(i,n){var s=n.frag,r=n.part,a=r?r.stats:s.stats;if(!a.aborted&&s.type===G.b.MAIN&&s.sn!=="initSegment"){var l=a.parsing.end-a.loading.start;this.bwEstimator.sample(l,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}},e.onError=function(i,n){switch(n.details){case R.a.FRAG_LOAD_ERROR:case R.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},e.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},e.getNextABRAutoLevel=function(){var i=this.fragCurrent,n=this.partCurrent,s=this.hls,r=s.maxAutoLevel,a=s.config,l=s.minAutoLevel,u=s.media,d=n?n.duration:i?i.duration:0,f=u?u.currentTime:0,g=u&&u.playbackRate!==0?Math.abs(u.playbackRate):1,p=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,y=(v.bufferInfo(u,f,a.maxBufferHole).end-f)/g,A=this.findBestLevel(p,l,r,y,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(A>=0)return A;S.b.trace((y?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var E=d?Math.min(d,a.maxStarvationDelay):a.maxStarvationDelay,W=a.abrBandWidthFactor,Z=a.abrBandWidthUpFactor;if(!y){var Q=this.bitrateTestDelay;Q&&(E=(d?Math.min(d,a.maxLoadingDelay):a.maxLoadingDelay)-Q,S.b.trace("bitrate test took "+Math.round(1e3*Q)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*E)+" ms"),W=Z=1)}return A=this.findBestLevel(p,l,r,y+E,W,Z),Math.max(A,0)},e.findBestLevel=function(i,n,s,r,a,l){for(var u,d=this.fragCurrent,f=this.partCurrent,g=this.lastLoadedFragLevel,p=this.hls.levels,y=p[g],A=!(y==null||(u=y.details)===null||u===void 0||!u.live),E=y==null?void 0:y.codecSet,W=f?f.duration:d?d.duration:0,Z=s;Z>=n;Z--){var Q=p[Z];if(Q&&(!E||Q.codecSet===E)){var it=Q.details,ft=(f?it==null?void 0:it.partTarget:it==null?void 0:it.averagetargetduration)||W,bt=void 0;bt=Z<=g?a*i:l*i;var gt=p[Z].maxBitrate,Lt=gt*ft/bt;if(S.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+Z+"/"+Math.round(bt)+"/"+gt+"/"+ft+"/"+r+"/"+Lt),bt>gt&&(!Lt||A&&!this.bitrateTestDelay||Lt<r))return Z}}return-1},o=h,(t=[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,n=this.bwEstimator;if(!(i===-1||n&&n.canEstimate()))return i;var s=this.getNextABRAutoLevel();return i!==-1&&(s=Math.min(i,s)),s},set:function(i){this._nextAutoLevel=i}}])&&Ui(o.prototype,t),Object.defineProperty(o,"prototype",{writable:!1}),h}(),Nr=H(15);function fr(){return(fr=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])}return h}).apply(this,arguments)}function Ur(h,o){return(Ur=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(h,o)}var Gi=function(h){var o,t;function e(n,s){var r;return(r=h.call(this,n,s,"[audio-stream-controller]")||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}t=h,(o=e).prototype=Object.create(t.prototype),o.prototype.constructor=o,Ur(o,t);var i=e.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var n=this.hls;n.on(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(c.a.MANIFEST_LOADING,this.onManifestLoading,this),n.on(c.a.LEVEL_LOADED,this.onLevelLoaded,this),n.on(c.a.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(c.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(c.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(c.a.ERROR,this.onError,this),n.on(c.a.BUFFER_RESET,this.onBufferReset,this),n.on(c.a.BUFFER_CREATED,this.onBufferCreated,this),n.on(c.a.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(c.a.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(c.a.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var n=this.hls;n.off(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(c.a.MANIFEST_LOADING,this.onManifestLoading,this),n.off(c.a.LEVEL_LOADED,this.onLevelLoaded,this),n.off(c.a.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(c.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(c.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(c.a.ERROR,this.onError,this),n.off(c.a.BUFFER_RESET,this.onBufferReset,this),n.off(c.a.BUFFER_CREATED,this.onBufferCreated,this),n.off(c.a.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(c.a.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(c.a.FRAG_BUFFERED,this.onFragBuffered,this)},i.onInitPtsFound=function(n,s){var r=s.frag,a=s.id,l=s.initPTS;if(a==="main"){var u=r.cc;this.initPTS[r.cc]=l,this.log("InitPTS for cc: "+u+" found from main: "+l),this.videoTrackCC=u,this.state===He&&this.tick()}},i.startLoad=function(n){if(!this.levels)return this.startPosition=n,void(this.state=Qt);var s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,s>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),this.state=xt):(this.loadedmetadata=!1,this.state=we),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},i.doTick=function(){switch(this.state){case xt:this.doTickIdle();break;case we:var n,s=this.levels,r=this.trackId,a=s==null||(n=s[r])===null||n===void 0?void 0:n.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=He}break;case Ie:var l,u=performance.now(),d=this.retryDate;(!d||u>=d||(l=this.media)!==null&&l!==void 0&&l.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=xt);break;case He:var f=this.waitingData;if(f){var g=f.frag,p=f.part,y=f.cache,A=f.complete;if(this.initPTS[g.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=Ce;var E={frag:g,part:p,payload:y.flush(),networkDetails:null};this._handleFragmentLoadProgress(E),A&&h.prototype._handleFragmentLoadComplete.call(this,E)}else if(this.videoTrackCC!==this.waitingVideoCC)S.b.log("Waiting fragment cc ("+g.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var W=this.getLoadPosition(),Z=v.bufferInfo(this.mediaBuffer,W,this.config.maxBufferHole);dt(Z.end,this.config.maxFragLookUpTolerance,g)<0&&(S.b.log("Waiting fragment cc ("+g.cc+") @ "+g.start+" cancelled because another fragment at "+Z.end+" is needed"),this.clearWaitingFragment())}}else this.state=xt}this.onTickEnd()},i.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=xt)},i.onTickEnd=function(){var n=this.media;if(n&&n.readyState){var s=(this.mediaBuffer?this.mediaBuffer:n).buffered;!this.loadedmetadata&&s.length&&(this.loadedmetadata=!0),this.lastCurrentTime=n.currentTime}},i.doTickIdle=function(){var n,s,r=this.hls,a=this.levels,l=this.media,u=this.trackId,d=r.config;if(a&&a[u]&&(l||!this.startFragRequested&&d.startFragPrefetch)){var f=a[u].details;if(!f||f.live&&this.levelLastLoaded!==u||this.waitForCdnTuneIn(f))this.state=we;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,tt.a.AUDIO,G.b.AUDIO));var g=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,G.b.AUDIO);if(g!==null){var p=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,G.b.MAIN),y=g.len,A=this.getMaxBufferLength(p==null?void 0:p.len),E=this.audioSwitch;if(!(y>=A)||E){if(!E&&this._streamEnded(g,f))return r.trigger(c.a.BUFFER_EOS,{type:"audio"}),void(this.state=Ze);var W=f.fragments[0].start,Z=g.end;if(E){var Q=this.getLoadPosition();Z=Q,f.PTSKnown&&Q<W&&(g.end>W||g.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),l.currentTime=W+.05)}if(!(p&&Z>p.end+f.targetduration)&&(p&&p.len||!g.len)){var it=this.getNextFragment(Z,f);it?((n=it.decryptdata)===null||n===void 0?void 0:n.keyFormat)!=="identity"||(s=it.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(it,f,Z):this.loadKey(it,f):this.bufferFlushed=!0}}}}}},i.getMaxBufferLength=function(n){var s=h.prototype.getMaxBufferLength.call(this);return n?Math.max(s,n):s},i.onMediaDetaching=function(){this.videoBuffer=null,h.prototype.onMediaDetaching.call(this)},i.onAudioTracksUpdated=function(n,s){var r=s.audioTracks;this.resetTransmuxer(),this.levels=r.map(function(a){return new qt(a)})},i.onAudioTrackSwitching=function(n,s){var r=!!s.url;this.trackId=s.id;var a=this.fragCurrent;a!=null&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=xt):this.state=Qt,this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},i.onLevelLoaded=function(n,s){this.mainDetails=s.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(c.a.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},i.onAudioTrackLoaded=function(n,s){var r;if(this.mainDetails!=null){var a=this.levels,l=s.details,u=s.id;if(a){this.log("Track "+u+" loaded ["+l.startSN+","+l.endSN+"],duration:"+l.totalduration);var d=a[u],f=0;if(l.live||(r=d.details)!==null&&r!==void 0&&r.live){var g=this.mainDetails;if(l.fragments[0]||(l.deltaUpdateFailed=!0),l.deltaUpdateFailed||!g)return;!d.details&&l.hasProgramDateTime&&g.hasProgramDateTime?(at(l,g),f=l.fragments[0].start):f=this.alignPlaylists(l,d.details)}d.details=l,this.levelLastLoaded=u,this.startFragRequested||!this.mainDetails&&l.live||this.setStartPosition(d.details,f),this.state!==we||this.waitForCdnTuneIn(l)||(this.state=xt),this.tick()}else this.warn("Audio tracks were reset while loading level "+u)}else this.cachedTrackLoadedData=s},i._handleFragmentLoadProgress=function(n){var s,r=n.frag,a=n.part,l=n.payload,u=this.config,d=this.trackId,f=this.levels;if(f){var g=f[d],p=g.details,y=u.defaultAudioCodec||g.audioCodec||"mp4a.40.2",A=this.transmuxer;A||(A=this.transmuxer=new Fr(this.hls,G.b.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var E=this.initPTS[r.cc],W=(s=r.initSegment)===null||s===void 0?void 0:s.data;if(E!==void 0){var Z=a?a.index:-1,Q=Z!==-1,it=new T(r.level,r.sn,r.stats.chunkCount,l.byteLength,Z,Q);A.push(l,W,y,"",r,a,p.totalduration,!1,it,E)}else S.b.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+p.startSN+" ,"+p.endSN+"],track "+d),(this.waitingData=this.waitingData||{frag:r,part:a,cache:new Nr.a,complete:!1}).cache.push(new Uint8Array(l)),this.waitingVideoCC=this.videoTrackCC,this.state=He}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},i._handleFragmentLoadComplete=function(n){this.waitingData?this.waitingData.complete=!0:h.prototype._handleFragmentLoadComplete.call(this,n)},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(n,s){var r=s.tracks.audio;r&&(this.mediaBuffer=r.buffer),s.tracks.video&&(this.videoBuffer=s.tracks.video.buffer)},i.onFragBuffered=function(n,s){var r=s.frag,a=s.part;r.type===G.b.AUDIO&&(this.fragContextChanged(r)?this.warn("Fragment "+r.sn+(a?" p: "+a.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(r.sn!=="initSegment"&&(this.fragPrevious=r,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(c.a.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(r,a)))},i.onError=function(n,s){switch(s.details){case R.a.FRAG_LOAD_ERROR:case R.a.FRAG_LOAD_TIMEOUT:case R.a.KEY_LOAD_ERROR:case R.a.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(G.b.AUDIO,s);break;case R.a.AUDIO_TRACK_LOAD_ERROR:case R.a.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==Ke&&this.state!==Qt&&(this.state=s.fatal?Ke:xt,this.warn(s.details+" while loading frag, switching to "+this.state+" state"));break;case R.a.BUFFER_FULL_ERROR:if(s.parent==="audio"&&(this.state===fe||this.state===xe)){var r=!0,a=this.getFwdBufferInfo(this.mediaBuffer,G.b.AUDIO);a&&a.len>.5&&(r=!this.reduceMaxBufferLength(a.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,h.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},i.onBufferFlushed=function(n,s){s.type===tt.a.AUDIO&&(this.bufferFlushed=!0)},i._handleTransmuxComplete=function(n){var s,r="audio",a=this.hls,l=n.remuxResult,u=n.chunkMeta,d=this.getCurrentContext(u);if(!d)return this.warn("The loading context changed while buffering fragment "+u.sn+" of level "+u.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(u.level);var f=d.frag,g=d.part,p=d.level.details,y=l.audio,A=l.text,E=l.id3,W=l.initSegment;if(!this.fragContextChanged(f)&&p){if(this.state=fe,this.audioSwitch&&y&&this.completeAudioSwitch(),W!=null&&W.tracks&&(this._bufferInitSegment(W.tracks,f,u),a.trigger(c.a.FRAG_PARSING_INIT_SEGMENT,{frag:f,id:r,tracks:W.tracks})),y){var Z=y.startPTS,Q=y.endPTS,it=y.startDTS,ft=y.endDTS;g&&(g.elementaryStreams[tt.a.AUDIO]={startPTS:Z,endPTS:Q,startDTS:it,endDTS:ft}),f.setElementaryStreamInfo(tt.a.AUDIO,Z,Q,it,ft),this.bufferFragmentData(y,f,g,u)}if(E!=null&&(s=E.samples)!==null&&s!==void 0&&s.length){var bt=fr({id:r,frag:f,details:p},E);a.trigger(c.a.FRAG_PARSING_METADATA,bt)}if(A){var gt=fr({id:r,frag:f,details:p},A);a.trigger(c.a.FRAG_PARSING_USERDATA,gt)}}},i._bufferInitSegment=function(n,s,r){if(this.state===fe){n.video&&delete n.video;var a=n.audio;if(a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(c.a.BUFFER_CODECS,n);var l=a.initSegment;if(l!=null&&l.byteLength){var u={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:l};this.hls.trigger(c.a.BUFFER_APPENDING,u)}this.tick()}}},i.loadFragment=function(n,s,r){var a=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||a===Yt.NOT_LOADED||a===Yt.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n):s.live&&!Object(I.a)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=He):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,n,s,r)))},i.completeAudioSwitch=function(){var n=this.hls,s=this.media,r=this.trackId;s&&(this.log("Switching audio track : flushing all audio"),h.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(c.a.AUDIO_TRACK_SWITCHED,{id:r})},e}(dr);function ji(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}function Br(h,o){return(Br=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(h,o)}var Ki=function(h){var o,t;function e(r){var a;return(a=h.call(this,r,"[audio-track-controller]")||this).tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.trackName="",a.selectDefaultTrack=!0,a.registerListeners(),a}t=h,(o=e).prototype=Object.create(t.prototype),o.prototype.constructor=o,Br(o,t);var i,n,s=e.prototype;return s.registerListeners=function(){var r=this.hls;r.on(c.a.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.a.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.a.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.a.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(c.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(c.a.ERROR,this.onError,this)},s.unregisterListeners=function(){var r=this.hls;r.off(c.a.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.a.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.a.LEVEL_LOADING,this.onLevelLoading,this),r.off(c.a.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(c.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(c.a.ERROR,this.onError,this)},s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,h.prototype.destroy.call(this)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},s.onManifestParsed=function(r,a){this.tracks=a.audioTracks||[]},s.onAudioTrackLoaded=function(r,a){var l=a.id,u=a.details,d=this.tracksInGroup[l];if(d){var f=d.details;d.details=a.details,this.log("audioTrack "+l+" loaded ["+u.startSN+"-"+u.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,a,f))}else this.warn("Invalid audio track id "+l)},s.onLevelLoading=function(r,a){this.switchLevel(a.level)},s.onLevelSwitching=function(r,a){this.switchLevel(a.level)},s.switchLevel=function(r){var a=this.hls.levels[r];if(a!=null&&a.audioGroupIds){var l=a.audioGroupIds[a.urlId];if(this.groupId!==l){this.groupId=l;var u=this.tracks.filter(function(f){return!l||f.groupId===l});this.selectDefaultTrack&&!u.some(function(f){return f.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var d={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(c.a.AUDIO_TRACKS_UPDATED,d),this.selectInitialTrack()}}},s.onError=function(r,a){h.prototype.onError.call(this,r,a),!a.fatal&&a.context&&a.context.type===G.a.AUDIO_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},s.setAudioTrack=function(r){var a=this.tracksInGroup;if(r<0||r>=a.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var l=a[this.trackId];this.log("Now switching to audio-track index "+r);var u=a[r],d=u.id,f=u.groupId,g=f===void 0?"":f,p=u.name,y=u.type,A=u.url;if(this.trackId=r,this.trackName=p,this.selectDefaultTrack=!1,this.hls.trigger(c.a.AUDIO_TRACK_SWITCHING,{id:d,groupId:g,name:p,type:y,url:A}),!u.details||u.details.live){var E=this.switchParams(u.url,l==null?void 0:l.details);this.loadPlaylist(E)}}},s.selectInitialTrack=function(){this.tracksInGroup;var r=this.trackName,a=this.findTrackId(r)||this.findTrackId();a!==-1?this.setAudioTrack(a):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(c.a.ERROR,{type:R.b.MEDIA_ERROR,details:R.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},s.findTrackId=function(r){for(var a=this.tracksInGroup,l=0;l<a.length;l++){var u=a[l];if((!this.selectDefaultTrack||u.default)&&(!r||r===u.name))return u.id}return-1},s.loadPlaylist=function(r){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var l=a.id,u=a.groupId,d=a.url;if(r)try{d=r.addDirectives(d)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("loading audio-track playlist for id: "+l),this.clearTimer(),this.hls.trigger(c.a.AUDIO_TRACK_LOADING,{url:d,id:l,groupId:u,deliveryDirectives:r||null})}},i=e,(n=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}}])&&ji(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),e}(ae);function Hi(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}function Gr(h,o){return(Gr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(h,o)}var Vi=function(h){var o,t;function e(r,a){var l;return(l=h.call(this,r,a,"[subtitle-stream-controller]")||this).levels=[],l.currentTrackId=-1,l.tracksBuffered=[],l.mainDetails=null,l._registerListeners(),l}t=h,(o=e).prototype=Object.create(t.prototype),o.prototype.constructor=o,Gr(o,t);var i,n,s=e.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var r=this.hls;r.on(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.a.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.a.LEVEL_LOADED,this.onLevelLoaded,this),r.on(c.a.ERROR,this.onError,this),r.on(c.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(c.a.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(c.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(c.a.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(c.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},s._unregisterListeners=function(){var r=this.hls;r.off(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.a.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.a.LEVEL_LOADED,this.onLevelLoaded,this),r.off(c.a.ERROR,this.onError,this),r.off(c.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(c.a.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(c.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(c.a.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(c.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},s.startLoad=function(){this.stopLoad(),this.state=xt,this.setInterval(500),this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(r,a){this.mainDetails=a.details},s.onSubtitleFragProcessed=function(r,a){var l=a.frag,u=a.success;if(this.fragPrevious=l,this.state=xt,u){var d=this.tracksBuffered[this.currentTrackId];if(d){for(var f,g=l.start,p=0;p<d.length;p++)if(g>=d[p].start&&g<=d[p].end){f=d[p];break}var y=l.start+l.duration;f?f.end=y:(f={start:g,end:y},d.push(f)),this.fragmentTracker.fragBuffered(l)}}},s.onBufferFlushing=function(r,a){var l=a.startOffset,u=a.endOffset;if(l===0&&u!==Number.POSITIVE_INFINITY){var d=this.currentTrackId,f=this.levels;if(!f.length||!f[d]||!f[d].details)return;var g=u-f[d].details.targetduration;if(g<=0)return;a.endOffsetSubtitles=Math.max(0,g),this.tracksBuffered.forEach(function(p){for(var y=0;y<p.length;)if(p[y].end<=g)p.shift();else{if(!(p[y].start<g))break;p[y].start=g,y++}}),this.fragmentTracker.removeFragmentsInRange(l,g,G.b.SUBTITLE)}},s.onError=function(r,a){var l,u=a.frag;u&&u.type===G.b.SUBTITLE&&((l=this.fragCurrent)!==null&&l!==void 0&&l.loader&&this.fragCurrent.loader.abort(),this.state=xt)},s.onSubtitleTracksUpdated=function(r,a){var l=this,u=a.subtitleTracks;this.tracksBuffered=[],this.levels=u.map(function(d){return new qt(d)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(d){l.tracksBuffered[d.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(r,a){if(this.currentTrackId=a.id,this.levels.length&&this.currentTrackId!==-1){var l=this.levels[this.currentTrackId];l!=null&&l.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,l&&this.setInterval(500)}else this.clearInterval()},s.onSubtitleTrackLoaded=function(r,a){var l,u=a.details,d=a.id,f=this.currentTrackId,g=this.levels;if(g.length){var p=g[f];if(!(d>=g.length||d!==f)&&p){if(this.mediaBuffer=this.mediaBufferTimeRanges,u.live||(l=p.details)!==null&&l!==void 0&&l.live){var y=this.mainDetails;if(u.deltaUpdateFailed||!y)return;var A=y.fragments[0];p.details?this.alignPlaylists(u,p.details)===0&&A&&pe(u,A.start):u.hasProgramDateTime&&y.hasProgramDateTime?at(u,y):A&&pe(u,A.start)}p.details=u,this.levelLastLoaded=d,this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===xt&&(ut(null,u.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),p.details=void 0))}}},s._handleFragmentLoadComplete=function(r){var a=r.frag,l=r.payload,u=a.decryptdata,d=this.hls;if(!this.fragContextChanged(a)&&l&&l.byteLength>0&&u&&u.key&&u.iv&&u.method==="AES-128"){var f=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(l),u.key.buffer,u.iv.buffer).then(function(g){var p=performance.now();d.trigger(c.a.FRAG_DECRYPTED,{frag:a,payload:g,stats:{tstart:f,tdecrypt:p}})})}},s.doTick=function(){if(this.media){if(this.state===xt){var r,a=this.currentTrackId,l=this.levels;if(!l.length||!l[a]||!l[a].details)return;var u=l[a].details,d=u.targetduration,f=this.config,g=this.media,p=v.bufferedInfo(this.mediaBufferTimeRanges,g.currentTime-d,f.maxBufferHole),y=p.end;if(p.len>this.getMaxBufferLength()+d)return;var A,E=u.fragments,W=E.length,Z=u.edge,Q=this.fragPrevious;if(y<Z){var it=f.maxFragLookUpTolerance;!(A=ut(Q,E,Math.max(E[0].start,y),it))&&Q&&Q.start<E[0].start&&(A=E[0])}else A=E[W-1];(r=A)!==null&&r!==void 0&&r.encrypted?this.loadKey(A,u):A&&this.fragmentTracker.getState(A)===Yt.NOT_LOADED&&this.loadFragment(A,u,y)}}else this.state=xt},s.loadFragment=function(r,a,l){this.fragCurrent=r,h.prototype.loadFragment.call(this,r,a,l)},i=e,(n=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&Hi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),e}(dr);function Yi(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}function jr(h,o){return(jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(h,o)}function gr(h){for(var o=[],t=0;t<h.length;t++){var e=h[t];e.kind==="subtitles"&&e.label&&o.push(h[t])}return o}var Ut,Wi=function(h){var o,t;function e(r){var a;return(a=h.call(this,r,"[subtitle-track-controller]")||this).media=null,a.tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.selectDefaultTrack=!0,a.queuedDefaultTrack=-1,a.trackChangeListener=function(){return a.onTextTracksChanged()},a.asyncPollTrackChange=function(){return a.pollTrackChange(0)},a.useTextTrackPolling=!1,a.subtitlePollingInterval=-1,a._subtitleDisplay=!0,a.registerListeners(),a}t=h,(o=e).prototype=Object.create(t.prototype),o.prototype.constructor=o,jr(o,t);var i,n,s=e.prototype;return s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,h.prototype.destroy.call(this)},s.registerListeners=function(){var r=this.hls;r.on(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(c.a.MANIFEST_LOADING,this.onManifestLoading,this),r.on(c.a.MANIFEST_PARSED,this.onManifestParsed,this),r.on(c.a.LEVEL_LOADING,this.onLevelLoading,this),r.on(c.a.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(c.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(c.a.ERROR,this.onError,this)},s.unregisterListeners=function(){var r=this.hls;r.off(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(c.a.MANIFEST_LOADING,this.onManifestLoading,this),r.off(c.a.MANIFEST_PARSED,this.onManifestParsed,this),r.off(c.a.LEVEL_LOADING,this.onLevelLoading,this),r.off(c.a.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(c.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(c.a.ERROR,this.onError,this)},s.onMediaAttached=function(r,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},s.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,r)},s.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),gr(this.media.textTracks).forEach(function(r){pt(r)}),this.subtitleTrack=-1,this.media=null)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},s.onManifestParsed=function(r,a){this.tracks=a.subtitleTracks},s.onSubtitleTrackLoaded=function(r,a){var l=a.id,u=a.details,d=this.trackId,f=this.tracksInGroup[d];if(f){var g=f.details;f.details=a.details,this.log("subtitle track "+l+" loaded ["+u.startSN+"-"+u.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,a,g))}else this.warn("Invalid subtitle track id "+l)},s.onLevelLoading=function(r,a){this.switchLevel(a.level)},s.onLevelSwitching=function(r,a){this.switchLevel(a.level)},s.switchLevel=function(r){var a=this.hls.levels[r];if(a!=null&&a.textGroupIds){var l=a.textGroupIds[a.urlId];if(this.groupId!==l){var u=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,d=this.tracks.filter(function(p){return!l||p.groupId===l});this.tracksInGroup=d;var f=this.findTrackId(u==null?void 0:u.name)||this.findTrackId();this.groupId=l;var g={subtitleTracks:d};this.log("Updating subtitle tracks, "+d.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(c.a.SUBTITLE_TRACKS_UPDATED,g),f!==-1&&this.setSubtitleTrack(f,u)}}},s.findTrackId=function(r){for(var a=this.tracksInGroup,l=0;l<a.length;l++){var u=a[l];if((!this.selectDefaultTrack||u.default)&&(!r||r===u.name))return u.id}return-1},s.onError=function(r,a){h.prototype.onError.call(this,r,a),!a.fatal&&a.context&&a.context.type===G.a.SUBTITLE_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},s.loadPlaylist=function(r){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var l=a.id,u=a.groupId,d=a.url;if(r)try{d=r.addDirectives(d)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(c.a.SUBTITLE_TRACK_LOADING,{url:d,id:l,groupId:u,deliveryDirectives:r||null})}},s.toggleTrackModes=function(r){var a=this,l=this.media,u=this.trackId;if(l){var d=gr(l.textTracks),f=d.filter(function(y){return y.groupId===a.groupId});if(r===-1)[].slice.call(d).forEach(function(y){y.mode="disabled"});else{var g=f[u];g&&(g.mode="disabled")}var p=f[r];p&&(p.mode=this.subtitleDisplay?"showing":"hidden")}},s.setSubtitleTrack=function(r,a){var l,u=this.tracksInGroup;if(this.media){if(this.trackId!==r&&this.toggleTrackModes(r),!(this.trackId===r&&(r===-1||(l=u[r])!==null&&l!==void 0&&l.details)||r<-1||r>=u.length)){this.clearTimer();var d=u[r];if(this.log("Switching to subtitle track "+r),this.trackId=r,d){var f=d.id,g=d.groupId,p=g===void 0?"":g,y=d.name,A=d.type,E=d.url;this.hls.trigger(c.a.SUBTITLE_TRACK_SWITCH,{id:f,groupId:p,name:y,type:A,url:E});var W=this.switchParams(d.url,a==null?void 0:a.details);this.loadPlaylist(W)}else this.hls.trigger(c.a.SUBTITLE_TRACK_SWITCH,{id:r})}}else this.queuedDefaultTrack=r},s.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var r=-1,a=gr(this.media.textTracks),l=0;l<a.length;l++)if(a[l].mode==="hidden")r=l;else if(a[l].mode==="showing"){r=l;break}this.subtitleTrack!==r&&(this.subtitleTrack=r)}},i=e,(n=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1;var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(r,a)}}])&&Yi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),e}(ae),qi=function(){function h(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var o=h.prototype;return o.append=function(t,e){var i=this.queues[e];i.push(t),i.length===1&&this.buffers[e]&&this.executeNext(e)},o.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},o.appendBlocker=function(t){var e,i=new Promise(function(s){e=s}),n={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,t),i},o.executeNext=function(t){var e=this.buffers,i=this.queues,n=e[t],s=i[t];if(s.length){var r=s[0];try{r.execute()}catch(a){S.b.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),r.onError(a),n&&n.updating||(s.shift(),this.executeNext(t))}}},o.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},o.current=function(t){return this.queues[t][0]},h}(),Kr=tr(),Hr=/([ha]vc.)(?:\.[^.,]+)+/,zi=function(){function h(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=e.hls,n=e.media,s=e.mediaSource;S.b.log("[buffer-controller]: Media source opened"),n&&(e.updateMediaElementDuration(),i.trigger(c.a.MEDIA_ATTACHED,{media:n})),s&&s.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){S.b.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){S.b.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var o=h.prototype;return o.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},o.destroy=function(){this.unregisterListeners(),this.details=null},o.registerListeners=function(){var t=this.hls;t.on(c.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(c.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(c.a.BUFFER_RESET,this.onBufferReset,this),t.on(c.a.BUFFER_APPENDING,this.onBufferAppending,this),t.on(c.a.BUFFER_CODECS,this.onBufferCodecs,this),t.on(c.a.BUFFER_EOS,this.onBufferEos,this),t.on(c.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(c.a.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(c.a.FRAG_PARSED,this.onFragParsed,this),t.on(c.a.FRAG_CHANGED,this.onFragChanged,this)},o.unregisterListeners=function(){var t=this.hls;t.off(c.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(c.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(c.a.BUFFER_RESET,this.onBufferReset,this),t.off(c.a.BUFFER_APPENDING,this.onBufferAppending,this),t.off(c.a.BUFFER_CODECS,this.onBufferCodecs,this),t.off(c.a.BUFFER_EOS,this.onBufferEos,this),t.off(c.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(c.a.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(c.a.FRAG_PARSED,this.onFragParsed,this),t.off(c.a.FRAG_CHANGED,this.onFragChanged,this)},o._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new qi(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},o.onManifestParsed=function(t,e){var i=2;(e.audio&&!e.video||!e.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,S.b.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},o.onMediaAttaching=function(t,e){var i=this.media=e.media;if(i&&Kr){var n=this.mediaSource=new Kr;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(n),this._objectUrl=i.src}},o.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,i=this._objectUrl;if(e){if(S.b.log("[buffer-controller]: media source detaching"),e.readyState==="open")try{e.endOfStream()}catch(n){S.b.warn("[buffer-controller]: onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(i&&self.URL.revokeObjectURL(i),t.src===i?(t.removeAttribute("src"),t.load()):S.b.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(c.a.MEDIA_DETACHED,void 0)},o.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(e){var i=t.sourceBuffer[e];try{i&&(t.removeBufferListeners(e),t.mediaSource&&t.mediaSource.removeSourceBuffer(i),t.sourceBuffer[e]=void 0)}catch(n){S.b.warn("[buffer-controller]: Failed to reset the "+e+" buffer",n)}}),this._initSourceBuffer()},o.onBufferCodecs=function(t,e){var i=this,n=this.getSourceBufferTypes().length;Object.keys(e).forEach(function(s){if(n){var r=i.tracks[s];if(r&&typeof r.buffer.changeType=="function"){var a=e[s],l=a.id,u=a.codec,d=a.levelCodec,f=a.container,g=a.metadata,p=(r.levelCodec||r.codec).replace(Hr,"$1"),y=(d||u).replace(Hr,"$1");if(p!==y){var A=f+";codecs="+(d||u);i.appendChangeType(s,A),S.b.log("[buffer-controller]: switching codec "+p+" to "+y),i.tracks[s]={buffer:r.buffer,codec:u,container:f,levelCodec:d,metadata:g,id:l}}}}else i.pendingTracks[s]=e[s]}),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},o.appendChangeType=function(t,e){var i=this,n=this.operationQueue,s={execute:function(){var r=i.sourceBuffer[t];r&&(S.b.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+e),r.changeType(e)),n.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(r){S.b.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",r)}};n.append(s,t)},o.onBufferAppending=function(t,e){var i=this,n=this.hls,s=this.operationQueue,r=this.tracks,a=e.data,l=e.type,u=e.frag,d=e.part,f=e.chunkMeta,g=f.buffering[l],p=self.performance.now();g.start=p;var y=u.stats.buffering,A=d?d.stats.buffering:null;y.start===0&&(y.start=p),A&&A.start===0&&(A.start=p);var E=r.audio,W=l==="audio"&&f.id===1&&(E==null?void 0:E.container)==="audio/mpeg",Z={execute:function(){if(g.executeStart=self.performance.now(),W){var Q=i.sourceBuffer[l];if(Q){var it=u.start-Q.timestampOffset;Math.abs(it)>=.1&&(S.b.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+u.start+" (delta: "+it+") sn: "+u.sn+")"),Q.timestampOffset=u.start)}}i.appendExecutor(a,l)},onStart:function(){},onComplete:function(){var Q=self.performance.now();g.executeEnd=g.end=Q,y.first===0&&(y.first=Q),A&&A.first===0&&(A.first=Q);var it=i.sourceBuffer,ft={};for(var bt in it)ft[bt]=v.getBuffered(it[bt]);i.appendError=0,i.hls.trigger(c.a.BUFFER_APPENDED,{type:l,frag:u,part:d,chunkMeta:f,parent:u.type,timeRanges:ft})},onError:function(Q){S.b.error("[buffer-controller]: Error encountered while trying to append to the "+l+" SourceBuffer",Q);var it={type:R.b.MEDIA_ERROR,parent:u.type,details:R.a.BUFFER_APPEND_ERROR,err:Q,fatal:!1};Q.code===DOMException.QUOTA_EXCEEDED_ERR?it.details=R.a.BUFFER_FULL_ERROR:(i.appendError++,it.details=R.a.BUFFER_APPEND_ERROR,i.appendError>n.config.appendErrorMaxRetry&&(S.b.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),it.fatal=!0)),n.trigger(c.a.ERROR,it)}};s.append(Z,l)},o.onBufferFlushing=function(t,e){var i=this,n=this.operationQueue,s=function(r){return{execute:i.removeExecutor.bind(i,r,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(c.a.BUFFER_FLUSHED,{type:r})},onError:function(a){S.b.warn("[buffer-controller]: Failed to remove from "+r+" SourceBuffer",a)}}};e.type?n.append(s(e.type),e.type):this.getSourceBufferTypes().forEach(function(r){n.append(s(r),r)})},o.onFragParsed=function(t,e){var i=this,n=e.frag,s=e.part,r=[],a=s?s.elementaryStreams:n.elementaryStreams;a[tt.a.AUDIOVIDEO]?r.push("audiovideo"):(a[tt.a.AUDIO]&&r.push("audio"),a[tt.a.VIDEO]&&r.push("video")),r.length===0&&S.b.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var l=self.performance.now();n.stats.buffering.end=l,s&&(s.stats.buffering.end=l);var u=s?s.stats:n.stats;i.hls.trigger(c.a.FRAG_BUFFERED,{frag:n,part:s,stats:u,id:n.type})},r)},o.onFragChanged=function(t,e){this.flushBackBuffer()},o.onBufferEos=function(t,e){var i=this;this.getSourceBufferTypes().reduce(function(n,s){var r=i.sourceBuffer[s];return e.type&&e.type!==s||r&&!r.ended&&(r.ended=!0,S.b.log("[buffer-controller]: "+s+" sourceBuffer now EOS")),n&&!(r&&!r.ended)},!0)&&this.blockBuffers(function(){var n=i.mediaSource;n&&n.readyState==="open"&&n.endOfStream()})},o.onLevelUpdated=function(t,e){var i=e.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},o.flushBackBuffer=function(){var t=this.hls,e=this.details,i=this.media,n=this.sourceBuffer;if(i&&e!==null){var s=this.getSourceBufferTypes();if(s.length){var r=e.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(I.a)(r)&&!(r<0)){var a=i.currentTime,l=e.levelTargetDuration,u=Math.max(r,l),d=Math.floor(a/l)*l-u;s.forEach(function(f){var g=n[f];if(g){var p=v.getBuffered(g);p.length>0&&d>p.start(0)&&(t.trigger(c.a.BACK_BUFFER_REACHED,{bufferEnd:d}),e.live&&t.trigger(c.a.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d}),t.trigger(c.a.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:f}))}})}}}},o.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var t=this.details,e=this.hls,i=this.media,n=this.mediaSource,s=t.fragments[0].start+t.totalduration,r=i.duration,a=Object(I.a)(n.duration)?n.duration:0;t.live&&e.config.liveDurationInfinity?(S.b.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(t)):(s>a&&s>r||!Object(I.a)(r))&&(S.b.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),n.duration=s)}},o.updateSeekableRange=function(t){var e=this.mediaSource,i=t.fragments;if(i.length&&t.live&&e!=null&&e.setLiveSeekableRange){var n=Math.max(0,i[0].start),s=Math.max(n,n+t.totalduration);e.setLiveSeekableRange(n,s)}},o.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,i=this.pendingTracks,n=Object.keys(i).length;if(n&&!t||n===2){this.createSourceBuffers(i),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0)return void this.hls.trigger(c.a.ERROR,{type:R.b.MEDIA_ERROR,details:R.a.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});s.forEach(function(r){e.executeNext(r)})}},o.createSourceBuffers=function(t){var e=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var s in t)if(!e[s]){var r=t[s];if(!r)throw Error("source buffer exists for track "+s+", however track does not");var a=r.levelCodec||r.codec,l=r.container+";codecs="+a;S.b.log("[buffer-controller]: creating sourceBuffer("+l+")");try{var u=e[s]=i.addSourceBuffer(l),d=s;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[s]={buffer:u,codec:a,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},n++}catch(f){S.b.error("[buffer-controller]: error while trying to add sourceBuffer: "+f.message),this.hls.trigger(c.a.ERROR,{type:R.b.MEDIA_ERROR,details:R.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,mimeType:l})}}n&&this.hls.trigger(c.a.BUFFER_CREATED,{tracks:this.tracks})},o._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},o._onSBUpdateEnd=function(t){var e=this.operationQueue;e.current(t).onComplete(),e.shiftAndExecuteNext(t)},o._onSBUpdateError=function(t,e){S.b.error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(c.a.ERROR,{type:R.b.MEDIA_ERROR,details:R.a.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(t);i&&i.onError(e)},o.removeExecutor=function(t,e,i){var n=this.media,s=this.mediaSource,r=this.operationQueue,a=this.sourceBuffer[t];if(!n||!s||!a)return S.b.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);var l=Object(I.a)(n.duration)?n.duration:1/0,u=Object(I.a)(s.duration)?s.duration:1/0,d=Math.max(0,e),f=Math.min(i,l,u);f>d?(S.b.log("[buffer-controller]: Removing ["+d+","+f+"] from the "+t+" SourceBuffer"),a.remove(d,f)):r.shiftAndExecuteNext(t)},o.appendExecutor=function(t,e){var i=this.operationQueue,n=this.sourceBuffer[e];if(!n)return S.b.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(e);n.ended=!1,n.appendBuffer(t)},o.blockBuffers=function(t,e){var i=this;if(e===void 0&&(e=this.getSourceBufferTypes()),!e.length)return S.b.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(t);var n=this.operationQueue,s=e.map(function(r){return n.appendBlocker(r)});Promise.all(s).then(function(){t(),e.forEach(function(r){var a=i.sourceBuffer[r];a&&a.updating||n.shiftAndExecuteNext(r)})})},o.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},o.addBufferListener=function(t,e,i){var n=this.sourceBuffer[t];if(n){var s=i.bind(this,t);this.listeners[t].push({event:e,listener:s}),n.addEventListener(e,s)}},o.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach(function(i){e.removeEventListener(i.event,i.listener)})},h}(),Vr={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Yr=function(h){var o=h;return Vr.hasOwnProperty(h)&&(o=Vr[h]),String.fromCharCode(o)},Xi={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Qi={17:2,18:4,21:6,22:8,23:10,19:13,20:15},$i={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ji={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Zi=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(h){h[h.ERROR=0]="ERROR",h[h.TEXT=1]="TEXT",h[h.WARNING=2]="WARNING",h[h.INFO=2]="INFO",h[h.DEBUG=3]="DEBUG",h[h.DATA=3]="DATA"})(Ut||(Ut={}));var tn=function(){function h(){this.time=null,this.verboseLevel=Ut.ERROR}return h.prototype.log=function(o,t){this.verboseLevel>=o&&S.b.log(this.time+" ["+o+"] "+t)},h}(),Pe=function(h){for(var o=[],t=0;t<h.length;t++)o.push(h[t].toString(16));return o},Wr=function(){function h(t,e,i,n,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=n||"black",this.flash=s||!1}var o=h.prototype;return o.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},o.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],i=0;i<e.length;i++){var n=e[i];t.hasOwnProperty(n)&&(this[n]=t[n])}},o.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},o.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},o.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},o.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},h}(),en=function(){function h(t,e,i,n,s,r){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new Wr(e,i,n,s,r)}var o=h.prototype;return o.reset=function(){this.uchar=" ",this.penState.reset()},o.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},o.setPenState=function(t){this.penState.copy(t)},o.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},o.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},o.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},h}(),rn=function(){function h(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<100;e++)this.chars.push(new en);this.logger=t,this.pos=0,this.currPenState=new Wr}var o=h.prototype;return o.equals=function(t){for(var e=!0,i=0;i<100;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e},o.copy=function(t){for(var e=0;e<100;e++)this.chars[e].copy(t.chars[e])},o.isEmpty=function(){for(var t=!0,e=0;e<100;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},o.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(Ut.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(Ut.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},o.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)},o.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},o.insertChar=function(t){t>=144&&this.backSpace();var e=Yr(t);this.pos>=100?this.logger.log(Ut.ERROR,"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},o.clearFromPos=function(t){var e;for(e=t;e<100;e++)this.chars[e].reset()},o.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},o.clearToEndOfRow=function(){this.clearFromPos(this.pos)},o.getTextString=function(){for(var t=[],e=!0,i=0;i<100;i++){var n=this.chars[i].uchar;n!==" "&&(e=!1),t.push(n)}return e?"":t.join("")},o.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},h}(),vr=function(){function h(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<15;e++)this.rows.push(new rn(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var o=h.prototype;return o.reset=function(){for(var t=0;t<15;t++)this.rows[t].clear();this.currRow=14},o.equals=function(t){for(var e=!0,i=0;i<15;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e},o.copy=function(t){for(var e=0;e<15;e++)this.rows[e].copy(t.rows[e])},o.isEmpty=function(){for(var t=!0,e=0;e<15;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},o.backSpace=function(){this.rows[this.currRow].backSpace()},o.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},o.insertChar=function(t){this.rows[this.currRow].insertChar(t)},o.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},o.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},o.setCursor=function(t){this.logger.log(Ut.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},o.setPAC=function(t){this.logger.log(Ut.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var i=0;i<15;i++)this.rows[i].clear();var n=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var r=s.rows[n].cueStartTime,a=this.logger.time;if(r&&a!==null&&r<a)for(var l=0;l<this.nrRollUpRows;l++)this.rows[e-this.nrRollUpRows+l+1].copy(s.rows[n+l])}}this.currRow=e;var u=this.rows[this.currRow];if(t.indent!==null){var d=t.indent,f=Math.max(d-1,0);u.setCursor(t.indent),t.color=u.chars[f].penState.foreground}var g={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(g)},o.setBkgData=function(t){this.logger.log(Ut.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},o.setRollUpRows=function(t){this.nrRollUpRows=t},o.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(Ut.TEXT,this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(Ut.INFO,"Rolling up")}else this.logger.log(Ut.DEBUG,"roll_up but nrRollUpRows not set yet")},o.getDisplayText=function(t){t=t||!1;for(var e=[],i="",n=-1,s=0;s<15;s++){var r=this.rows[s].getTextString();r&&(n=s+1,t?e.push("Row "+n+": '"+r+"'"):e.push(r.trim()))}return e.length>0&&(i=t?"["+e.join(" | ")+"]":e.join(`
`)),i},o.getTextAndFormat=function(){return this.rows},h}(),qr=function(){function h(t,e,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new vr(i),this.nonDisplayedMemory=new vr(i),this.lastOutputScreen=new vr(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}var o=h.prototype;return o.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},o.getHandler=function(){return this.outputFilter},o.setHandler=function(t){this.outputFilter=t},o.setPAC=function(t){this.writeScreen.setPAC(t)},o.setBkgData=function(t){this.writeScreen.setBkgData(t)},o.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(Ut.INFO,"MODE="+t),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},o.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(Ut.INFO,i+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(Ut.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},o.ccRCL=function(){this.logger.log(Ut.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},o.ccBS=function(){this.logger.log(Ut.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},o.ccAOF=function(){},o.ccAON=function(){},o.ccDER=function(){this.logger.log(Ut.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},o.ccRU=function(t){this.logger.log(Ut.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},o.ccFON=function(){this.logger.log(Ut.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},o.ccRDC=function(){this.logger.log(Ut.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},o.ccTR=function(){this.logger.log(Ut.INFO,"TR"),this.setMode("MODE_TEXT")},o.ccRTD=function(){this.logger.log(Ut.INFO,"RTD"),this.setMode("MODE_TEXT")},o.ccEDM=function(){this.logger.log(Ut.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},o.ccCR=function(){this.logger.log(Ut.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},o.ccENM=function(){this.logger.log(Ut.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},o.ccEOC=function(){if(this.logger.log(Ut.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(Ut.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},o.ccTO=function(t){this.logger.log(Ut.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},o.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var i=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}this.logger.log(Ut.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},o.outputDataUpdate=function(t){t===void 0&&(t=!1);var e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},o.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},h}();function Be(h,o,t){t.a=h,t.b=o}function zr(h,o,t){return t.a===h&&t.b===o}var Xr=function(){function h(t,e,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new tn;this.channels=[null,new qr(t,e,n),new qr(t+1,i,n)],this.cmdHistory={a:null,b:null},this.logger=n}var o=h.prototype;return o.getHandler=function(t){return this.channels[t].getHandler()},o.setHandler=function(t,e){this.channels[t].setHandler(e)},o.addData=function(t,e){var i,n,s,r=!1;this.logger.time=t;for(var a=0;a<e.length;a+=2)if(n=127&e[a],s=127&e[a+1],n!==0||s!==0){if(this.logger.log(Ut.DATA,"["+Pe([e[a],e[a+1]])+"] -> ("+Pe([n,s])+")"),(i=this.parseCmd(n,s))||(i=this.parseMidrow(n,s)),i||(i=this.parsePAC(n,s)),i||(i=this.parseBackgroundAttributes(n,s)),!i&&(r=this.parseChars(n,s))){var l=this.currentChannel;l&&l>0?this.channels[l].insertChars(r):this.logger.log(Ut.WARNING,"No channel found yet. TEXT-MODE?")}i||r||this.logger.log(Ut.WARNING,"Couldn't parse cleaned data "+Pe([n,s])+" orig: "+Pe([e[a],e[a+1]]))}},o.parseCmd=function(t,e){var i=this.cmdHistory;if(!((t===20||t===28||t===21||t===29)&&e>=32&&e<=47)&&!((t===23||t===31)&&e>=33&&e<=35))return!1;if(zr(t,e,i))return Be(null,null,i),this.logger.log(Ut.DEBUG,"Repeated command ("+Pe([t,e])+") is dropped"),!0;var n=t===20||t===21||t===23?1:2,s=this.channels[n];return t===20||t===21||t===28||t===29?e===32?s.ccRCL():e===33?s.ccBS():e===34?s.ccAOF():e===35?s.ccAON():e===36?s.ccDER():e===37?s.ccRU(2):e===38?s.ccRU(3):e===39?s.ccRU(4):e===40?s.ccFON():e===41?s.ccRDC():e===42?s.ccTR():e===43?s.ccRTD():e===44?s.ccEDM():e===45?s.ccCR():e===46?s.ccENM():e===47&&s.ccEOC():s.ccTO(e-32),Be(t,e,i),this.currentChannel=n,!0},o.parseMidrow=function(t,e){var i=0;if((t===17||t===25)&&e>=32&&e<=47){if((i=t===17?1:2)!==this.currentChannel)return this.logger.log(Ut.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[i];return!!n&&(n.ccMIDROW(e),this.logger.log(Ut.DEBUG,"MIDROW ("+Pe([t,e])+")"),!0)}return!1},o.parsePAC=function(t,e){var i,n=this.cmdHistory;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127)&&!((t===16||t===24)&&e>=64&&e<=95))return!1;if(zr(t,e,n))return Be(null,null,n),!0;var s=t<=23?1:2;i=e>=64&&e<=95?s===1?Xi[t]:$i[t]:s===1?Qi[t]:Ji[t];var r=this.channels[s];return!!r&&(r.setPAC(this.interpretPAC(i,e)),Be(t,e,n),this.currentChannel=s,!0)},o.interpretPAC=function(t,e){var i,n={color:null,italics:!1,indent:null,underline:!1,row:t};return i=e>95?e-96:e-64,n.underline=(1&i)==1,i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n},o.parseChars=function(t,e){var i,n,s=null,r=null;if(t>=25?(i=2,r=t-8):(i=1,r=t),r>=17&&r<=19?(n=r===17?e+80:r===18?e+112:e+144,this.logger.log(Ut.INFO,"Special char '"+Yr(n)+"' in channel "+i),s=[n]):t>=32&&t<=127&&(s=e===0?[t]:[t,e]),s){var a=Pe(s);this.logger.log(Ut.DEBUG,"Char codes =  "+a.join(",")),Be(t,e,this.cmdHistory)}return s},o.parseBackgroundAttributes=function(t,e){var i;if(!((t===16||t===24)&&e>=32&&e<=47)&&!((t===23||t===31)&&e>=45&&e<=47))return!1;var n={};t===16||t===24?(i=Math.floor((e-32)/2),n.background=Zi[i],e%2==1&&(n.background=n.background+"_semi")):e===45?n.background="transparent":(n.foreground="black",e===47&&(n.underline=!0));var s=t<=23?1:2;return this.channels[s].setBkgData(n),Be(t,e,this.cmdHistory),!0},o.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory={a:null,b:null}},o.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var i=this.channels[e];i&&i.cueSplitAtTime(t)}},h}(),rr=function(){function h(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var o=h.prototype;return o.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},o.newCue=function(t,e,i){(this.startTime===null||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},o.reset=function(){this.cueRanges=[],this.startTime=null},h}(),pr=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var h=["","lr","rl"],o=["start","middle","end","left","right"];function t(s,r){if(typeof r!="string"||!Array.isArray(s))return!1;var a=r.toLowerCase();return!!~s.indexOf(a)&&a}function e(s){return t(o,s)}function i(s){for(var r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];for(var u=1;u<arguments.length;u++){var d=arguments[u];for(var f in d)s[f]=d[f]}return s}function n(s,r,a){var l=this,u={enumerable:!0};l.hasBeenReset=!1;var d="",f=!1,g=s,p=r,y=a,A=null,E="",W=!0,Z="auto",Q="start",it=50,ft="middle",bt=50,gt="middle";Object.defineProperty(l,"id",i({},u,{get:function(){return d},set:function(Lt){d=""+Lt}})),Object.defineProperty(l,"pauseOnExit",i({},u,{get:function(){return f},set:function(Lt){f=!!Lt}})),Object.defineProperty(l,"startTime",i({},u,{get:function(){return g},set:function(Lt){if(typeof Lt!="number")throw new TypeError("Start time must be set to a number.");g=Lt,this.hasBeenReset=!0}})),Object.defineProperty(l,"endTime",i({},u,{get:function(){return p},set:function(Lt){if(typeof Lt!="number")throw new TypeError("End time must be set to a number.");p=Lt,this.hasBeenReset=!0}})),Object.defineProperty(l,"text",i({},u,{get:function(){return y},set:function(Lt){y=""+Lt,this.hasBeenReset=!0}})),Object.defineProperty(l,"region",i({},u,{get:function(){return A},set:function(Lt){A=Lt,this.hasBeenReset=!0}})),Object.defineProperty(l,"vertical",i({},u,{get:function(){return E},set:function(Lt){var jt=function(Vt){return t(h,Vt)}(Lt);if(jt===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=jt,this.hasBeenReset=!0}})),Object.defineProperty(l,"snapToLines",i({},u,{get:function(){return W},set:function(Lt){W=!!Lt,this.hasBeenReset=!0}})),Object.defineProperty(l,"line",i({},u,{get:function(){return Z},set:function(Lt){if(typeof Lt!="number"&&Lt!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");Z=Lt,this.hasBeenReset=!0}})),Object.defineProperty(l,"lineAlign",i({},u,{get:function(){return Q},set:function(Lt){var jt=e(Lt);if(!jt)throw new SyntaxError("An invalid or illegal string was specified.");Q=jt,this.hasBeenReset=!0}})),Object.defineProperty(l,"position",i({},u,{get:function(){return it},set:function(Lt){if(Lt<0||Lt>100)throw new Error("Position must be between 0 and 100.");it=Lt,this.hasBeenReset=!0}})),Object.defineProperty(l,"positionAlign",i({},u,{get:function(){return ft},set:function(Lt){var jt=e(Lt);if(!jt)throw new SyntaxError("An invalid or illegal string was specified.");ft=jt,this.hasBeenReset=!0}})),Object.defineProperty(l,"size",i({},u,{get:function(){return bt},set:function(Lt){if(Lt<0||Lt>100)throw new Error("Size must be between 0 and 100.");bt=Lt,this.hasBeenReset=!0}})),Object.defineProperty(l,"align",i({},u,{get:function(){return gt},set:function(Lt){var jt=e(Lt);if(!jt)throw new SyntaxError("An invalid or illegal string was specified.");gt=jt,this.hasBeenReset=!0}})),l.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}(),nn=function(){function h(){}return h.prototype.decode=function(o,t){if(!o)return"";if(typeof o!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(o))},h}();function Qr(h){function o(e,i,n,s){return 3600*(0|e)+60*(0|i)+(0|n)+parseFloat(s||0)}var t=h.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?o(t[2],t[3],0,t[4]):o(t[1],t[2],t[3],t[4]):null}var an=function(){function h(){this.values=Object.create(null)}var o=h.prototype;return o.set=function(t,e){this.get(t)||e===""||(this.values[t]=e)},o.get=function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},o.has=function(t){return t in this.values},o.alt=function(t,e,i){for(var n=0;n<i.length;++n)if(e===i[n]){this.set(t,e);break}},o.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},o.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var i=parseFloat(e);if(i>=0&&i<=100)return this.set(t,i),!0}return!1},h}();function $r(h,o,t,e){var i=e?h.split(e):[h];for(var n in i)if(typeof i[n]=="string"){var s=i[n].split(t);s.length===2&&o(s[0],s[1])}}var mr=new pr(0,0,""),ir=mr.align==="middle"?"middle":"center";function sn(h,o,t){var e=h;function i(){var s=Qr(h);if(s===null)throw new Error("Malformed timestamp: "+e);return h=h.replace(/^[^\sa-zA-Z-]+/,""),s}function n(){h=h.replace(/^\s+/,"")}if(n(),o.startTime=i(),n(),h.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+e);h=h.slice(3),n(),o.endTime=i(),n(),function(s,r){var a=new an;$r(s,function(d,f){var g;switch(d){case"region":for(var p=t.length-1;p>=0;p--)if(t[p].id===f){a.set(d,t[p].region);break}break;case"vertical":a.alt(d,f,["rl","lr"]);break;case"line":g=f.split(","),a.integer(d,g[0]),a.percent(d,g[0])&&a.set("snapToLines",!1),a.alt(d,g[0],["auto"]),g.length===2&&a.alt("lineAlign",g[1],["start",ir,"end"]);break;case"position":g=f.split(","),a.percent(d,g[0]),g.length===2&&a.alt("positionAlign",g[1],["start",ir,"end","line-left","line-right","auto"]);break;case"size":a.percent(d,f);break;case"align":a.alt(d,f,["start",ir,"end","left","right"])}},/:/,/\s/),r.region=a.get("region",null),r.vertical=a.get("vertical","");var l=a.get("line","auto");l==="auto"&&mr.line===-1&&(l=-1),r.line=l,r.lineAlign=a.get("lineAlign","start"),r.snapToLines=a.get("snapToLines",!0),r.size=a.get("size",100),r.align=a.get("align",ir);var u=a.get("position","auto");u==="auto"&&mr.position===50&&(u=r.align==="start"||r.align==="left"?0:r.align==="end"||r.align==="right"?100:50),r.position=u}(h,o)}function Jr(h){return h.replace(/<br(?: \/)?>/gi,`
`)}var on=function(){function h(){this.state="INITIAL",this.buffer="",this.decoder=new nn,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var o=h.prototype;return o.parse=function(t){var e=this;function i(){var l=e.buffer,u=0;for(l=Jr(l);u<l.length&&l[u]!=="\r"&&l[u]!==`
`;)++u;var d=l.slice(0,u);return l[u]==="\r"&&++u,l[u]===`
`&&++u,e.buffer=l.slice(u),d}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var n="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;var s=(n=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var r=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(r?r=!1:n=i(),e.state){case"HEADER":/:/.test(n)?$r(n,function(l,u){},/:/):n||(e.state="ID");continue;case"NOTE":n||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){e.state="NOTE";break}if(!n)continue;if(e.cue=new pr(0,0,""),e.state="CUE",n.indexOf("-->")===-1){e.cue.id=n;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{sn(n,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var a=n.indexOf("-->")!==-1;if(!n||a&&(r=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=n;continue;case"BADCUE":n||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},o.flush=function(){try{if((this.cue||this.state==="HEADER")&&(this.buffer+=`

`,this.parse()),this.state==="INITIAL"||this.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){this.onparsingerror&&this.onparsingerror(t)}return this.onflush&&this.onflush(),this},h}(),Zr=H(9),ln=H(13),un=/\r\n|\n\r|\n|\r/g,yr=function(h,o,t){return t===void 0&&(t=0),h.slice(t,t+o.length)===o},Tr=function(h){for(var o=5381,t=h.length;t;)o=33*o^h.charCodeAt(--t);return(o>>>0).toString()};function br(h,o,t){return Tr(h.toString())+Tr(o.toString())+Tr(t)}function hn(h,o,t,e,i,n,s,r){var a,l=new on,u=Object(Rt.f)(new Uint8Array(h)).trim().replace(un,`
`).split(`
`),d=[],f=Object(Zr.a)(o,t),g="00:00.000",p=0,y=0,A=!0;l.oncue=function(E){var W=e[i],Z=e.ccOffset,Q=(p-f)/9e4;W!=null&&W.new&&(y!==void 0?Z=e.ccOffset=W.start:function(gt,Lt,jt){var Vt=gt[Lt],re=gt[Vt.prevCC];if(!re||!re.new&&Vt.new)return gt.ccOffset=gt.presentationOffset=Vt.start,void(Vt.new=!1);for(;($t=re)!==null&&$t!==void 0&&$t.new;){var $t;gt.ccOffset+=Vt.start-re.start,Vt.new=!1,re=gt[(Vt=re).prevCC]}gt.presentationOffset=jt}(e,i,Q)),Q&&(Z=Q-e.presentationOffset);var it=E.endTime-E.startTime,ft=Object(ln.d)(9e4*(E.startTime+Z-y),9e4*n)/9e4;E.startTime=Math.max(ft,0),E.endTime=Math.max(ft+it,0);var bt=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(bt)),E.id||(E.id=br(E.startTime,E.endTime,bt)),E.endTime>0&&d.push(E)},l.onparsingerror=function(E){a=E},l.onflush=function(){a?r(a):s(d)},u.forEach(function(E){if(A){if(yr(E,"X-TIMESTAMP-MAP=")){A=!1,E.slice(16).split(",").forEach(function(W){yr(W,"LOCAL:")?g=W.slice(6):yr(W,"MPEGTS:")&&(p=parseInt(W.slice(7)))});try{y=function(W){var Z=parseInt(W.slice(-3)),Q=parseInt(W.slice(-6,-4)),it=parseInt(W.slice(-9,-7)),ft=W.length>9?parseInt(W.substring(0,W.indexOf(":"))):0;if(!(Object(I.a)(Z)&&Object(I.a)(Q)&&Object(I.a)(it)&&Object(I.a)(ft)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+W);return Z+=1e3*Q,Z+=6e4*it,Z+=36e5*ft}(g)/1e3}catch(W){a=W}return}E===""&&(A=!1)}l.parse(E+`
`)}),l.flush()}function ti(){return(ti=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])}return h}).apply(this,arguments)}var ei=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ri=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,dn={left:"start",center:"center",right:"end",start:"start",end:"end"};function ii(h,o,t,e,i){var n=Object(Y.c)(new Uint8Array(h),["mdat"]);if(n.length!==0){var s=n.map(function(a){return Object(Rt.f)(a)}),r=Object(Zr.c)(o,1,t);try{s.forEach(function(a){return e(function(l,u){var d=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!d)throw new Error("Invalid ttml");var f={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},g=Object.keys(f).reduce(function(W,Z){return W[Z]=d.getAttribute("ttp:"+Z)||f[Z],W},{}),p=d.getAttribute("xml:space")!=="preserve",y=ni(Er(d,"styling","style")),A=ni(Er(d,"layout","region")),E=Er(d,"body","[begin]");return[].map.call(E,function(W){var Z=function $t(he,ge){return[].slice.call(he.childNodes).reduce(function(Jt,Zt,be){var Te;return Zt.nodeName==="br"&&be?Jt+`
`:(Te=Zt.childNodes)!==null&&Te!==void 0&&Te.length?$t(Zt,ge):ge?Jt+Zt.textContent.trim().replace(/\s+/g," "):Jt+Zt.textContent},"")}(W,p);if(!Z||!W.hasAttribute("begin"))return null;var Q=Lr(W.getAttribute("begin"),g),it=Lr(W.getAttribute("dur"),g),ft=Lr(W.getAttribute("end"),g);if(Q===null)throw ai(W);if(ft===null){if(it===null)throw ai(W);ft=Q+it}var bt=new pr(Q-u,ft-u,Z);bt.id=br(bt.startTime,bt.endTime,bt.text);var gt=A[W.getAttribute("region")],Lt=y[W.getAttribute("style")];bt.position=10,bt.size=80;var jt=function($t,he,ge){var Jt="http://www.w3.org/ns/ttml#styling",Zt=null,be=$t!=null&&$t.hasAttribute("style")?$t.getAttribute("style"):null;return be&&ge.hasOwnProperty(be)&&(Zt=ge[be]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(Te,De){var _e=Sr(he,Jt,De)||Sr($t,Jt,De)||Sr(Zt,Jt,De);return _e&&(Te[De]=_e),Te},{})}(gt,Lt,y),Vt=jt.textAlign;if(Vt){var re=dn[Vt];re&&(bt.lineAlign=re),bt.align=Vt}return ti(bt,jt),bt}).filter(function(W){return W!==null})}(a,r))})}catch(a){i(a)}}else i(new Error("Could not parse IMSC1 mdat"))}function Er(h,o,t){var e=h.getElementsByTagName(o)[0];return e?[].slice.call(e.querySelectorAll(t)):[]}function ni(h){return h.reduce(function(o,t){var e=t.getAttribute("xml:id");return e&&(o[e]=t),o},{})}function Sr(h,o,t){return h&&h.hasAttributeNS(o,t)?h.getAttributeNS(o,t):null}function ai(h){return new Error("Could not parse ttml timestamp "+h)}function Lr(h,o){if(!h)return null;var t=Qr(h);return t===null&&(ei.test(h)?t=function(e,i){var n=ei.exec(e),s=(0|n[4])+(0|n[5])/i.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+s/i.frameRate}(h,o):ri.test(h)&&(t=function(e,i){var n=ri.exec(e),s=Number(n[1]);switch(n[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/i.frameRate;case"t":return s/i.tickRate}return s}(h,o))),t}var cn=function(){function h(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var e=new rr(this,"textTrack1"),i=new rr(this,"textTrack2"),n=new rr(this,"textTrack3"),s=new rr(this,"textTrack4");this.cea608Parser1=new Xr(1,e,i),this.cea608Parser2=new Xr(3,n,s)}t.on(c.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(c.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(c.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(c.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(c.a.FRAG_LOADING,this.onFragLoading,this),t.on(c.a.FRAG_LOADED,this.onFragLoaded,this),t.on(c.a.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(c.a.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(c.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(c.a.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(c.a.BUFFER_FLUSHING,this.onBufferFlushing,this)}var o=h.prototype;return o.destroy=function(){var t=this.hls;t.off(c.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(c.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(c.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(c.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(c.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(c.a.FRAG_LOADING,this.onFragLoading,this),t.off(c.a.FRAG_LOADED,this.onFragLoaded,this),t.off(c.a.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(c.a.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(c.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(c.a.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(c.a.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},o.addCues=function(t,e,i,n,s){for(var r,a,l,u,d=!1,f=s.length;f--;){var g=s[f],p=(r=g[0],a=g[1],l=e,u=i,Math.min(a,u)-Math.max(r,l));if(p>=0&&(g[0]=Math.min(g[0],e),g[1]=Math.max(g[1],i),d=!0,p/(i-e)>.5))return}if(d||s.push([e,i]),this.config.renderTextTracksNatively){var y=this.captionsTracks[t];this.Cues.newCue(y,e,i,n)}else{var A=this.Cues.newCue(null,e,i,n);this.hls.trigger(c.a.CUES_PARSED,{type:"captions",cues:A,track:t})}},o.onInitPtsFound=function(t,e){var i=this,n=e.frag,s=e.id,r=e.initPTS,a=e.timescale,l=this.unparsedVttFrags;s==="main"&&(this.initPTS[n.cc]=r,this.timescale[n.cc]=a),l.length&&(this.unparsedVttFrags=[],l.forEach(function(u){i.onFragLoaded(c.a.FRAG_LOADED,u)}))},o.getExistingTrack=function(t){var e=this.media;if(e)for(var i=0;i<e.textTracks.length;i++){var n=e.textTracks[i];if(n[t])return n}return null},o.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},o.createNativeTrack=function(t){if(!this.captionsTracks[t]){var e=this.captionsProperties,i=this.captionsTracks,n=this.media,s=e[t],r=s.label,a=s.languageCode,l=this.getExistingTrack(t);if(l)i[t]=l,pt(i[t]),lt(i[t],n);else{var u=this.createTextTrack("captions",r,a);u&&(u[t]=!0,i[t]=u)}}},o.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var i={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=i,this.hls.trigger(c.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},o.createTextTrack=function(t,e,i){var n=this.media;if(n)return n.addTextTrack(t,e,i)},o.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},o.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){pt(t[e]),delete t[e]}),this.nonNativeCaptionsTracks={}},o.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},o._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var i=0;i<e.length;i++)pt(e[i])}},o.onSubtitleTracksUpdated=function(t,e){var i=this;this.textTracks=[];var n=e.subtitleTracks||[],s=n.some(function(u){return u.textCodec==="stpp.ttml.im1t"});if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var a=this.media?this.media.textTracks:[];this.tracks.forEach(function(u,d){var f;if(d<a.length){for(var g=null,p=0;p<a.length;p++)if(fn(a[p],u)){g=a[p];break}g&&(f=g)}f?pt(f):(f=i.createTextTrack("subtitles",u.name,u.lang))&&(f.mode="disabled"),f&&(f.groupId=u.groupId,i.textTracks.push(f))})}else if(!r&&this.tracks&&this.tracks.length){var l=this.tracks.map(function(u){return{label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}});this.hls.trigger(c.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},o.onManifestLoaded=function(t,e){var i=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(n){var s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(s){var r="textTrack"+s[1],a=i.captionsProperties[r];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)}})},o.onFragLoading=function(t,e){var i=this.cea608Parser1,n=this.cea608Parser2,s=this.lastSn,r=this.lastPartIndex;if(this.enabled&&i&&n&&e.frag.type===G.b.MAIN){var a,l,u=e.frag.sn,d=(a=e==null||(l=e.part)===null||l===void 0?void 0:l.index)!=null?a:-1;u===s+1||u===s&&d===r+1||(i.reset(),n.reset()),this.lastSn=u,this.lastPartIndex=d}},o.onFragLoaded=function(t,e){var i=e.frag,n=e.payload,s=this.initPTS,r=this.unparsedVttFrags;if(i.type===G.b.SUBTITLE)if(n.byteLength){if(!Object(I.a)(s[i.cc]))return r.push(e),void(s.length&&this.hls.trigger(c.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")}));var a=i.decryptdata,l="stats"in e;if(a==null||a.key==null||a.method!=="AES-128"||l){var u=this.tracks[i.level],d=this.vttCCs;d[i.cc]||(d[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),u&&u.textCodec==="stpp.ttml.im1t"?this._parseIMSC1(i,n):this._parseVTTs(i,n,d)}}else this.hls.trigger(c.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},o._parseIMSC1=function(t,e){var i=this,n=this.hls;ii(e,this.initPTS[t.cc],this.timescale[t.cc],function(s){i._appendCues(s,t.level),n.trigger(c.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(s){S.b.log("Failed to parse IMSC1: "+s),n.trigger(c.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:s})})},o._parseVTTs=function(t,e,i){var n=this,s=this.hls;hn(e,this.initPTS[t.cc],this.timescale[t.cc],i,t.cc,t.start,function(r){n._appendCues(r,t.level),s.trigger(c.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(r){n._fallbackToIMSC1(t,e),S.b.log("Failed to parse VTT cue: "+r),s.trigger(c.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:r})})},o._fallbackToIMSC1=function(t,e){var i=this,n=this.tracks[t.level];n.textCodec||ii(e,this.initPTS[t.cc],this.timescale[t.cc],function(){n.textCodec="stpp.ttml.im1t",i._parseIMSC1(t,e)},function(){n.textCodec="wvtt"})},o._appendCues=function(t,e){var i=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[e];if(!n||n.mode==="disabled")return;t.forEach(function(a){return At(n,a)})}else{var s=this.tracks[e];if(!s)return;var r=s.default?"default":"subtitles"+e;i.trigger(c.a.CUES_PARSED,{type:"subtitles",cues:t,track:r})}},o.onFragDecrypted=function(t,e){var i=e.frag;if(i.type===G.b.SUBTITLE){if(!Object(I.a)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(e);this.onFragLoaded(c.a.FRAG_LOADED,e)}},o.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},o.onFragParsingUserdata=function(t,e){var i=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&i&&n)for(var s=0;s<e.samples.length;s++){var r=e.samples[s].bytes;if(r){var a=this.extractCea608Data(r);i.addData(e.samples[s].pts,a[0]),n.addData(e.samples[s].pts,a[1])}}},o.onBufferFlushing=function(t,e){var i=e.startOffset,n=e.endOffset,s=e.endOffsetSubtitles,r=e.type,a=this.media;if(a&&!(a.currentTime<n)){if(!r||r==="video"){var l=this.captionsTracks;Object.keys(l).forEach(function(d){return It(l[d],i,n)})}if(this.config.renderTextTracksNatively&&i===0&&s!==void 0){var u=this.textTracks;Object.keys(u).forEach(function(d){return It(u[d],i,s)})}}},o.extractCea608Data=function(t){for(var e=[[],[]],i=31&t[0],n=2,s=0;s<i;s++){var r=t[n++],a=127&t[n++],l=127&t[n++];if((a!==0||l!==0)&&4&r){var u=3&r;u!==0&&u!==1||(e[u].push(a),e[u].push(l))}}return e},h}();function fn(h,o){return h&&h.label===o.name&&!(h.textTrack1||h.textTrack2)}function gn(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}var Ge,vn=function(){function h(i){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=i,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var o,t,e=h.prototype;return e.setStreamController=function(i){this.streamController=i},e.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},e.registerListeners=function(){var i=this.hls;i.on(c.a.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.on(c.a.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(c.a.MANIFEST_PARSED,this.onManifestParsed,this),i.on(c.a.BUFFER_CODECS,this.onBufferCodecs,this),i.on(c.a.MEDIA_DETACHING,this.onMediaDetaching,this)},e.unregisterListener=function(){var i=this.hls;i.off(c.a.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.off(c.a.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(c.a.MANIFEST_PARSED,this.onManifestParsed,this),i.off(c.a.BUFFER_CODECS,this.onBufferCodecs,this),i.off(c.a.MEDIA_DETACHING,this.onMediaDetaching,this)},e.onFpsDropLevelCapping=function(i,n){h.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},e.onMediaAttaching=function(i,n){this.media=n.media instanceof HTMLVideoElement?n.media:null},e.onManifestParsed=function(i,n){var s=this.hls;this.restrictedLevels=[],this.firstLevel=n.firstLevel,s.config.capLevelToPlayerSize&&n.video&&this.startCapping()},e.onBufferCodecs=function(i,n){this.hls.config.capLevelToPlayerSize&&n.video&&this.startCapping()},e.onMediaDetaching=function(){this.stopCapping()},e.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var i=this.hls.levels;if(i.length){var n=this.hls;n.autoLevelCapping=this.getMaxLevel(i.length-1),n.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=n.autoLevelCapping}}},e.getMaxLevel=function(i){var n=this,s=this.hls.levels;if(!s.length)return-1;var r=s.filter(function(a,l){return h.isLevelAllowed(l,n.restrictedLevels)&&l<=i});return this.clientRect=null,h.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},e.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},e.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},e.getDimensions=function(){if(this.clientRect)return this.clientRect;var i=this.media,n={width:0,height:0};if(i){var s=i.getBoundingClientRect();n.width=s.width,n.height=s.height,n.width||n.height||(n.width=s.right-s.left||i.width||0,n.height=s.bottom-s.top||i.height||0)}return this.clientRect=n,n},h.isLevelAllowed=function(i,n){return n===void 0&&(n=[]),n.indexOf(i)===-1},h.getMaxLevelByMediaSize=function(i,n,s){if(!i||!i.length)return-1;for(var r,a,l=i.length-1,u=0;u<i.length;u+=1){var d=i[u];if((d.width>=n||d.height>=s)&&(r=d,!(a=i[u+1])||r.width!==a.width||r.height!==a.height)){l=u;break}}return l},o=h,(t=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var i=1;if(!this.hls.config.ignoreDevicePixelRatio)try{i=self.devicePixelRatio}catch{}return i}}])&&gn(o.prototype,t),Object.defineProperty(o,"prototype",{writable:!1}),h}(),pn=function(){function h(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var o=h.prototype;return o.setStreamController=function(t){this.streamController=t},o.registerListeners=function(){this.hls.on(c.a.MEDIA_ATTACHING,this.onMediaAttaching,this)},o.unregisterListeners=function(){this.hls.off(c.a.MEDIA_ATTACHING,this.onMediaAttaching)},o.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},o.onMediaAttaching=function(t,e){var i=this.hls.config;if(i.capLevelOnFPSDrop){var n=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},o.checkFPS=function(t,e,i){var n=performance.now();if(e){if(this.lastTime){var s=n-this.lastTime,r=i-this.lastDroppedFrames,a=e-this.lastDecodedFrames,l=1e3*r/s,u=this.hls;if(u.trigger(c.a.FPS_DROP,{currentDropped:r,currentDecoded:a,totalDroppedFrames:i}),l>0&&r>u.config.fpsDroppedMonitoringThreshold*a){var d=u.currentLevel;S.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=d)&&(d-=1,u.trigger(c.a.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:u.currentLevel}),u.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=e}},o.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},h}();(function(h){h.WIDEVINE="com.widevine.alpha",h.PLAYREADY="com.microsoft.playready"})(Ge||(Ge={}));var mn=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function yn(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}var ye,Ar,si,Tn=function(){function h(i){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=i,this._config=i.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var o,t,e=h.prototype;return e.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},e._registerListeners=function(){this.hls.on(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(c.a.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(c.a.MANIFEST_PARSED,this.onManifestParsed,this)},e._unregisterListeners=function(){this.hls.off(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(c.a.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(c.a.MANIFEST_PARSED,this.onManifestParsed,this)},e.getLicenseServerUrl=function(i){switch(i){case Ge.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+i+'"')},e._attemptKeySystemAccess=function(i,n,s){var r=this,a=function(u,d,f,g){switch(u){case Ge.WIDEVINE:return function(p,y,A){var E={audioCapabilities:[],videoCapabilities:[]};return p.forEach(function(W){E.audioCapabilities.push({contentType:'audio/mp4; codecs="'+W+'"',robustness:A.audioRobustness||""})}),y.forEach(function(W){E.videoCapabilities.push({contentType:'video/mp4; codecs="'+W+'"',robustness:A.videoRobustness||""})}),[E]}(d,f,g);default:throw new Error("Unknown key-system: "+u)}}(i,n,s,this._drmSystemOptions);S.b.log("Requesting encrypted media key-system access");var l=this.requestMediaKeySystemAccess(i,a);this.mediaKeysPromise=l.then(function(u){return r._onMediaKeySystemAccessObtained(i,u)}),l.catch(function(u){S.b.error('Failed to obtain key-system "'+i+'" access:',u)})},e._onMediaKeySystemAccessObtained=function(i,n){var s=this;S.b.log('Access for key-system "'+i+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:n,mediaKeySystemDomain:i};this._mediaKeysList.push(r);var a=Promise.resolve().then(function(){return n.createMediaKeys()}).then(function(l){return r.mediaKeys=l,S.b.log('Media-keys created for key-system "'+i+'"'),s._onMediaKeysCreated(),l});return a.catch(function(l){S.b.error("Failed to create media-keys:",l)}),a},e._onMediaKeysCreated=function(){var i=this;this._mediaKeysList.forEach(function(n){n.mediaKeysSession||(n.mediaKeysSession=n.mediaKeys.createSession(),i._onNewMediaKeySession(n.mediaKeysSession))})},e._onNewMediaKeySession=function(i){var n=this;S.b.log("New key-system session "+i.sessionId),i.addEventListener("message",function(s){n._onKeySessionMessage(i,s.message)},!1)},e._onKeySessionMessage=function(i,n){S.b.log("Got EME message event, creating license request"),this._requestLicense(n,function(s){S.b.log("Received license data (length: "+(s&&s.byteLength)+"), updating key-session"),i.update(s).catch(function(r){S.b.warn("Updating key-session failed: "+r)})})},e.onMediaEncrypted=function(i){var n=this;if(S.b.log('Media is encrypted using "'+i.initDataType+'" init data type'),!this.mediaKeysPromise)return S.b.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(c.a.ERROR,{type:R.b.KEY_SYSTEM_ERROR,details:R.a.KEY_SYSTEM_NO_KEYS,fatal:!0});var s=function(r){n._media&&(n._attemptSetMediaKeys(r),n._generateRequestWithPreferredKeySession(i.initDataType,i.initData))};this.mediaKeysPromise.then(s).catch(s)},e._attemptSetMediaKeys=function(i){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var n=this._mediaKeysList[0];if(!n||!n.mediaKeys)return S.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(c.a.ERROR,{type:R.b.KEY_SYSTEM_ERROR,details:R.a.KEY_SYSTEM_NO_KEYS,fatal:!0});S.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(n.mediaKeys),this._hasSetMediaKeys=!0}},e._generateRequestWithPreferredKeySession=function(i,n){var s=this,r=this._mediaKeysList[0];if(!r)return S.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(c.a.ERROR,{type:R.b.KEY_SYSTEM_ERROR,details:R.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)S.b.warn("Key-Session already initialized but requested again");else{var a=r.mediaKeysSession;if(!a)return S.b.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(c.a.ERROR,{type:R.b.KEY_SYSTEM_ERROR,details:R.a.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!n)return S.b.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(c.a.ERROR,{type:R.b.KEY_SYSTEM_ERROR,details:R.a.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});S.b.log('Generating key-session request for "'+i+'" init data type'),r.mediaKeysSessionInitialized=!0,a.generateRequest(i,n).then(function(){S.b.debug("Key-session generation succeeded")}).catch(function(l){S.b.error("Error generating key-session request:",l),s.hls.trigger(c.a.ERROR,{type:R.b.KEY_SYSTEM_ERROR,details:R.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},e._createLicenseXhr=function(i,n,s){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,i,n,s);var a=this._licenseXhrSetup;if(a)try{a.call(this.hls,r,i),a=void 0}catch(l){S.b.error(l)}try{r.readyState||r.open("POST",i,!0),a&&a.call(this.hls,r,i)}catch(l){throw new Error("issue setting up KeySystem license XHR "+l)}return r},e._onLicenseRequestReadyStageChange=function(i,n,s,r){switch(i.readyState){case 4:if(i.status===200){this._requestLicenseFailureCount=0,S.b.log("License request succeeded");var a=i.response,l=this._licenseResponseCallback;if(l)try{a=l.call(this.hls,i,n)}catch(d){S.b.error(d)}r(a)}else{if(S.b.error("License Request XHR failed ("+n+"). Status: "+i.status+" ("+i.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(c.a.ERROR,{type:R.b.KEY_SYSTEM_ERROR,details:R.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var u=3-this._requestLicenseFailureCount+1;S.b.warn("Retrying license request, "+u+" attempts left"),this._requestLicense(s,r)}}},e._generateLicenseRequestChallenge=function(i,n){switch(i.mediaKeySystemDomain){case Ge.WIDEVINE:return n}throw new Error("unsupported key-system: "+i.mediaKeySystemDomain)},e._requestLicense=function(i,n){S.b.log("Requesting content license for key-system");var s=this._mediaKeysList[0];if(!s)return S.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(c.a.ERROR,{type:R.b.KEY_SYSTEM_ERROR,details:R.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(s.mediaKeySystemDomain),a=this._createLicenseXhr(r,i,n);S.b.log("Sending license request to URL: "+r);var l=this._generateLicenseRequestChallenge(s,i);a.send(l)}catch(u){S.b.error("Failure requesting DRM license: "+u),this.hls.trigger(c.a.ERROR,{type:R.b.KEY_SYSTEM_ERROR,details:R.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},e.onMediaAttached=function(i,n){if(this._emeEnabled){var s=n.media;this._media=s,s.addEventListener("encrypted",this._onMediaEncrypted)}},e.onMediaDetached=function(){var i=this._media,n=this._mediaKeysList;i&&(i.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(n.map(function(s){if(s.mediaKeysSession)return s.mediaKeysSession.close().catch(function(){})})).then(function(){return i.setMediaKeys(null)}).catch(function(){}))},e.onManifestParsed=function(i,n){if(this._emeEnabled){var s=n.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),r=n.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess(Ge.WIDEVINE,s,r)}},o=h,(t=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&yn(o.prototype,t),Object.defineProperty(o,"prototype",{writable:!1}),h}();function oi(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}function li(h,o,t){return o&&oi(h.prototype,o),t&&oi(h,t),Object.defineProperty(h,"prototype",{writable:!1}),h}function ui(h,o){var t=typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(t)return(t=t.call(h)).next.bind(t);if(Array.isArray(h)||(t=function(i,n){if(i){if(typeof i=="string")return hi(i,n);var s=Object.prototype.toString.call(i).slice(8,-1);if(s==="Object"&&i.constructor&&(s=i.constructor.name),s==="Map"||s==="Set")return Array.from(i);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return hi(i,n)}}(h))||o&&h&&typeof h.length=="number"){t&&(h=t);var e=0;return function(){return e>=h.length?{done:!0}:{done:!1,value:h[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hi(h,o){(o==null||o>h.length)&&(o=h.length);for(var t=0,e=new Array(o);t<o;t++)e[t]=h[t];return e}function Dr(){return(Dr=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])}return h}).apply(this,arguments)}(function(h){h.MANIFEST="m",h.AUDIO="a",h.VIDEO="v",h.MUXED="av",h.INIT="i",h.CAPTION="c",h.TIMED_TEXT="tt",h.KEY="k",h.OTHER="o"})(ye||(ye={})),function(h){h.DASH="d",h.HLS="h",h.SMOOTH="s",h.OTHER="o"}(Ar||(Ar={})),function(h){h.VOD="v",h.LIVE="l"}(si||(si={}));var bn=function(){function h(t){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(s){try{e.apply(s,{ot:ye.MANIFEST,su:!e.initialized})}catch(r){S.b.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=function(s){try{var r=s.frag,a=e.hls.levels[r.level],l=e.getObjectType(r),u={d:1e3*r.duration,ot:l};l!==ye.VIDEO&&l!==ye.AUDIO&&l!=ye.MUXED||(u.br=a.bitrate/1e3,u.tb=e.getTopBandwidth(l)/1e3,u.bl=e.getBufferLength(l)),e.apply(s,u)}catch(d){S.b.warn("Could not generate segment CMCD data.",d)}},this.hls=t;var i=this.config=t.config,n=i.cmcd;n!=null&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||h.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}var o=h.prototype;return o.registerListeners=function(){var t=this.hls;t.on(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(c.a.MEDIA_DETACHED,this.onMediaDetached,this),t.on(c.a.BUFFER_CREATED,this.onBufferCreated,this)},o.unregisterListeners=function(){var t=this.hls;t.off(c.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(c.a.MEDIA_DETACHED,this.onMediaDetached,this),t.off(c.a.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},o.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},o.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},o.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},o.onBufferCreated=function(t,e){var i,n;this.audioBuffer=(i=e.tracks.audio)===null||i===void 0?void 0:i.buffer,this.videoBuffer=(n=e.tracks.video)===null||n===void 0?void 0:n.buffer},o.createData=function(){var t;return{v:1,sf:Ar.HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)===null||t===void 0?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},o.apply=function(t,e){e===void 0&&(e={}),Dr(e,this.createData());var i=e.ot===ye.INIT||e.ot===ye.VIDEO||e.ot===ye.MUXED;if(this.starved&&i&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering),this.useHeaders){var n=h.toHeaders(e);if(!Object.keys(n).length)return;t.headers||(t.headers={}),Dr(t.headers,n)}else{var s=h.toQuery(e);if(!s)return;t.url=h.appendQueryToUri(t.url,s)}},o.getObjectType=function(t){var e=t.type;return e==="subtitle"?ye.TIMED_TEXT:t.sn==="initSegment"?ye.INIT:e==="audio"?ye.AUDIO:e==="main"?this.hls.audioTracks.length?ye.VIDEO:ye.MUXED:void 0},o.getTopBandwidth=function(t){var e,i=0,n=this.hls;if(t===ye.AUDIO)e=n.audioTracks;else{var s=n.maxAutoLevel,r=s>-1?s+1:n.levels.length;e=n.levels.slice(0,r)}for(var a,l=ui(e);!(a=l()).done;){var u=a.value;u.bitrate>i&&(i=u.bitrate)}return i>0?i:NaN},o.getBufferLength=function(t){var e=this.hls.media,i=t===ye.AUDIO?this.audioBuffer:this.videoBuffer;return i&&e?1e3*v.bufferInfo(i,e.currentTime,this.config.maxBufferHole).len:NaN},o.createPlaylistLoader=function(){var t=this.config.pLoader,e=this.applyPlaylistData,i=t||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var s=n.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(r,a,l){e(r),this.loader.load(r,a,l)},li(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},o.createFragmentLoader=function(){var t=this.config.fLoader,e=this.applyFragmentData,i=t||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var s=n.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(r,a,l){e(r),this.loader.load(r,a,l)},li(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},h.uuid=function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)},h.serialize=function(t){for(var e,i=[],n=function(y){return!Number.isNaN(y)&&y!=null&&y!==""&&y!==!1},s=function(y){return Math.round(y)},r=function(y){return 100*s(y/100)},a={br:s,d:s,bl:r,dl:r,mtp:r,nor:function(y){return encodeURIComponent(y)},rtp:r,tb:s},l=ui(Object.keys(t||{}).sort());!(e=l()).done;){var u=e.value,d=t[u];if(n(d)&&!(u==="v"&&d===1||u=="pr"&&d===1)){var f=a[u];f&&(d=f(d));var g=typeof d,p=void 0;p=u==="ot"||u==="sf"||u==="st"?u+"="+d:g==="boolean"?u:g==="number"?u+"="+d:u+"="+JSON.stringify(d),i.push(p)}}return i.join(",")},h.toHeaders=function(t){for(var e={},i=["Object","Request","Session","Status"],n=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},r=0,a=Object.keys(t);r<a.length;r++){var l=a[r];n[s[l]!=null?s[l]:1][l]=t[l]}for(var u=0;u<n.length;u++){var d=h.serialize(n[u]);d&&(e["CMCD-"+i[u]]=d)}return e},h.toQuery=function(t){return"CMCD="+encodeURIComponent(h.serialize(t))},h.appendQueryToUri=function(t,e){if(!e)return t;var i=t.includes("?")?"&":"?";return""+t+i+e},h}(),di=H(14),En=/^age:\s*[\d.]+\s*$/m,ci=function(){function h(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new di.a,this.retryDelay=0}var o=h.prototype;return o.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},o.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))},o.abort=function(){var t;this.abortInternal(),(t=this.callbacks)!==null&&t!==void 0&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},o.load=function(t,e,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=i,this.retryDelay=e.retryDelay,this.loadInternal()},o.loadInternal=function(){var t=this.config,e=this.context;if(t){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var s=this.xhrSetup;try{if(s)try{s(i,e.url)}catch{i.open("GET",e.url,!0),s(i,e.url)}i.readyState||i.open("GET",e.url,!0);var r=this.context.headers;if(r)for(var a in r)i.setRequestHeader(a,r[a])}catch(l){return void this.callbacks.onError({code:i.status,text:l.message},e,i)}e.rangeEnd&&i.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),i.send()}},o.readystatechange=function(){var t=this.context,e=this.loader,i=this.stats;if(t&&e){var n=e.readyState,s=this.config;if(!i.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start)),n===4){e.onreadystatechange=null,e.onprogress=null;var r=e.status;if(r>=200&&r<300){var a,l;if(i.loading.end=Math.max(self.performance.now(),i.loading.first),l=t.responseType==="arraybuffer"?(a=e.response).byteLength:(a=e.responseText).length,i.loaded=i.total=l,!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(i,t,a,e),!this.callbacks)return;var d={url:e.responseURL,data:a};this.callbacks.onSuccess(d,i,t,e)}else i.retry>=s.maxRetry||r>=400&&r<499?(S.b.error(r+" while loading "+t.url),this.callbacks.onError({code:r,text:e.statusText},t,e)):(S.b.warn(r+" while loading "+t.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout)}},o.loadtimeout=function(){S.b.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},o.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},o.getCacheAge=function(){var t=null;if(this.loader&&En.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t},h}();function fi(h){var o=typeof Map=="function"?new Map:void 0;return(fi=function(t){if(t===null||(e=t,Function.toString.call(e).indexOf("[native code]")===-1))return t;var e;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(t))return o.get(t);o.set(t,i)}function i(){return gi(t,arguments,vi(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),nr(i,t)})(h)}function gi(h,o,t){return(gi=Sn()?Reflect.construct.bind():function(e,i,n){var s=[null];s.push.apply(s,i);var r=new(Function.bind.apply(e,s));return n&&nr(r,n.prototype),r}).apply(null,arguments)}function Sn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function nr(h,o){return(nr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(h,o)}function vi(h){return(vi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)})(h)}function pi(){return(pi=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])}return h}).apply(this,arguments)}var Ln=function(){function h(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||An,this.controller=new self.AbortController,this.stats=new di.a}var o=h.prototype;return o.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},o.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},o.abort=function(){var t;this.abortInternal(),(t=this.callbacks)!==null&&t!==void 0&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},o.load=function(t,e,i){var n=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var r=function(d,f){var g={method:"GET",mode:"cors",credentials:"same-origin",signal:f,headers:new self.Headers(pi({},d.headers))};return d.rangeEnd&&g.headers.set("Range","bytes="+d.rangeStart+"-"+String(d.rangeEnd-1)),g}(t,this.controller.signal),a=i.onProgress,l=t.responseType==="arraybuffer",u=l?"byteLength":"length";this.context=t,this.config=e,this.callbacks=i,this.request=this.fetchSetup(t,r),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){n.abortInternal(),i.onTimeout(s,t,n.response)},e.timeout),self.fetch(this.request).then(function(d){if(n.response=n.loader=d,!d.ok){var f=d.status,g=d.statusText;throw new Dn(g||"fetch, bad network response",f,d)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(d.headers.get("Content-Length")||"0"),a&&Object(I.a)(e.highWaterMark)?n.loadProgressively(d,s,t,e.highWaterMark,a):l?d.arrayBuffer():d.text()}).then(function(d){var f=n.response;self.clearTimeout(n.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first),s.loaded=s.total=d[u];var g={url:f.url,data:d};a&&!Object(I.a)(e.highWaterMark)&&a(s,t,d,f),i.onSuccess(g,s,t,f)}).catch(function(d){if(self.clearTimeout(n.requestTimeout),!s.aborted){var f=d&&d.code||0,g=d?d.message:null;i.onError({code:f,text:g},t,d?d.details:null)}})},o.getCacheAge=function(){var t=null;if(this.response){var e=this.response.headers.get("age");t=e?parseFloat(e):null}return t},o.loadProgressively=function(t,e,i,n,s){n===void 0&&(n=0);var r=new Nr.a,a=t.body.getReader();return function l(){return a.read().then(function(u){if(u.done)return r.dataLength&&s(e,i,r.flush(),t),Promise.resolve(new ArrayBuffer(0));var d=u.value,f=d.length;return e.loaded+=f,f<n||r.dataLength?(r.push(d),r.dataLength>=n&&s(e,i,r.flush(),t)):s(e,i,d,t),l()}).catch(function(){return Promise.reject()})}()},h}();function An(h,o){return new self.Request(h.url,o)}var Dn=function(h){var o,t;function e(i,n,s){var r;return(r=h.call(this,i)||this).code=void 0,r.details=void 0,r.code=n,r.details=s,r}return t=h,(o=e).prototype=Object.create(t.prototype),o.prototype.constructor=o,nr(o,t),e}(fi(Error)),mi=Ln,Rn=/\s/;function yi(){return(yi=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])}return h}).apply(this,arguments)}function Ti(h,o){var t=Object.keys(h);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(h);o&&(e=e.filter(function(i){return Object.getOwnPropertyDescriptor(h,i).enumerable})),t.push.apply(t,e)}return t}function bi(h){for(var o=1;o<arguments.length;o++){var t=arguments[o]!=null?arguments[o]:{};o%2?Ti(Object(t),!0).forEach(function(e){_n(h,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(t)):Ti(Object(t)).forEach(function(e){Object.defineProperty(h,e,Object.getOwnPropertyDescriptor(t,e))})}return h}function _n(h,o,t){return o in h?Object.defineProperty(h,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):h[o]=t,h}var kn=bi(bi({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ci,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Bi,bufferController:zi,capLevelController:vn,fpsController:pn,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:mn,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(h,o,t,e){for(var i,n,s,r,a,l=[],u=self.VTTCue||self.TextTrackCue,d=0;d<e.rows.length;d++)if(s=!0,r=0,a="",!(i=e.rows[d]).isEmpty()){for(var f=0;f<i.chars.length;f++)Rn.test(i.chars[f].uchar)&&s?r++:(a+=i.chars[f].uchar,s=!1);i.cueStartTime=o,o===t&&(t+=1e-4),r>=16?r--:r++;var g=Jr(a.trim()),p=br(o,t,g);h&&h.cues&&h.cues.getCueById(p)||((n=new u(o,t,g)).id=p,n.line=d+1,n.align="left",n.position=10+Math.min(80,10*Math.floor(8*r/32)),l.push(n))}return h&&l.length&&(l.sort(function(y,A){return y.line==="auto"||A.line==="auto"?0:y.line>8&&A.line>8?A.line-y.line:y.line-A.line}),l.forEach(function(y){return At(h,y)})),l}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Vi,subtitleTrackController:Wi,timelineController:cn,audioStreamController:Gi,audioTrackController:Ki,emeController:Tn,cmcdController:bn});function In(h){var o=h.loader;o!==mi&&o!==ci?(S.b.log("[config]: Custom loader detected, cannot enable progressive streaming"),h.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(h.loader=mi,h.progressive=!0,h.enableSoftwareAES=!0,S.b.log("[config]: Progressive streaming enabled, using FetchLoader"))}function Ei(h,o){for(var t=0;t<o.length;t++){var e=o[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}var Si=function(){function h(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.isSupportedAVC=void 0,this.isSupportedHEV=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Pr.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var s=this.config=function(bt,gt){if((gt.liveSyncDurationCount||gt.liveMaxLatencyDurationCount)&&(gt.liveSyncDuration||gt.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(gt.liveMaxLatencyDurationCount!==void 0&&(gt.liveSyncDurationCount===void 0||gt.liveMaxLatencyDurationCount<=gt.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(gt.liveMaxLatencyDuration!==void 0&&(gt.liveSyncDuration===void 0||gt.liveMaxLatencyDuration<=gt.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return yi({},bt,gt)}(h.DefaultConfig,n);this.userConfig=n,Object(S.a)(s.debug),this.isSupportedAVC=wr(),this.isSupportedHEV=xr(),this._autoLevelCapping=-1,s.progressive&&In(s);var r=s.abrController,a=s.bufferController,l=s.capLevelController,u=s.fpsController,d=this.abrController=new r(this),f=this.bufferController=new a(this),g=this.capLevelController=new l(this),p=new u(this),y=new yt(this),A=new St(this),E=new _t(this),W=this.levelController=new me(this),Z=new Ee(this),Q=this.streamController=new Mi(this,Z);g.setStreamController(Q),p.setStreamController(Q);var it=[W,Q];this.networkControllers=it;var ft=[y,A,d,f,g,p,E,Z];this.audioTrackController=this.createController(s.audioTrackController,null,it),this.createController(s.audioStreamController,Z,it),this.subtitleTrackController=this.createController(s.subtitleTrackController,null,it),this.createController(s.subtitleStreamController,Z,it),this.createController(s.timelineController,null,ft),this.emeController=this.createController(s.emeController,null,ft),this.cmcdController=this.createController(s.cmcdController,null,ft),this.latencyController=this.createController(Ht,null,ft),this.coreComponents=ft}h.isSupported=function(){return wr()},h.isSupportedHEVC=function(){return xr()};var o,t,e,i=h.prototype;return i.createController=function(n,s,r){if(n){var a=s?new n(this,s):new n(this);return r&&r.push(a),a}return null},i.on=function(n,s,r){r===void 0&&(r=this),this._emitter.on(n,s,r)},i.once=function(n,s,r){r===void 0&&(r=this),this._emitter.once(n,s,r)},i.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},i.off=function(n,s,r,a){r===void 0&&(r=this),this._emitter.off(n,s,r,a)},i.listeners=function(n){return this._emitter.listeners(n)},i.emit=function(n,s,r){return this._emitter.emit(n,s,r)},i.trigger=function(n,s){if(this.config.debug)return this.emit(n,n,s);try{return this.emit(n,n,s)}catch(r){S.b.error("An internal error happened while handling event "+n+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(c.a.ERROR,{type:R.b.OTHER_ERROR,details:R.a.INTERNAL_EXCEPTION,fatal:!1,event:n,error:r})}return!1},i.listenerCount=function(n){return this._emitter.listenerCount(n)},i.destroy=function(){S.b.log("destroy"),this.url=null,this.trigger(c.a.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.networkControllers.forEach(function(n){return n.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(n){return n.destroy()}),this.coreComponents.length=0},i.attachMedia=function(n){var s,r=n.id?n.id:"";if(n==null||(s=n.parentElement)===null||s===void 0||!s.id||n.parentElement.id!=="dhHlsVideoWrapper"+r){var a,l=document.createElement("div"),u=n.clientWidth;l.setAttribute("id","dhHlsVideoWrapper"+r),l.style.width=u+"px",l.style.position="relative",(a=n.parentNode)===null||a===void 0||a.replaceChild(l,n),l.appendChild(n)}this._media=n,this.isSupportedAVC?(this.destoryErrorNode("hlsWarnningTip"+r),this.trigger(c.a.MEDIA_ATTACHING,{media:n})):this.createdErrorNode()},i.createdErrorNode=function(n){if(n===void 0&&(n=0),this._media){var s=this._media.id?this._media.id:"",r=document.getElementById("hlsWarnningTip"+s);if(r)r.style.display="flex",r.innerHTML=n?"HLS暂不支持H265视频播放":"浏览器不支持 HLS, 请升级";else{var a=this._media.parentElement,l=document.createElement("div");l.setAttribute("id","hlsWarnningTip"+s),l.innerHTML=n?"HLS暂不支持H265视频播放":"浏览器不支持 HLS, 请升级",l.style.width="100%",l.style.height="100%",l.style.position="absolute",l.style.top="0",l.style.display="flex",l.style.justifyContent="center",l.style.alignItems="center",l.style.fontSize="30px",l.style.color="white",a==null||a.appendChild(l)}!n&&this.trigger(c.a.ERROR,{type:R.b.MEDIA_ERROR,details:R.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:"llllllll",reason:"no level with compatible codecs found in manifest"})}},i.destoryErrorNode=function(n){var s=document.getElementById(n);s&&(s.style.display="none")},i.detachMedia=function(){S.b.log("detachMedia"),this.trigger(c.a.MEDIA_DETACHING,void 0),this._media=null},i.loadSource=function(n){this.stopLoad();var s=this.media,r=this.url,a=this.url=w.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});S.b.log("loadSource:"+a),s&&r&&r!==a&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(s)),this.trigger(c.a.MANIFEST_LOADING,{url:n})},i.startLoad=function(n){n===void 0&&(n=-1),S.b.log("startLoad("+n+")"),this.networkControllers.forEach(function(s){s.startLoad(n)})},i.stopLoad=function(){S.b.log("stopLoad"),this.networkControllers.forEach(function(n){n.stopLoad()})},i.swapAudioCodec=function(){S.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){S.b.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},i.removeLevel=function(n,s){s===void 0&&(s=0),this.levelController.removeLevel(n,s)},o=h,e=[{key:"version",get:function(){}},{key:"Events",get:function(){return c.a}},{key:"ErrorTypes",get:function(){return R.b}},{key:"ErrorDetails",get:function(){return R.a}},{key:"DefaultConfig",get:function(){return h.defaultConfig?h.defaultConfig:kn},set:function(n){h.defaultConfig=n}}],(t=[{key:"levels",get:function(){var n=this.levelController.levels;return n||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){S.b.log("set currentLevel:"+n),this.loadLevel=n,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){S.b.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){S.b.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){S.b.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(n){S.b.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var s=!!n;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(S.b.log("set autoLevelCapping:"+n),this._autoLevelCapping=n)}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,s=this.config.minAutoBitrate;if(!n)return 0;for(var r=n.length,a=0;a<r;a++)if(n[a].maxBitrate>=s)return a;return 0}},{key:"maxAutoLevel",get:function(){var n=this.levels,s=this.autoLevelCapping;return s===-1&&n&&n.length?n.length-1:s}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(n){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,n)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var s=this.audioTrackController;s&&(s.audioTrack=n)}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return!!n&&n.subtitleDisplay},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&Ei(o.prototype,t),e&&Ei(o,e),Object.defineProperty(o,"prototype",{writable:!1}),h}();Si.defaultConfig=void 0}]).default})});export default ia();
